(self.webpackChunk=self.webpackChunk||[]).push([[26],{6024:(Fe,Le,ve)=>{"use strict";ve.d(Le,{f:()=>g});var re=ve(8404),me=ve.n(re),W=Object.defineProperty,B=Object.defineProperties,D=Object.getOwnPropertyDescriptors,F=Object.getOwnPropertySymbols,A=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,R=(_,E,y)=>E in _?W(_,E,{enumerable:!0,configurable:!0,writable:!0,value:y}):_[E]=y,b=(_,E)=>{for(var y in E||(E={}))A.call(E,y)&&R(_,y,E[y]);if(F)for(var y of F(E))O.call(E,y)&&R(_,y,E[y]);return _},I=(_,E)=>B(_,D(E)),L=class{constructor(_,E){this.hlsInstance={},this.hlsStatsState={},this.hlsInstance=_,this.videoEl=E}getState(){return this.hlsStatsState}},S=class extends L{constructor(){super(...arguments),this.timeUpdateHandler=()=>{let _=this.videoEl.buffered.length>0?this.videoEl.buffered.end(0)-this.videoEl.buffered.start(0):0,E=(this.hlsInstance.liveSyncPosition?this.hlsInstance.liveSyncPosition-this.videoEl.currentTime:0)*1e3,y=this.videoEl.getVideoPlaybackQuality().droppedVideoFrames;this.hlsStatsState=I(b({},this.hlsStatsState),{distanceFromLive:E>0?E:0,bufferedDuration:_,droppedFrames:y})},this.levelLoadedHandler=(_,{level:E})=>{let y=this.hlsInstance.levels[E],{bitrate:p,height:l,width:r}=y;this.hlsStatsState=I(b({},this.hlsStatsState),{bitrate:p,videoSize:{height:l,width:r}})},this.fragChangedHandler=(_,{frag:E})=>{let{stats:y,baseurl:p}=E,{bwEstimate:l}=y;this.hlsStatsState=I(b({},this.hlsStatsState),{bandwidthEstimate:l,url:p})}}startGatheringStats(){this.hlsInstance.on(me().Events.FRAG_CHANGED,this.fragChangedHandler),this.hlsInstance.on(me().Events.LEVEL_LOADED,this.levelLoadedHandler),this.videoEl.addEventListener("timeupdate",this.timeUpdateHandler)}finishGatheringStats(){this.videoEl.removeEventListener("timeupdate",this.timeUpdateHandler),this.hlsInstance.off(me().Events.FRAG_CHANGED,this.fragChangedHandler),this.hlsInstance.off(me().Events.LEVEL_LOADED,this.levelLoadedHandler)}},g=class{constructor(_,E){this.intervalFunctionId=-1;let y=new S(_,E);this.adapter=y}subscribe(_,E=2e3){return this.adapter.startGatheringStats(),this.intervalFunctionId=setInterval(()=>{_(this.getState())},E),this.unsubscribe.bind(this)}unsubscribe(){clearInterval(this.intervalFunctionId),this.adapter.finishGatheringStats()}getState(){return this.adapter.getState()}}},27:(Fe,Le,ve)=>{"use strict";ve.d(Le,{Z:()=>me});var re=ve(8160),me=W=>re.createElement("svg",Object.assign({width:"24px",height:"24px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},W),re.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.707 6.707a1 1 0 0 0-1.414-1.414L12 10.586 6.707 5.293a1 1 0 0 0-1.414 1.414L10.586 12l-5.293 5.293a1 1 0 1 0 1.414 1.414L12 13.414l5.293 5.293a1 1 0 0 0 1.414-1.414L13.414 12l5.293-5.293Z",fill:"currentColor"}))},5285:(Fe,Le,ve)=>{"use strict";ve.d(Le,{Z:()=>me});var re=ve(8160),me=W=>re.createElement("svg",Object.assign({width:"24px",height:"24px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},W),re.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.595 9.595a3.273 3.273 0 0 1 2.314-.959h1.636a.818.818 0 0 0 0-1.636H7.91a4.91 4.91 0 0 0 0 9.818h1.636a.818.818 0 0 0 0-1.636H7.91a3.273 3.273 0 0 1-2.314-5.587ZM14.455 7a.818.818 0 0 0 0 1.636h1.636a3.273 3.273 0 0 1 0 6.546h-1.637a.818.818 0 0 0 0 1.636h1.637a4.909 4.909 0 1 0 0-9.818h-1.637Zm-5.728 4.09a.818.818 0 0 0 0 1.637h6.546a.818.818 0 1 0 0-1.636H8.727Z",fill:"currentColor"}))},8404:function(Fe){typeof window<"u"&&function(ve,re){Fe.exports=re()}(this,()=>(()=>{var Le={"./src/config.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{enableStreamingMode:()=>v,hlsDefaultConfig:()=>d,mergeConfig:()=>t});var F=D("./src/controller/abr-controller.ts"),A=D("./src/controller/audio-stream-controller.ts"),O=D("./src/controller/audio-track-controller.ts"),R=D("./src/controller/subtitle-stream-controller.ts"),b=D("./src/controller/subtitle-track-controller.ts"),I=D("./src/controller/buffer-controller.ts"),L=D("./src/controller/timeline-controller.ts"),S=D("./src/controller/cap-level-controller.ts"),g=D("./src/controller/fps-controller.ts"),_=D("./src/controller/eme-controller.ts"),E=D("./src/controller/cmcd-controller.ts"),y=D("./src/utils/xhr-loader.ts"),p=D("./src/utils/fetch-loader.ts"),l=D("./src/utils/cues.ts"),r=D("./src/utils/mediakeys-helper.ts"),e=D("./src/utils/logger.ts");function f(){return f=Object.assign?Object.assign.bind():function(s){for(var h=1;h<arguments.length;h++){var u=arguments[h];for(var a in u)Object.prototype.hasOwnProperty.call(u,a)&&(s[a]=u[a])}return s},f.apply(this,arguments)}function c(s,h){var u=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);h&&(a=a.filter(function(m){return Object.getOwnPropertyDescriptor(s,m).enumerable})),u.push.apply(u,a)}return u}function n(s){for(var h=1;h<arguments.length;h++){var u=arguments[h]!=null?arguments[h]:{};h%2?c(Object(u),!0).forEach(function(a){i(s,a,u[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(u)):c(Object(u)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(u,a))})}return s}function i(s,h,u){return h in s?Object.defineProperty(s,h,{value:u,enumerable:!0,configurable:!0,writable:!0}):s[h]=u,s}var d=n(n({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:y.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:F.default,bufferController:I.default,capLevelController:S.default,fpsController:g.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:r.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},o()),{},{subtitleStreamController:R.SubtitleStreamController,subtitleTrackController:b.default,timelineController:L.TimelineController,audioStreamController:A.default,audioTrackController:O.default,emeController:_.default,cmcdController:E.default});function o(){return{cueHandler:l.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function t(s,h){if((h.liveSyncDurationCount||h.liveMaxLatencyDurationCount)&&(h.liveSyncDuration||h.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(h.liveMaxLatencyDurationCount!==void 0&&(h.liveSyncDurationCount===void 0||h.liveMaxLatencyDurationCount<=h.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(h.liveMaxLatencyDuration!==void 0&&(h.liveSyncDuration===void 0||h.liveMaxLatencyDuration<=h.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return f({},s,h)}function v(s){var h=s.loader;if(h!==p.default&&h!==y.default)e.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1;else{var u=(0,p.fetchSupported)();u&&(s.loader=p.default,s.progressive=!0,s.enableSoftwareAES=!0,e.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>_});var F=D("./src/polyfills/number.ts"),A=D("./src/utils/ewma-bandwidth-estimator.ts"),O=D("./src/events.ts"),R=D("./src/errors.ts"),b=D("./src/types/loader.ts"),I=D("./src/utils/logger.ts");function L(E,y){for(var p=0;p<y.length;p++){var l=y[p];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(E,l.key,l)}}function S(E,y,p){return y&&L(E.prototype,y),p&&L(E,p),Object.defineProperty(E,"prototype",{writable:!1}),E}var g=function(){function E(p){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=p;var l=p.config;this.bwEstimator=new A.default(l.abrEwmaSlowVoD,l.abrEwmaFastVoD,l.abrEwmaDefaultEstimate),this.registerListeners()}var y=E.prototype;return y.registerListeners=function(){var l=this.hls;l.on(O.Events.FRAG_LOADING,this.onFragLoading,this),l.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(O.Events.FRAG_BUFFERED,this.onFragBuffered,this),l.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(O.Events.ERROR,this.onError,this)},y.unregisterListeners=function(){var l=this.hls;l.off(O.Events.FRAG_LOADING,this.onFragLoading,this),l.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(O.Events.FRAG_BUFFERED,this.onFragBuffered,this),l.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(O.Events.ERROR,this.onError,this)},y.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},y.onFragLoading=function(l,r){var e=r.frag;if(e.type===b.PlaylistLevelType.MAIN&&!this.timer){var f;this.fragCurrent=e,this.partCurrent=(f=r.part)!=null?f:null,this.timer=self.setInterval(this.onCheck,100)}},y.onLevelLoaded=function(l,r){var e=this.hls.config;r.details.live?this.bwEstimator.update(e.abrEwmaSlowLive,e.abrEwmaFastLive):this.bwEstimator.update(e.abrEwmaSlowVoD,e.abrEwmaFastVoD)},y._abandonRulesCheck=function(){var l=this.fragCurrent,r=this.partCurrent,e=this.hls,f=e.autoLevelEnabled,c=e.config,n=e.media;if(!(!l||!n)){var i=r?r.stats:l.stats,d=r?r.duration:l.duration;if(i.aborted||i.loaded&&i.loaded===i.total||l.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!f||n.paused||!n.playbackRate||!n.readyState)){var o=e.mainForwardBufferInfo;if(o!==null){var t=performance.now()-i.loading.start,v=Math.abs(n.playbackRate);if(!(t<=500*d/v)){var s=i.loaded&&i.loading.first,h=this.bwEstimator.getEstimate(),u=e.levels,a=e.minAutoLevel,m=u[l.level],T=i.total||Math.max(i.loaded,Math.round(d*m.maxBitrate/8)),P=s?i.loaded*1e3/t:0,M=P?(T-i.loaded)/P:T*8/h,C=o.len/v;if(!(M<=C)){var x=Number.POSITIVE_INFINITY,U;for(U=l.level-1;U>a;U--){var k=u[U].maxBitrate;if(x=P?d*k/(8*.8*P):d*k/h,x<C)break}x>=M||(I.logger.warn("Fragment "+l.sn+(r?" part "+r.index:"")+" of level "+l.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+U+`
      Current BW estimate: `+((0,F.isFiniteNumber)(h)?(h/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+M.toFixed(3)+` s
      Estimated load time for the next fragment: `+x.toFixed(3)+` s
      Time to underbuffer: `+C.toFixed(3)+" s"),e.nextLoadLevel=U,s&&this.bwEstimator.sample(t,i.loaded),this.clearTimer(),l.loader&&(this.fragCurrent=this.partCurrent=null,l.loader.abort()),e.trigger(O.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:l,part:r,stats:i}))}}}}}},y.onFragLoaded=function(l,r){var e=r.frag,f=r.part;if(e.type===b.PlaylistLevelType.MAIN&&(0,F.isFiniteNumber)(e.sn)){var c=f?f.stats:e.stats,n=f?f.duration:e.duration;if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[e.level],d=(i.loaded?i.loaded.bytes:0)+c.loaded,o=(i.loaded?i.loaded.duration:0)+n;i.loaded={bytes:d,duration:o},i.realBitrate=Math.round(8*d/o)}if(e.bitrateTest){var t={stats:c,frag:e,part:f,id:e.type};this.onFragBuffered(O.Events.FRAG_BUFFERED,t)}}},y.onFragBuffered=function(l,r){var e=r.frag,f=r.part,c=f?f.stats:e.stats;if(!c.aborted&&!(e.type!==b.PlaylistLevelType.MAIN||e.sn==="initSegment")){var n=c.parsing.end-c.loading.start;this.bwEstimator.sample(n,c.loaded),c.bwEstimate=this.bwEstimator.getEstimate(),e.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},y.onError=function(l,r){switch(r.details){case R.ErrorDetails.FRAG_LOAD_ERROR:case R.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}},y.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},y.getNextABRAutoLevel=function(){var l=this.fragCurrent,r=this.partCurrent,e=this.hls,f=e.maxAutoLevel,c=e.config,n=e.minAutoLevel,i=e.media,d=r?r.duration:l?l.duration:0,o=i?i.currentTime:0,t=i&&i.playbackRate!==0?Math.abs(i.playbackRate):1,v=this.bwEstimator?this.bwEstimator.getEstimate():c.abrEwmaDefaultEstimate,s=e.mainForwardBufferInfo,h=(s?s.len:0)/t,u=this.findBestLevel(v,n,f,h,c.abrBandWidthFactor,c.abrBandWidthUpFactor);if(u>=0)return u;I.logger.trace((h?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var a=d?Math.min(d,c.maxStarvationDelay):c.maxStarvationDelay,m=c.abrBandWidthFactor,T=c.abrBandWidthUpFactor;if(!h){var P=this.bitrateTestDelay;if(P){var M=d?Math.min(d,c.maxLoadingDelay):c.maxLoadingDelay;a=M-P,I.logger.trace("bitrate test took "+Math.round(1e3*P)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*a)+" ms"),m=T=1}}return u=this.findBestLevel(v,n,f,h+a,m,T),Math.max(u,0)},y.findBestLevel=function(l,r,e,f,c,n){for(var i,d=this.fragCurrent,o=this.partCurrent,t=this.lastLoadedFragLevel,v=this.hls.levels,s=v[t],h=!!(s!=null&&(i=s.details)!==null&&i!==void 0&&i.live),u=s?.codecSet,a=o?o.duration:d?d.duration:0,m=e;m>=r;m--){var T=v[m];if(!(!T||u&&T.codecSet!==u)){var P=T.details,M=(o?P?.partTarget:P?.averagetargetduration)||a,C=void 0;m<=t?C=c*l:C=n*l;var x=v[m].maxBitrate,U=x*M/C;if(I.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+m+"/"+Math.round(C)+"/"+x+"/"+M+"/"+f+"/"+U),C>x&&(U===0||!(0,F.isFiniteNumber)(U)||h&&!this.bitrateTestDelay||U<f))return m}}return-1},S(E,[{key:"nextAutoLevel",get:function(){var l=this._nextAutoLevel,r=this.bwEstimator;if(l!==-1&&!r.canEstimate())return l;var e=this.getNextABRAutoLevel();return l!==-1&&this.hls.levels[e].loadError?l:(l!==-1&&(e=Math.min(l,e)),e)},set:function(l){this._nextAutoLevel=l}}]),E}();const _=g},"./src/controller/audio-stream-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>i});var F=D("./src/polyfills/number.ts"),A=D("./src/controller/base-stream-controller.ts"),O=D("./src/events.ts"),R=D("./src/utils/buffer-helper.ts"),b=D("./src/controller/fragment-tracker.ts"),I=D("./src/types/level.ts"),L=D("./src/types/loader.ts"),S=D("./src/loader/fragment.ts"),g=D("./src/demux/chunk-cache.ts"),_=D("./src/demux/transmuxer-interface.ts"),E=D("./src/types/transmuxer.ts"),y=D("./src/controller/fragment-finders.ts"),p=D("./src/utils/discontinuities.ts"),l=D("./src/errors.ts");function r(){return r=Object.assign?Object.assign.bind():function(d){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var v in t)Object.prototype.hasOwnProperty.call(t,v)&&(d[v]=t[v])}return d},r.apply(this,arguments)}function e(d,o){d.prototype=Object.create(o.prototype),d.prototype.constructor=d,f(d,o)}function f(d,o){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,s){return v.__proto__=s,v},f(d,o)}var c=100,n=function(d){e(o,d);function o(v,s){var h;return h=d.call(this,v,s,"[audio-stream-controller]")||this,h.videoBuffer=null,h.videoTrackCC=-1,h.waitingVideoCC=-1,h.audioSwitch=!1,h.trackId=-1,h.waitingData=null,h.mainDetails=null,h.bufferFlushed=!1,h.cachedTrackLoadedData=null,h._registerListeners(),h}var t=o.prototype;return t.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},t._registerListeners=function(){var s=this.hls;s.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(O.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.on(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(O.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.on(O.Events.ERROR,this.onError,this),s.on(O.Events.BUFFER_RESET,this.onBufferReset,this),s.on(O.Events.BUFFER_CREATED,this.onBufferCreated,this),s.on(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.on(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},t._unregisterListeners=function(){var s=this.hls;s.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(O.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.off(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(O.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.off(O.Events.ERROR,this.onError,this),s.off(O.Events.BUFFER_RESET,this.onBufferReset,this),s.off(O.Events.BUFFER_CREATED,this.onBufferCreated,this),s.off(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.off(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},t.onInitPtsFound=function(s,h){var u=h.frag,a=h.id,m=h.initPTS;if(a==="main"){var T=u.cc;this.initPTS[u.cc]=m,this.log("InitPTS for cc: "+T+" found from main: "+m),this.videoTrackCC=T,this.state===A.State.WAITING_INIT_PTS&&this.tick()}},t.startLoad=function(s){if(!this.levels){this.startPosition=s,this.state=A.State.STOPPED;return}var h=this.lastCurrentTime;this.stopLoad(),this.setInterval(c),this.fragLoadError=0,h>0&&s===-1?(this.log("Override startPosition with lastCurrentTime @"+h.toFixed(3)),s=h,this.state=A.State.IDLE):(this.loadedmetadata=!1,this.state=A.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()},t.doTick=function(){switch(this.state){case A.State.IDLE:this.doTickIdle();break;case A.State.WAITING_TRACK:{var s,h=this.levels,u=this.trackId,a=h==null||(s=h[u])===null||s===void 0?void 0:s.details;if(a){if(this.waitForCdnTuneIn(a))break;this.state=A.State.WAITING_INIT_PTS}break}case A.State.FRAG_LOADING_WAITING_RETRY:{var m,T=performance.now(),P=this.retryDate;(!P||T>=P||(m=this.media)!==null&&m!==void 0&&m.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=A.State.IDLE);break}case A.State.WAITING_INIT_PTS:{var M=this.waitingData;if(M){var C=M.frag,x=M.part,U=M.cache,k=M.complete;if(this.initPTS[C.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=A.State.FRAG_LOADING;var w=U.flush(),N={frag:C,part:x,payload:w,networkDetails:null};this._handleFragmentLoadProgress(N),k&&d.prototype._handleFragmentLoadComplete.call(this,N)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+C.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var K=this.getLoadPosition(),G=R.BufferHelper.bufferInfo(this.mediaBuffer,K,this.config.maxBufferHole),H=(0,y.fragmentWithinToleranceTest)(G.end,this.config.maxFragLookUpTolerance,C);H<0&&(this.log("Waiting fragment cc ("+C.cc+") @ "+C.start+" cancelled because another fragment at "+G.end+" is needed"),this.clearWaitingFragment())}}else this.state=A.State.IDLE}}this.onTickEnd()},t.clearWaitingFragment=function(){var s=this.waitingData;s&&(this.fragmentTracker.removeFragment(s.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=A.State.IDLE)},t.resetLoadingState=function(){this.clearWaitingFragment(),d.prototype.resetLoadingState.call(this)},t.onTickEnd=function(){var s=this.media;if(!(!s||!s.readyState)){var h=this.mediaBuffer?this.mediaBuffer:s,u=h.buffered;!this.loadedmetadata&&u.length&&(this.loadedmetadata=!0),this.lastCurrentTime=s.currentTime}},t.doTickIdle=function(){var s,h,u=this.hls,a=this.levels,m=this.media,T=this.trackId,P=u.config;if(!(!a||!a[T])&&!(!m&&(this.startFragRequested||!P.startFragPrefetch))){var M=a[T],C=M.details;if(!C||C.live&&this.levelLastLoaded!==T||this.waitForCdnTuneIn(C)){this.state=A.State.WAITING_TRACK;return}var x=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&x&&(this.bufferFlushed=!1,this.afterBufferFlushed(x,S.ElementaryStreamTypes.AUDIO,L.PlaylistLevelType.AUDIO));var U=this.getFwdBufferInfo(x,L.PlaylistLevelType.AUDIO);if(U!==null){var k=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,L.PlaylistLevelType.MAIN),w=U.len,N=this.getMaxBufferLength(k?.len),K=this.audioSwitch;if(!(w>=N&&!K)){if(!K&&this._streamEnded(U,C)){u.trigger(O.Events.BUFFER_EOS,{type:"audio"}),this.state=A.State.ENDED;return}var G=C.fragments,H=G[0].start,V=U.end;if(K&&m){var X=this.getLoadPosition();V=X,C.PTSKnown&&X<H&&(U.end>H||U.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),m.currentTime=H+.05)}if(!(k&&V>k.end+C.targetduration)&&!((!k||!k.len)&&U.len)){var Y=this.getNextFragment(V,C);if(!Y){this.bufferFlushed=!0;return}((s=Y.decryptdata)===null||s===void 0?void 0:s.keyFormat)==="identity"&&!((h=Y.decryptdata)!==null&&h!==void 0&&h.key)?this.loadKey(Y,C):this.loadFragment(Y,C,V)}}}}},t.getMaxBufferLength=function(s){var h=d.prototype.getMaxBufferLength.call(this);return s?Math.max(h,s):h},t.onMediaDetaching=function(){this.videoBuffer=null,d.prototype.onMediaDetaching.call(this)},t.onAudioTracksUpdated=function(s,h){var u=h.audioTracks;this.resetTransmuxer(),this.levels=u.map(function(a){return new I.Level(a)})},t.onAudioTrackSwitching=function(s,h){var u=!!h.url;this.trackId=h.id;var a=this.fragCurrent;a!=null&&a.loader&&a.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),u?this.setInterval(c):this.resetTransmuxer(),u?(this.audioSwitch=!0,this.state=A.State.IDLE):this.state=A.State.STOPPED,this.tick()},t.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},t.onLevelLoaded=function(s,h){this.mainDetails=h.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(O.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},t.onAudioTrackLoaded=function(s,h){var u;if(this.mainDetails==null){this.cachedTrackLoadedData=h;return}var a=this.levels,m=h.details,T=h.id;if(!a){this.warn("Audio tracks were reset while loading level "+T);return}this.log("Track "+T+" loaded ["+m.startSN+","+m.endSN+"],duration:"+m.totalduration);var P=a[T],M=0;if(m.live||(u=P.details)!==null&&u!==void 0&&u.live){var C=this.mainDetails;if(m.fragments[0]||(m.deltaUpdateFailed=!0),m.deltaUpdateFailed||!C)return;!P.details&&m.hasProgramDateTime&&C.hasProgramDateTime?((0,p.alignMediaPlaylistByPDT)(m,C),M=m.fragments[0].start):M=this.alignPlaylists(m,P.details)}P.details=m,this.levelLastLoaded=T,!this.startFragRequested&&(this.mainDetails||!m.live)&&this.setStartPosition(P.details,M),this.state===A.State.WAITING_TRACK&&!this.waitForCdnTuneIn(m)&&(this.state=A.State.IDLE),this.tick()},t._handleFragmentLoadProgress=function(s){var h,u=s.frag,a=s.part,m=s.payload,T=this.config,P=this.trackId,M=this.levels;if(!M){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+u.sn+" of level "+u.level+" will not be buffered");return}var C=M[P];console.assert(C,"Audio track is defined on fragment load progress");var x=C.details;console.assert(x,"Audio track details are defined on fragment load progress");var U=T.defaultAudioCodec||C.audioCodec||"mp4a.40.2",k=this.transmuxer;k||(k=this.transmuxer=new _.default(this.hls,L.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var w=this.initPTS[u.cc],N=(h=u.initSegment)===null||h===void 0?void 0:h.data;if(w!==void 0){var K=!1,G=a?a.index:-1,H=G!==-1,V=new E.ChunkMetadata(u.level,u.sn,u.stats.chunkCount,m.byteLength,G,H);k.push(m,N,U,"",u,a,x.totalduration,K,V,w)}else{this.log("Unknown video PTS for cc "+u.cc+", waiting for video PTS before demuxing audio frag "+u.sn+" of ["+x.startSN+" ,"+x.endSN+"],track "+P);var X=this.waitingData=this.waitingData||{frag:u,part:a,cache:new g.default,complete:!1},Y=X.cache;Y.push(new Uint8Array(m)),this.waitingVideoCC=this.videoTrackCC,this.state=A.State.WAITING_INIT_PTS}},t._handleFragmentLoadComplete=function(s){if(this.waitingData){this.waitingData.complete=!0;return}d.prototype._handleFragmentLoadComplete.call(this,s)},t.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},t.onBufferCreated=function(s,h){var u=h.tracks.audio;u&&(this.mediaBuffer=u.buffer||null),h.tracks.video&&(this.videoBuffer=h.tracks.video.buffer||null)},t.onFragBuffered=function(s,h){var u=h.frag,a=h.part;if(u.type===L.PlaylistLevelType.AUDIO){if(this.fragContextChanged(u)){this.warn("Fragment "+u.sn+(a?" p: "+a.index:"")+" of level "+u.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}u.sn!=="initSegment"&&(this.fragPrevious=u,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(O.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(u,a)}},t.onError=function(s,h){switch(h.details){case l.ErrorDetails.FRAG_LOAD_ERROR:case l.ErrorDetails.FRAG_LOAD_TIMEOUT:case l.ErrorDetails.KEY_LOAD_ERROR:case l.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(L.PlaylistLevelType.AUDIO,h);break;case l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case l.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==A.State.ERROR&&this.state!==A.State.STOPPED&&(this.state=h.fatal?A.State.ERROR:A.State.IDLE,this.warn(h.details+" while loading frag, switching to "+this.state+" state"));break;case l.ErrorDetails.BUFFER_FULL_ERROR:if(h.parent==="audio"&&(this.state===A.State.PARSING||this.state===A.State.PARSED)){var u=!0,a=this.getFwdBufferInfo(this.mediaBuffer,L.PlaylistLevelType.AUDIO);a&&a.len>.5&&(u=!this.reduceMaxBufferLength(a.len)),u&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,d.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break;default:break}},t.onBufferFlushed=function(s,h){var u=h.type;u===S.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},t._handleTransmuxComplete=function(s){var h,u="audio",a=this.hls,m=s.remuxResult,T=s.chunkMeta,P=this.getCurrentContext(T);if(!P){this.warn("The loading context changed while buffering fragment "+T.sn+" of level "+T.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(T.level);return}var M=P.frag,C=P.part,x=P.level.details,U=m.audio,k=m.text,w=m.id3,N=m.initSegment;if(!(this.fragContextChanged(M)||!x)){if(this.state=A.State.PARSING,this.audioSwitch&&U&&this.completeAudioSwitch(),N!=null&&N.tracks&&(this._bufferInitSegment(N.tracks,M,T),a.trigger(O.Events.FRAG_PARSING_INIT_SEGMENT,{frag:M,id:u,tracks:N.tracks})),U){var K=U.startPTS,G=U.endPTS,H=U.startDTS,V=U.endDTS;C&&(C.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:K,endPTS:G,startDTS:H,endDTS:V}),M.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,K,G,H,V),this.bufferFragmentData(U,M,C,T)}if(w!=null&&(h=w.samples)!==null&&h!==void 0&&h.length){var X=r({id:u,frag:M,details:x},w);a.trigger(O.Events.FRAG_PARSING_METADATA,X)}if(k){var Y=r({id:u,frag:M,details:x},k);a.trigger(O.Events.FRAG_PARSING_USERDATA,Y)}}},t._bufferInitSegment=function(s,h,u){if(this.state===A.State.PARSING){s.video&&delete s.video;var a=s.audio;if(!!a){a.levelCodec=a.codec,a.id="audio",this.log("Init audio buffer, container:"+a.container+", codecs[parsed]=["+a.codec+"]"),this.hls.trigger(O.Events.BUFFER_CODECS,s);var m=a.initSegment;if(m!=null&&m.byteLength){var T={type:"audio",frag:h,part:null,chunkMeta:u,parent:h.type,data:m};this.hls.trigger(O.Events.BUFFER_APPENDING,T)}this.tick()}}},t.loadFragment=function(s,h,u){var a=this.fragmentTracker.getState(s);this.fragCurrent=s,(this.audioSwitch||a===b.FragmentState.NOT_LOADED||a===b.FragmentState.PARTIAL)&&(s.sn==="initSegment"?this._loadInitSegment(s):h.live&&!(0,F.isFiniteNumber)(this.initPTS[s.cc])?(this.log("Waiting for video PTS in continuity counter "+s.cc+" of live stream before loading audio fragment "+s.sn+" of level "+this.trackId),this.state=A.State.WAITING_INIT_PTS):(this.startFragRequested=!0,d.prototype.loadFragment.call(this,s,h,u)))},t.completeAudioSwitch=function(){var s=this.hls,h=this.media,u=this.trackId;h&&(this.log("Switching audio track : flushing all audio"),d.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,s.trigger(O.Events.AUDIO_TRACK_SWITCHED,{id:u})},o}(A.default);const i=n},"./src/controller/audio-track-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>_});var F=D("./src/events.ts"),A=D("./src/errors.ts"),O=D("./src/controller/base-playlist-controller.ts"),R=D("./src/types/loader.ts");function b(E,y){for(var p=0;p<y.length;p++){var l=y[p];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(E,l.key,l)}}function I(E,y,p){return y&&b(E.prototype,y),p&&b(E,p),Object.defineProperty(E,"prototype",{writable:!1}),E}function L(E,y){E.prototype=Object.create(y.prototype),E.prototype.constructor=E,S(E,y)}function S(E,y){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,r){return l.__proto__=r,l},S(E,y)}var g=function(E){L(y,E);function y(l){var r;return r=E.call(this,l,"[audio-track-controller]")||this,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.trackName="",r.selectDefaultTrack=!0,r.registerListeners(),r}var p=y.prototype;return p.registerListeners=function(){var r=this.hls;r.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(F.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(F.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(F.Events.ERROR,this.onError,this)},p.unregisterListeners=function(){var r=this.hls;r.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(F.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(F.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(F.Events.ERROR,this.onError,this)},p.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,E.prototype.destroy.call(this)},p.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},p.onManifestParsed=function(r,e){this.tracks=e.audioTracks||[]},p.onAudioTrackLoaded=function(r,e){var f=e.id,c=e.details,n=this.tracksInGroup[f];if(!n){this.warn("Invalid audio track id "+f);return}var i=n.details;n.details=e.details,this.log("audioTrack "+f+" loaded ["+c.startSN+"-"+c.endSN+"]"),f===this.trackId&&(this.retryCount=0,this.playlistLoaded(f,e,i))},p.onLevelLoading=function(r,e){this.switchLevel(e.level)},p.onLevelSwitching=function(r,e){this.switchLevel(e.level)},p.switchLevel=function(r){var e=this.hls.levels[r];if(!!(e!=null&&e.audioGroupIds)){var f=e.audioGroupIds[e.urlId];if(this.groupId!==f){this.groupId=f;var c=this.tracks.filter(function(i){return!f||i.groupId===f});this.selectDefaultTrack&&!c.some(function(i){return i.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=c;var n={audioTracks:c};this.log("Updating audio tracks, "+c.length+' track(s) found in "'+f+'" group-id'),this.hls.trigger(F.Events.AUDIO_TRACKS_UPDATED,n),this.selectInitialTrack()}}},p.onError=function(r,e){E.prototype.onError.call(this,r,e),!(e.fatal||!e.context)&&e.context.type===R.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},p.setAudioTrack=function(r){var e=this.tracksInGroup;if(r<0||r>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var f=e[this.trackId];this.log("Now switching to audio-track index "+r);var c=e[r],n=c.id,i=c.groupId,d=i===void 0?"":i,o=c.name,t=c.type,v=c.url;if(this.trackId=r,this.trackName=o,this.selectDefaultTrack=!1,this.hls.trigger(F.Events.AUDIO_TRACK_SWITCHING,{id:n,groupId:d,name:o,type:t,url:v}),!(c.details&&!c.details.live)){var s=this.switchParams(c.url,f?.details);this.loadPlaylist(s)}},p.selectInitialTrack=function(){var r=this.tracksInGroup;console.assert(r.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,f=this.findTrackId(e)||this.findTrackId();f!==-1?this.setAudioTrack(f):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(F.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},p.findTrackId=function(r){for(var e=this.tracksInGroup,f=0;f<e.length;f++){var c=e[f];if((!this.selectDefaultTrack||c.default)&&(!r||r===c.name))return c.id}return-1},p.loadPlaylist=function(r){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var f=e.id,c=e.groupId,n=e.url;if(r)try{n=r.addDirectives(n)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}this.log("loading audio-track playlist for id: "+f),this.clearTimer(),this.hls.trigger(F.Events.AUDIO_TRACK_LOADING,{url:n,id:f,groupId:c,deliveryDirectives:r||null})}},I(y,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1,this.setAudioTrack(r)}}]),y}(O.default);const _=g},"./src/controller/base-playlist-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>I});var F=D("./src/polyfills/number.ts"),A=D("./src/types/level.ts"),O=D("./src/controller/level-helper.ts"),R=D("./src/utils/logger.ts"),b=D("./src/errors.ts"),I=function(){function L(g,_){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=R.logger.log.bind(R.logger,_+":"),this.warn=R.logger.warn.bind(R.logger,_+":"),this.hls=g}var S=L.prototype;return S.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},S.onError=function(_,E){E.fatal&&E.type===b.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},S.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},S.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},S.stopLoad=function(){this.canLoad=!1,this.clearTimer()},S.switchParams=function(_,E){var y=E?.renditionReports;if(y)for(var p=0;p<y.length;p++){var l=y[p],r=""+l.URI;if(r===_.slice(-r.length)){var e=parseInt(l["LAST-MSN"]),f=parseInt(l["LAST-PART"]);if(E&&this.hls.config.lowLatencyMode){var c=Math.min(E.age-E.partTarget,E.targetduration);f!==void 0&&c>E.partTarget&&(f+=1)}if((0,F.isFiniteNumber)(e))return new A.HlsUrlParameters(e,(0,F.isFiniteNumber)(f)?f:void 0,A.HlsSkip.No)}}},S.loadPlaylist=function(_){},S.shouldLoadTrack=function(_){return this.canLoad&&_&&!!_.url&&(!_.details||_.details.live)},S.playlistLoaded=function(_,E,y){var p=this,l=E.details,r=E.stats,e=r.loading.end?Math.max(0,self.performance.now()-r.loading.end):0;if(l.advancedDateTime=Date.now()-e,l.live||y!=null&&y.live){if(l.reloaded(y),y&&this.log("live playlist "+_+" "+(l.advanced?"REFRESHED "+l.lastPartSn+"-"+l.lastPartIndex:"MISSED")),y&&l.fragments.length>0&&(0,O.mergeDetails)(y,l),!this.canLoad||!l.live)return;var f,c=void 0,n=void 0;if(l.canBlockReload&&l.endSN&&l.advanced){var i=this.hls.config.lowLatencyMode,d=l.lastPartSn,o=l.endSN,t=l.lastPartIndex,v=t!==-1,s=d===o,h=i?0:t;v?(c=s?o+1:d,n=s?h:t+1):c=o+1;var u=l.age,a=u+l.ageHeader,m=Math.min(a-l.partTarget,l.targetduration*1.5);if(m>0){if(y&&m>y.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+y.tuneInGoal+" to: "+m+" with playlist age: "+l.age),m=0;else{var T=Math.floor(m/l.targetduration);if(c+=T,n!==void 0){var P=Math.round(m%l.targetduration/l.partTarget);n+=P}this.log("CDN Tune-in age: "+l.ageHeader+"s last advanced "+u.toFixed(2)+"s goal: "+m+" skip sn "+T+" to part "+n)}l.tuneInGoal=m}if(f=this.getDeliveryDirectives(l,E.deliveryDirectives,c,n),i||!s){this.loadPlaylist(f);return}}else f=this.getDeliveryDirectives(l,E.deliveryDirectives,c,n);var M=(0,O.computeReloadInterval)(l,r);c!==void 0&&l.canBlockReload&&(M-=l.partTarget||1),this.log("reload live playlist "+_+" in "+Math.round(M)+" ms"),this.timer=self.setTimeout(function(){return p.loadPlaylist(f)},M)}else this.clearTimer()},S.getDeliveryDirectives=function(_,E,y,p){var l=(0,A.getSkipValue)(_,y);return E!=null&&E.skip&&_.deltaUpdateFailed&&(y=E.msn,p=E.part,l=A.HlsSkip.No),new A.HlsUrlParameters(y,p,l)},S.retryLoadingOrFail=function(_){var E=this,y=this.hls.config,p=this.retryCount<y.levelLoadingMaxRetry;if(p){var l;if(this.retryCount++,_.details.indexOf("LoadTimeOut")>-1&&(l=_.context)!==null&&l!==void 0&&l.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+_.details+'"'),this.loadPlaylist();else{var r=Math.min(Math.pow(2,this.retryCount)*y.levelLoadingRetryDelay,y.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return E.loadPlaylist()},r),this.warn("retry playlist loading #"+this.retryCount+" in "+r+' ms after "'+_.details+'"')}}else this.warn('cannot recover from error "'+_.details+'"'),this.clearTimer(),_.fatal=!0;return p},L}()},"./src/controller/base-stream-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{State:()=>o,default:()=>t});var F=D("./src/polyfills/number.ts"),A=D("./src/task-loop.ts"),O=D("./src/controller/fragment-tracker.ts"),R=D("./src/utils/buffer-helper.ts"),b=D("./src/utils/logger.ts"),I=D("./src/events.ts"),L=D("./src/errors.ts"),S=D("./src/types/transmuxer.ts"),g=D("./src/utils/mp4-tools.ts"),_=D("./src/utils/discontinuities.ts"),E=D("./src/controller/fragment-finders.ts"),y=D("./src/controller/level-helper.ts"),p=D("./src/loader/fragment-loader.ts"),l=D("./src/crypt/decrypter.ts"),r=D("./src/utils/time-ranges.ts"),e=D("./src/types/loader.ts");function f(v,s){for(var h=0;h<s.length;h++){var u=s[h];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(v,u.key,u)}}function c(v,s,h){return s&&f(v.prototype,s),h&&f(v,h),Object.defineProperty(v,"prototype",{writable:!1}),v}function n(v){if(v===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v}function i(v,s){v.prototype=Object.create(s.prototype),v.prototype.constructor=v,d(v,s)}function d(v,s){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,a){return u.__proto__=a,u},d(v,s)}var o={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},t=function(v){i(s,v);function s(u,a,m){var T;return T=v.call(this)||this,T.hls=void 0,T.fragPrevious=null,T.fragCurrent=null,T.fragmentTracker=void 0,T.transmuxer=null,T._state=o.STOPPED,T.media=null,T.mediaBuffer=null,T.config=void 0,T.bitrateTest=!1,T.lastCurrentTime=0,T.nextLoadPosition=0,T.startPosition=0,T.loadedmetadata=!1,T.fragLoadError=0,T.retryDate=0,T.levels=null,T.fragmentLoader=void 0,T.levelLastLoaded=null,T.startFragRequested=!1,T.decrypter=void 0,T.initPTS=[],T.onvseeking=null,T.onvended=null,T.logPrefix="",T.log=void 0,T.warn=void 0,T.logPrefix=m,T.log=b.logger.log.bind(b.logger,m+":"),T.warn=b.logger.warn.bind(b.logger,m+":"),T.hls=u,T.fragmentLoader=new p.default(u.config),T.fragmentTracker=a,T.config=u.config,T.decrypter=new l.default(u,u.config),u.on(I.Events.KEY_LOADED,T.onKeyLoaded,n(T)),u.on(I.Events.LEVEL_SWITCHING,T.onLevelSwitching,n(T)),T}var h=s.prototype;return h.doTick=function(){this.onTickEnd()},h.onTickEnd=function(){},h.startLoad=function(a){},h.stopLoad=function(){this.fragmentLoader.abort();var a=this.fragCurrent;a&&this.fragmentTracker.removeFragment(a),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=o.STOPPED},h._streamEnded=function(a,m){var T=this.fragCurrent,P=this.fragmentTracker;if(!m.live&&T&&this.media&&T.sn>=m.endSN&&!a.nextStart){var M=m.partList;if(M!=null&&M.length){var C=M[M.length-1],x=R.BufferHelper.isBuffered(this.media,C.start+C.duration/2);return x}var U=P.getState(T);return U===O.FragmentState.PARTIAL||U===O.FragmentState.OK}return!1},h.onMediaAttached=function(a,m){var T=this.media=this.mediaBuffer=m.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),T.addEventListener("seeking",this.onvseeking),T.addEventListener("ended",this.onvended);var P=this.config;this.levels&&P.autoStartLoad&&this.state===o.STOPPED&&this.startLoad(P.startPosition)},h.onMediaDetaching=function(){var a=this.media;a!=null&&a.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),a&&this.onvseeking&&this.onvended&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},h.onMediaSeeking=function(){var a=this.config,m=this.fragCurrent,T=this.media,P=this.mediaBuffer,M=this.state,C=T?T.currentTime:0,x=R.BufferHelper.bufferInfo(P||T,C,a.maxBufferHole);if(this.log("media seeking to "+((0,F.isFiniteNumber)(C)?C.toFixed(3):C)+", state: "+M),M===o.ENDED)this.resetLoadingState();else if(m&&!x.len){var U=a.maxFragLookUpTolerance,k=m.start-U,w=m.start+m.duration+U,N=C>w;(C<k||N)&&(N&&m.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),m.loader.abort()),this.resetLoadingState())}T&&(this.lastCurrentTime=C),!this.loadedmetadata&&!x.len&&(this.nextLoadPosition=this.startPosition=C),this.tickImmediate()},h.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},h.onKeyLoaded=function(a,m){if(!(this.state!==o.KEY_LOADING||m.frag!==this.fragCurrent||!this.levels)){this.state=o.IDLE;var T=this.levels[m.frag.level].details;T&&this.loadFragment(m.frag,T,m.frag.start)}},h.onLevelSwitching=function(a,m){this.fragLoadError=0},h.onHandlerDestroying=function(){this.stopLoad(),v.prototype.onHandlerDestroying.call(this)},h.onHandlerDestroyed=function(){this.state=o.STOPPED,this.hls.off(I.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(I.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,v.prototype.onHandlerDestroyed.call(this)},h.loadKey=function(a,m){this.log("Loading key for "+a.sn+" of ["+m.startSN+"-"+m.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+a.level),this.state=o.KEY_LOADING,this.fragCurrent=a,this.hls.trigger(I.Events.KEY_LOADING,{frag:a})},h.loadFragment=function(a,m,T){this._loadFragForPlayback(a,m,T)},h._loadFragForPlayback=function(a,m,T){var P=this,M=function(x){if(P.fragContextChanged(a)){P.warn("Fragment "+a.sn+(x.part?" p: "+x.part.index:"")+" of level "+a.level+" was dropped during download."),P.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,P._handleFragmentLoadProgress(x)};this._doFragLoad(a,m,T,M).then(function(C){if(!!C){P.fragLoadError=0;var x=P.state;if(P.fragContextChanged(a)){(x===o.FRAG_LOADING||!P.fragCurrent&&x===o.PARSING)&&(P.fragmentTracker.removeFragment(a),P.state=o.IDLE);return}"payload"in C&&(P.log("Loaded fragment "+a.sn+" of level "+a.level),P.hls.trigger(I.Events.FRAG_LOADED,C)),P._handleFragmentLoadComplete(C)}}).catch(function(C){P.state===o.STOPPED||P.state===o.ERROR||(P.warn(C),P.resetFragmentLoading(a))})},h.flushMainBuffer=function(a,m,T){if(T===void 0&&(T=null),!!(a-m)){var P={startOffset:a,endOffset:m,type:T};this.fragLoadError=0,this.hls.trigger(I.Events.BUFFER_FLUSHING,P)}},h._loadInitSegment=function(a){var m=this;this._doFragLoad(a).then(function(T){if(!T||m.fragContextChanged(a)||!m.levels)throw new Error("init load aborted");return T}).then(function(T){var P=m.hls,M=T.payload,C=a.decryptdata;if(M&&M.byteLength>0&&C&&C.key&&C.iv&&C.method==="AES-128"){var x=self.performance.now();return m.decrypter.webCryptoDecrypt(new Uint8Array(M),C.key.buffer,C.iv.buffer).then(function(U){var k=self.performance.now();return P.trigger(I.Events.FRAG_DECRYPTED,{frag:a,payload:U,stats:{tstart:x,tdecrypt:k}}),T.payload=U,T})}return T}).then(function(T){var P=m.fragCurrent,M=m.hls,C=m.levels;if(!C)throw new Error("init load aborted, missing levels");var x=C[a.level].details;console.assert(x,"Level details are defined when init segment is loaded");var U=a.stats;m.state=o.IDLE,m.fragLoadError=0,a.data=new Uint8Array(T.payload),U.parsing.start=U.buffering.start=self.performance.now(),U.parsing.end=U.buffering.end=self.performance.now(),T.frag===P&&M.trigger(I.Events.FRAG_BUFFERED,{stats:U,frag:P,part:null,id:a.type}),m.tick()}).catch(function(T){m.state===o.STOPPED||m.state===o.ERROR||(m.warn(T),m.resetFragmentLoading(a))})},h.fragContextChanged=function(a){var m=this.fragCurrent;return!a||!m||a.level!==m.level||a.sn!==m.sn||a.urlId!==m.urlId},h.fragBufferedComplete=function(a,m){var T,P,M=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+a.type+" sn: "+a.sn+(m?" part: "+m.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+a.level+" "+(M?r.default.toString(R.BufferHelper.getBuffered(M)):"(detached)")),this.state=o.IDLE,M&&(!this.loadedmetadata&&M.buffered.length&&((T=this.fragCurrent)===null||T===void 0?void 0:T.sn)===((P=this.fragPrevious)===null||P===void 0?void 0:P.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},h.seekToStartPos=function(){},h._handleFragmentLoadComplete=function(a){var m=this.transmuxer;if(!!m){var T=a.frag,P=a.part,M=a.partsLoaded,C=!M||M.length===0||M.some(function(U){return!U}),x=new S.ChunkMetadata(T.level,T.sn,T.stats.chunkCount+1,0,P?P.index:-1,!C);m.flush(x)}},h._handleFragmentLoadProgress=function(a){},h._doFragLoad=function(a,m,T,P){var M=this;if(T===void 0&&(T=null),!this.levels)throw new Error("frag load aborted, missing levels");if(T=Math.max(a.start,T||0),this.config.lowLatencyMode&&m){var C=m.partList;if(C&&P){T>a.end&&m.fragmentHint&&(a=m.fragmentHint);var x=this.getNextPart(C,a,T);if(x>-1){var U=C[x];return this.log("Loading part sn: "+a.sn+" p: "+U.index+" cc: "+a.cc+" of playlist ["+m.startSN+"-"+m.endSN+"] parts [0-"+x+"-"+(C.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+a.level+", target: "+parseFloat(T.toFixed(3))),this.nextLoadPosition=U.start+U.duration,this.state=o.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:a,part:C[x],targetBufferTime:T}),this.doFragPartsLoad(a,C,x,P).catch(function(k){return M.handleFragLoadError(k)})}else if(!a.url||this.loadedEndOfParts(C,T))return Promise.resolve(null)}}return this.log("Loading fragment "+a.sn+" cc: "+a.cc+" "+(m?"of ["+m.startSN+"-"+m.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+a.level+", target: "+parseFloat(T.toFixed(3))),(0,F.isFiniteNumber)(a.sn)&&!this.bitrateTest&&(this.nextLoadPosition=a.start+a.duration),this.state=o.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:a,targetBufferTime:T}),this.fragmentLoader.load(a,P).catch(function(k){return M.handleFragLoadError(k)})},h.doFragPartsLoad=function(a,m,T,P){var M=this;return new Promise(function(C,x){var U=[],k=function w(N){var K=m[N];M.fragmentLoader.loadPart(a,K,P).then(function(G){U[K.index]=G;var H=G.part;M.hls.trigger(I.Events.FRAG_LOADED,G);var V=m[N+1];if(V&&V.fragment===a)w(N+1);else return C({frag:a,part:H,partsLoaded:U})}).catch(x)};k(T)})},h.handleFragLoadError=function(a){var m=a.data;return m&&m.details===L.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(m.frag,m.part):this.hls.trigger(I.Events.ERROR,m),null},h._handleTransmuxerFlush=function(a){var m=this.getCurrentContext(a);if(!m||this.state!==o.PARSING){this.fragCurrent||(this.state=o.IDLE);return}var T=m.frag,P=m.part,M=m.level,C=self.performance.now();T.stats.parsing.end=C,P&&(P.stats.parsing.end=C),this.updateLevelTiming(T,P,M,a.partial)},h.getCurrentContext=function(a){var m=this.levels,T=a.level,P=a.sn,M=a.part;if(!m||!m[T])return this.warn("Levels object was unset while buffering fragment "+P+" of level "+T+". The current chunk will not be buffered."),null;var C=m[T],x=M>-1?(0,y.getPartWith)(C,P,M):null,U=x?x.fragment:(0,y.getFragmentWithSN)(C,P,this.fragCurrent);return U?{frag:U,part:x,level:C}:null},h.bufferFragmentData=function(a,m,T,P){if(!(!a||this.state!==o.PARSING)){var M=a.data1,C=a.data2,x=M;if(M&&C&&(x=(0,g.appendUint8Array)(M,C)),!(!x||!x.length)){var U={type:a.type,frag:m,part:T,chunkMeta:P,parent:m.type,data:x};this.hls.trigger(I.Events.BUFFER_APPENDING,U),a.dropped&&a.independent&&!T&&this.flushBufferGap(m)}}},h.flushBufferGap=function(a){var m=this.media;if(!!m){if(!R.BufferHelper.isBuffered(m,m.currentTime)){this.flushMainBuffer(0,a.start);return}var T=m.currentTime,P=R.BufferHelper.bufferInfo(m,T,0),M=a.duration,C=Math.min(this.config.maxFragLookUpTolerance*2,M*.25),x=Math.max(Math.min(a.start-C,P.end-C),T+C);a.start-x>C&&this.flushMainBuffer(x,a.start)}},h.getFwdBufferInfo=function(a,m){var T=this.config,P=this.getLoadPosition();if(!(0,F.isFiniteNumber)(P))return null;var M=R.BufferHelper.bufferInfo(a,P,T.maxBufferHole);if(M.len===0&&M.nextStart!==void 0){var C=this.fragmentTracker.getBufferedFrag(P,m);if(C&&M.nextStart<C.end)return R.BufferHelper.bufferInfo(a,P,Math.max(M.nextStart,T.maxBufferHole))}return M},h.getMaxBufferLength=function(a){var m=this.config,T;return a?T=Math.max(8*m.maxBufferSize/a,m.maxBufferLength):T=m.maxBufferLength,Math.min(T,m.maxMaxBufferLength)},h.reduceMaxBufferLength=function(a){var m=this.config,T=a||m.maxBufferLength;return m.maxMaxBufferLength>=T?(m.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+m.maxMaxBufferLength+"s"),!0):!1},h.getNextFragment=function(a,m){var T=m.fragments,P=T.length;if(!P)return null;var M=this.config,C=T[0].start,x;if(m.live){var U=M.initialLiveManifestSize;if(P<U)return this.warn("Not enough fragments to start playback (have: "+P+", need: "+U+")"),null;!m.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(x=this.getInitialLiveFragment(m,T),this.startPosition=x?this.hls.liveSyncPosition||x.start:a)}else a<=C&&(x=T[0]);if(!x){var k=M.lowLatencyMode?m.partEnd:m.fragmentEnd;x=this.getFragmentAtPosition(a,k,m)}return this.mapToInitFragWhenRequired(x)},h.mapToInitFragWhenRequired=function(a){return a!=null&&a.initSegment&&!(a!=null&&a.initSegment.data)&&!this.bitrateTest?a.initSegment:a},h.getNextPart=function(a,m,T){for(var P=-1,M=!1,C=!0,x=0,U=a.length;x<U;x++){var k=a[x];if(C=C&&!k.independent,P>-1&&T<k.start)break;var w=k.loaded;!w&&(M||k.independent||C)&&k.fragment===m&&(P=x),M=w}return P},h.loadedEndOfParts=function(a,m){var T=a[a.length-1];return T&&m>T.start&&T.loaded},h.getInitialLiveFragment=function(a,m){var T=this.fragPrevious,P=null;if(T){if(a.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+T.programDateTime),P=(0,E.findFragmentByPDT)(m,T.endProgramDateTime,this.config.maxFragLookUpTolerance)),!P){var M=T.sn+1;if(M>=a.startSN&&M<=a.endSN){var C=m[M-a.startSN];T.cc===C.cc&&(P=C,this.log("Live playlist, switching playlist, load frag with next SN: "+P.sn))}P||(P=(0,E.findFragWithCC)(m,T.cc),P&&this.log("Live playlist, switching playlist, load frag with same CC: "+P.sn))}}else{var x=this.hls.liveSyncPosition;x!==null&&(P=this.getFragmentAtPosition(x,this.bitrateTest?a.fragmentEnd:a.edge,a))}return P},h.getFragmentAtPosition=function(a,m,T){var P=this.config,M=this.fragPrevious,C=T.fragments,x=T.endSN,U=T.fragmentHint,k=P.maxFragLookUpTolerance,w=!!(P.lowLatencyMode&&T.partList&&U);w&&U&&!this.bitrateTest&&(C=C.concat(U),x=U.sn);var N;if(a<m){var K=a>m-k?0:k;N=(0,E.findFragmentByPTS)(M,C,a,K)}else N=C[C.length-1];if(N){var G=N.sn-T.startSN;if(this.fragmentTracker.getState(N)===O.FragmentState.OK&&(M=N),M&&N.sn===M.sn&&!w){var H=M&&N.level===M.level;if(H){var V=C[G+1];N.sn<x&&this.fragmentTracker.getState(V)!==O.FragmentState.OK?(this.log("SN "+N.sn+" just loaded, load next one: "+V.sn),N=V):N=null}}}return N},h.synchronizeToLiveEdge=function(a){var m=this.config,T=this.media;if(!!T){var P=this.hls.liveSyncPosition,M=T.currentTime,C=a.fragments[0].start,x=a.edge,U=M>=C-m.maxFragLookUpTolerance&&M<=x;if(P!==null&&T.duration>P&&(M<P||!U)){var k=m.liveMaxLatencyDuration!==void 0?m.liveMaxLatencyDuration:m.liveMaxLatencyDurationCount*a.targetduration;(!U&&T.readyState<4||M<x-k)&&(this.loadedmetadata||(this.nextLoadPosition=P),T.readyState&&(this.warn("Playback: "+M.toFixed(3)+" is located too far from the end of live sliding playlist: "+x+", reset currentTime to : "+P.toFixed(3)),T.currentTime=P))}}},h.alignPlaylists=function(a,m){var T=this.levels,P=this.levelLastLoaded,M=this.fragPrevious,C=P!==null?T[P]:null,x=a.fragments.length;if(!x)return this.warn("No fragments in live playlist"),0;var U=a.fragments[0].start,k=!m,w=a.alignedSliding&&(0,F.isFiniteNumber)(U);if(k||!w&&!U){(0,_.alignStream)(M,C,a);var N=a.fragments[0].start;return this.log("Live playlist sliding: "+N.toFixed(2)+" start-sn: "+(m?m.startSN:"na")+"->"+a.startSN+" prev-sn: "+(M?M.sn:"na")+" fragments: "+x),N}return U},h.waitForCdnTuneIn=function(a){var m=3;return a.live&&a.canBlockReload&&a.partTarget&&a.tuneInGoal>Math.max(a.partHoldBack,a.partTarget*m)},h.setStartPosition=function(a,m){var T=this.startPosition;if(T<m&&(T=-1),T===-1||this.lastCurrentTime===-1){var P=a.startTimeOffset;(0,F.isFiniteNumber)(P)?(T=m+P,P<0&&(T+=a.totalduration),T=Math.min(Math.max(m,T),m+a.totalduration),this.log("Start time offset "+P+" found in playlist, adjust startPosition to "+T),this.startPosition=T):a.live?T=this.hls.liveSyncPosition||m:this.startPosition=T=0,this.lastCurrentTime=T}this.nextLoadPosition=T},h.getLoadPosition=function(){var a=this.media,m=0;return this.loadedmetadata&&a?m=a.currentTime:this.nextLoadPosition&&(m=this.nextLoadPosition),m},h.handleFragLoadAborted=function(a,m){this.transmuxer&&a.sn!=="initSegment"&&a.stats.aborted&&(this.warn("Fragment "+a.sn+(m?" part"+m.index:"")+" of level "+a.level+" was aborted"),this.resetFragmentLoading(a))},h.resetFragmentLoading=function(a){(!this.fragCurrent||!this.fragContextChanged(a)&&this.state!==o.FRAG_LOADING_WAITING_RETRY)&&(this.state=o.IDLE)},h.onFragmentOrKeyLoadError=function(a,m){if(!m.fatal){var T=m.frag;if(!(!T||T.type!==a)){var P=this.fragCurrent;console.assert(P&&T.sn===P.sn&&T.level===P.level&&T.urlId===P.urlId,"Frag load error must match current frag to retry");var M=this.config;if(this.fragLoadError+1<=M.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var C=Math.min(Math.pow(2,this.fragLoadError)*M.fragLoadingRetryDelay,M.fragLoadingMaxRetryTimeout);this.warn("Fragment "+T.sn+" of "+a+" "+T.level+" failed to load, retrying in "+C+"ms"),this.retryDate=self.performance.now()+C,this.fragLoadError++,this.state=o.FRAG_LOADING_WAITING_RETRY}else m.levelRetry?(a===e.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=o.IDLE):(b.logger.error(m.details+" reaches max retry, redispatch as fatal ..."),m.fatal=!0,this.hls.stopLoad(),this.state=o.ERROR)}}},h.afterBufferFlushed=function(a,m,T){if(!!a){var P=R.BufferHelper.getBuffered(a);this.fragmentTracker.detectEvictedFragments(m,P,T),this.state===o.ENDED&&this.resetLoadingState()}},h.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=o.IDLE},h.resetStartWhenNotLoaded=function(a){if(!this.loadedmetadata){this.startFragRequested=!1;var m=this.levels?this.levels[a].details:null;m!=null&&m.live?(this.startPosition=-1,this.setStartPosition(m,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},h.updateLevelTiming=function(a,m,T,P){var M=this,C=T.details;console.assert(!!C,"level.details must be defined");var x=Object.keys(a.elementaryStreams).reduce(function(U,k){var w=a.elementaryStreams[k];if(w){var N=w.endPTS-w.startPTS;if(N<=0)return M.warn("Could not parse fragment "+a.sn+" "+k+" duration reliably ("+N+")"),U||!1;var K=P?0:(0,y.updateFragPTSDTS)(C,a,w.startPTS,w.endPTS,w.startDTS,w.endDTS);return M.hls.trigger(I.Events.LEVEL_PTS_UPDATED,{details:C,level:T,drift:K,type:k,frag:a,start:w.startPTS,end:w.endPTS}),!0}return U},!1);x||(this.warn("Found no media in fragment "+a.sn+" of level "+T.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=o.PARSED,this.hls.trigger(I.Events.FRAG_PARSED,{frag:a,part:m})},h.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},c(s,[{key:"state",get:function(){return this._state},set:function(a){var m=this._state;m!==a&&(this._state=a,this.log(m+"->"+a))}}]),s}(A.default)},"./src/controller/buffer-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>E});var F=D("./src/polyfills/number.ts"),A=D("./src/events.ts"),O=D("./src/utils/logger.ts"),R=D("./src/errors.ts"),b=D("./src/utils/buffer-helper.ts"),I=D("./src/utils/mediasource-helper.ts"),L=D("./src/loader/fragment.ts"),S=D("./src/controller/buffer-operation-queue.ts"),g=(0,I.getMediaSource)(),_=/([ha]vc.)(?:\.[^.,]+)+/,E=function(){function y(l){var r=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=r.hls,f=r.media,c=r.mediaSource;O.logger.log("[buffer-controller]: Media source opened"),f&&(r.updateMediaElementDuration(),e.trigger(A.Events.MEDIA_ATTACHED,{media:f})),c&&c.removeEventListener("sourceopen",r._onMediaSourceOpen),r.checkPendingTracks()},this._onMediaSourceClose=function(){O.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){O.logger.log("[buffer-controller]: Media source ended")},this.hls=l,this._initSourceBuffer(),this.registerListeners()}var p=y.prototype;return p.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},p.destroy=function(){this.unregisterListeners(),this.details=null},p.registerListeners=function(){var r=this.hls;r.on(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(A.Events.BUFFER_RESET,this.onBufferReset,this),r.on(A.Events.BUFFER_APPENDING,this.onBufferAppending,this),r.on(A.Events.BUFFER_CODECS,this.onBufferCodecs,this),r.on(A.Events.BUFFER_EOS,this.onBufferEos,this),r.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this),r.on(A.Events.FRAG_PARSED,this.onFragParsed,this),r.on(A.Events.FRAG_CHANGED,this.onFragChanged,this)},p.unregisterListeners=function(){var r=this.hls;r.off(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(A.Events.BUFFER_RESET,this.onBufferReset,this),r.off(A.Events.BUFFER_APPENDING,this.onBufferAppending,this),r.off(A.Events.BUFFER_CODECS,this.onBufferCodecs,this),r.off(A.Events.BUFFER_EOS,this.onBufferEos,this),r.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this),r.off(A.Events.FRAG_PARSED,this.onFragParsed,this),r.off(A.Events.FRAG_CHANGED,this.onFragChanged,this)},p._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new S.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},p.onManifestParsed=function(r,e){var f=2;(e.audio&&!e.video||!e.altAudio)&&(f=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=f,this.details=null,O.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},p.onMediaAttaching=function(r,e){var f=this.media=e.media;if(f&&g){var c=this.mediaSource=new g;c.addEventListener("sourceopen",this._onMediaSourceOpen),c.addEventListener("sourceended",this._onMediaSourceEnded),c.addEventListener("sourceclose",this._onMediaSourceClose),f.src=self.URL.createObjectURL(c),this._objectUrl=f.src}},p.onMediaDetaching=function(){var r=this.media,e=this.mediaSource,f=this._objectUrl;if(e){if(O.logger.log("[buffer-controller]: media source detaching"),e.readyState==="open")try{e.endOfStream()}catch(c){O.logger.warn("[buffer-controller]: onMediaDetaching: "+c.message+" while calling endOfStream")}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),r&&(f&&self.URL.revokeObjectURL(f),r.src===f?(r.removeAttribute("src"),r.load()):O.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(A.Events.MEDIA_DETACHED,void 0)},p.onBufferReset=function(){var r=this;this.getSourceBufferTypes().forEach(function(e){var f=r.sourceBuffer[e];try{f&&(r.removeBufferListeners(e),r.mediaSource&&r.mediaSource.removeSourceBuffer(f),r.sourceBuffer[e]=void 0)}catch(c){O.logger.warn("[buffer-controller]: Failed to reset the "+e+" buffer",c)}}),this._initSourceBuffer()},p.onBufferCodecs=function(r,e){var f=this,c=this.getSourceBufferTypes().length;Object.keys(e).forEach(function(n){if(c){var i=f.tracks[n];if(i&&typeof i.buffer.changeType=="function"){var d=e[n],o=d.id,t=d.codec,v=d.levelCodec,s=d.container,h=d.metadata,u=(i.levelCodec||i.codec).replace(_,"$1"),a=(v||t).replace(_,"$1");if(u!==a){var m=s+";codecs="+(v||t);f.appendChangeType(n,m),O.logger.log("[buffer-controller]: switching codec "+u+" to "+a),f.tracks[n]={buffer:i.buffer,codec:t,container:s,levelCodec:v,metadata:h,id:o}}}}else f.pendingTracks[n]=e[n]}),!c&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},p.appendChangeType=function(r,e){var f=this,c=this.operationQueue,n={execute:function(){var d=f.sourceBuffer[r];d&&(O.logger.log("[buffer-controller]: changing "+r+" sourceBuffer type to "+e),d.changeType(e)),c.shiftAndExecuteNext(r)},onStart:function(){},onComplete:function(){},onError:function(d){O.logger.warn("[buffer-controller]: Failed to change "+r+" SourceBuffer type",d)}};c.append(n,r)},p.onBufferAppending=function(r,e){var f=this,c=this.hls,n=this.operationQueue,i=this.tracks,d=e.data,o=e.type,t=e.frag,v=e.part,s=e.chunkMeta,h=s.buffering[o],u=self.performance.now();h.start=u;var a=t.stats.buffering,m=v?v.stats.buffering:null;a.start===0&&(a.start=u),m&&m.start===0&&(m.start=u);var T=i.audio,P=o==="audio"&&s.id===1&&T?.container==="audio/mpeg",M={execute:function(){if(h.executeStart=self.performance.now(),P){var x=f.sourceBuffer[o];if(x){var U=t.start-x.timestampOffset;Math.abs(U)>=.1&&(O.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+t.start+" (delta: "+U+") sn: "+t.sn+")"),x.timestampOffset=t.start)}}f.appendExecutor(d,o)},onStart:function(){},onComplete:function(){var x=self.performance.now();h.executeEnd=h.end=x,a.first===0&&(a.first=x),m&&m.first===0&&(m.first=x);var U=f.sourceBuffer,k={};for(var w in U)k[w]=b.BufferHelper.getBuffered(U[w]);f.appendError=0,f.hls.trigger(A.Events.BUFFER_APPENDED,{type:o,frag:t,part:v,chunkMeta:s,parent:t.type,timeRanges:k})},onError:function(x){O.logger.error("[buffer-controller]: Error encountered while trying to append to the "+o+" SourceBuffer",x);var U={type:R.ErrorTypes.MEDIA_ERROR,parent:t.type,details:R.ErrorDetails.BUFFER_APPEND_ERROR,err:x,fatal:!1};x.code===DOMException.QUOTA_EXCEEDED_ERR?U.details=R.ErrorDetails.BUFFER_FULL_ERROR:(f.appendError++,U.details=R.ErrorDetails.BUFFER_APPEND_ERROR,f.appendError>c.config.appendErrorMaxRetry&&(O.logger.error("[buffer-controller]: Failed "+c.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),U.fatal=!0,c.stopLoad())),c.trigger(A.Events.ERROR,U)}};n.append(M,o)},p.onBufferFlushing=function(r,e){var f=this,c=this.operationQueue,n=function(d){return{execute:f.removeExecutor.bind(f,d,e.startOffset,e.endOffset),onStart:function(){},onComplete:function(){f.hls.trigger(A.Events.BUFFER_FLUSHED,{type:d})},onError:function(t){O.logger.warn("[buffer-controller]: Failed to remove from "+d+" SourceBuffer",t)}}};e.type?c.append(n(e.type),e.type):this.getSourceBufferTypes().forEach(function(i){c.append(n(i),i)})},p.onFragParsed=function(r,e){var f=this,c=e.frag,n=e.part,i=[],d=n?n.elementaryStreams:c.elementaryStreams;d[L.ElementaryStreamTypes.AUDIOVIDEO]?i.push("audiovideo"):(d[L.ElementaryStreamTypes.AUDIO]&&i.push("audio"),d[L.ElementaryStreamTypes.VIDEO]&&i.push("video"));var o=function(){var v=self.performance.now();c.stats.buffering.end=v,n&&(n.stats.buffering.end=v);var s=n?n.stats:c.stats;f.hls.trigger(A.Events.FRAG_BUFFERED,{frag:c,part:n,stats:s,id:c.type})};i.length===0&&O.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+c.type+" level: "+c.level+" sn: "+c.sn),this.blockBuffers(o,i)},p.onFragChanged=function(r,e){this.flushBackBuffer()},p.onBufferEos=function(r,e){var f=this,c=this.getSourceBufferTypes().reduce(function(n,i){var d=f.sourceBuffer[i];return(!e.type||e.type===i)&&d&&!d.ended&&(d.ended=!0,O.logger.log("[buffer-controller]: "+i+" sourceBuffer now EOS")),n&&!!(!d||d.ended)},!0);c&&this.blockBuffers(function(){var n=f.mediaSource;!n||n.readyState!=="open"||n.endOfStream()})},p.onLevelUpdated=function(r,e){var f=e.details;!f.fragments.length||(this.details=f,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},p.flushBackBuffer=function(){var r=this.hls,e=this.details,f=this.media,c=this.sourceBuffer;if(!(!f||e===null)){var n=this.getSourceBufferTypes();if(!!n.length){var i=e.live&&r.config.liveBackBufferLength!==null?r.config.liveBackBufferLength:r.config.backBufferLength;if(!(!(0,F.isFiniteNumber)(i)||i<0)){var d=f.currentTime,o=e.levelTargetDuration,t=Math.max(i,o),v=Math.floor(d/o)*o-t;n.forEach(function(s){var h=c[s];if(h){var u=b.BufferHelper.getBuffered(h);u.length>0&&v>u.start(0)&&(r.trigger(A.Events.BACK_BUFFER_REACHED,{bufferEnd:v}),e.live&&r.trigger(A.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:v}),r.trigger(A.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:v,type:s}))}})}}}},p.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var r=this.details,e=this.hls,f=this.media,c=this.mediaSource,n=r.fragments[0].start+r.totalduration,i=f.duration,d=(0,F.isFiniteNumber)(c.duration)?c.duration:0;r.live&&e.config.liveDurationInfinity?(O.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),c.duration=1/0,this.updateSeekableRange(r)):(n>d&&n>i||!(0,F.isFiniteNumber)(i))&&(O.logger.log("[buffer-controller]: Updating Media Source duration to "+n.toFixed(3)),c.duration=n)}},p.updateSeekableRange=function(r){var e=this.mediaSource,f=r.fragments,c=f.length;if(c&&r.live&&e!==null&&e!==void 0&&e.setLiveSeekableRange){var n=Math.max(0,f[0].start),i=Math.max(n,n+r.totalduration);e.setLiveSeekableRange(n,i)}},p.checkPendingTracks=function(){var r=this.bufferCodecEventsExpected,e=this.operationQueue,f=this.pendingTracks,c=Object.keys(f).length;if(c&&!r||c===2){this.createSourceBuffers(f),this.pendingTracks={};var n=this.getSourceBufferTypes();if(n.length===0){this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}n.forEach(function(i){e.executeNext(i)})}},p.createSourceBuffers=function(r){var e=this.sourceBuffer,f=this.mediaSource;if(!f)throw Error("createSourceBuffers called when mediaSource was null");var c=0;for(var n in r)if(!e[n]){var i=r[n];if(!i)throw Error("source buffer exists for track "+n+", however track does not");var d=i.levelCodec||i.codec,o=i.container+";codecs="+d;O.logger.log("[buffer-controller]: creating sourceBuffer("+o+")");try{var t=e[n]=f.addSourceBuffer(o),v=n;this.addBufferListener(v,"updatestart",this._onSBUpdateStart),this.addBufferListener(v,"updateend",this._onSBUpdateEnd),this.addBufferListener(v,"error",this._onSBUpdateError),this.tracks[n]={buffer:t,codec:d,container:i.container,levelCodec:i.levelCodec,metadata:i.metadata,id:i.id},c++}catch(s){O.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+s.message),this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:s,mimeType:o})}}c&&this.hls.trigger(A.Events.BUFFER_CREATED,{tracks:this.tracks})},p._onSBUpdateStart=function(r){var e=this.operationQueue,f=e.current(r);f.onStart()},p._onSBUpdateEnd=function(r){var e=this.operationQueue,f=e.current(r);f.onComplete(),e.shiftAndExecuteNext(r)},p._onSBUpdateError=function(r,e){O.logger.error("[buffer-controller]: "+r+" SourceBuffer error",e),this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var f=this.operationQueue.current(r);f&&f.onError(e)},p.removeExecutor=function(r,e,f){var c=this.media,n=this.mediaSource,i=this.operationQueue,d=this.sourceBuffer,o=d[r];if(!c||!n||!o){O.logger.warn("[buffer-controller]: Attempting to remove from the "+r+" SourceBuffer, but it does not exist"),i.shiftAndExecuteNext(r);return}var t=(0,F.isFiniteNumber)(c.duration)?c.duration:1/0,v=(0,F.isFiniteNumber)(n.duration)?n.duration:1/0,s=Math.max(0,e),h=Math.min(f,t,v);h>s?(O.logger.log("[buffer-controller]: Removing ["+s+","+h+"] from the "+r+" SourceBuffer"),console.assert(!o.updating,r+" sourceBuffer must not be updating"),o.remove(s,h)):i.shiftAndExecuteNext(r)},p.appendExecutor=function(r,e){var f=this.operationQueue,c=this.sourceBuffer,n=c[e];if(!n){O.logger.warn("[buffer-controller]: Attempting to append to the "+e+" SourceBuffer, but it does not exist"),f.shiftAndExecuteNext(e);return}n.ended=!1,console.assert(!n.updating,e+" sourceBuffer must not be updating"),n.appendBuffer(r)},p.blockBuffers=function(r,e){var f=this;if(e===void 0&&(e=this.getSourceBufferTypes()),!e.length){O.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(r);return}var c=this.operationQueue,n=e.map(function(i){return c.appendBlocker(i)});Promise.all(n).then(function(){r(),e.forEach(function(i){var d=f.sourceBuffer[i];(!d||!d.updating)&&c.shiftAndExecuteNext(i)})})},p.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},p.addBufferListener=function(r,e,f){var c=this.sourceBuffer[r];if(!!c){var n=f.bind(this,r);this.listeners[r].push({event:e,listener:n}),c.addEventListener(e,n)}},p.removeBufferListeners=function(r){var e=this.sourceBuffer[r];!e||this.listeners[r].forEach(function(f){e.removeEventListener(f.event,f.listener)})},y}()},"./src/controller/buffer-operation-queue.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>A});var F=D("./src/utils/logger.ts"),A=function(){function O(b){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=b}var R=O.prototype;return R.append=function(I,L){var S=this.queues[L];S.push(I),S.length===1&&this.buffers[L]&&this.executeNext(L)},R.insertAbort=function(I,L){var S=this.queues[L];S.unshift(I),this.executeNext(L)},R.appendBlocker=function(I){var L,S=new Promise(function(_){L=_}),g={execute:L,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(g,I),S},R.executeNext=function(I){var L=this.buffers,S=this.queues,g=L[I],_=S[I];if(_.length){var E=_[0];try{E.execute()}catch(y){F.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),E.onError(y),(!g||!g.updating)&&(_.shift(),this.executeNext(I))}}},R.shiftAndExecuteNext=function(I){this.queues[I].shift(),this.executeNext(I)},R.current=function(I){return this.queues[I][0]},O}()},"./src/controller/cap-level-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>b});var F=D("./src/events.ts");function A(I,L){for(var S=0;S<L.length;S++){var g=L[S];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(I,g.key,g)}}function O(I,L,S){return L&&A(I.prototype,L),S&&A(I,S),Object.defineProperty(I,"prototype",{writable:!1}),I}var R=function(){function I(S){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=S,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var L=I.prototype;return L.setStreamController=function(g){this.streamController=g},L.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},L.registerListeners=function(){var g=this.hls;g.on(F.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.on(F.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.on(F.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},L.unregisterListener=function(){var g=this.hls;g.off(F.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.off(F.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.off(F.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},L.onFpsDropLevelCapping=function(g,_){I.isLevelAllowed(_.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(_.droppedLevel)},L.onMediaAttaching=function(g,_){this.media=_.media instanceof HTMLVideoElement?_.media:null},L.onManifestParsed=function(g,_){var E=this.hls;this.restrictedLevels=[],this.firstLevel=_.firstLevel,E.config.capLevelToPlayerSize&&_.video&&this.startCapping()},L.onBufferCodecs=function(g,_){var E=this.hls;E.config.capLevelToPlayerSize&&_.video&&this.startCapping()},L.onMediaDetaching=function(){this.stopCapping()},L.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var g=this.hls.levels;if(g.length){var _=this.hls;_.autoLevelCapping=this.getMaxLevel(g.length-1),_.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=_.autoLevelCapping}}},L.getMaxLevel=function(g){var _=this,E=this.hls.levels;if(!E.length)return-1;var y=E.filter(function(p,l){return I.isLevelAllowed(l,_.restrictedLevels)&&l<=g});return this.clientRect=null,I.getMaxLevelByMediaSize(y,this.mediaWidth,this.mediaHeight)},L.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},L.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},L.getDimensions=function(){if(this.clientRect)return this.clientRect;var g=this.media,_={width:0,height:0};if(g){var E=g.getBoundingClientRect();_.width=E.width,_.height=E.height,!_.width&&!_.height&&(_.width=E.right-E.left||g.width||0,_.height=E.bottom-E.top||g.height||0)}return this.clientRect=_,_},I.isLevelAllowed=function(g,_){return _===void 0&&(_=[]),_.indexOf(g)===-1},I.getMaxLevelByMediaSize=function(g,_,E){if(!g||!g.length)return-1;for(var y=function(f,c){return c?f.width!==c.width||f.height!==c.height:!0},p=g.length-1,l=0;l<g.length;l+=1){var r=g[l];if((r.width>=_||r.height>=E)&&y(r,g[l+1])){p=l;break}}return p},O(I,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var g=1;if(!this.hls.config.ignoreDevicePixelRatio)try{g=self.devicePixelRatio}catch{}return g}}]),I}();const b=R},"./src/controller/cmcd-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>E});var F=D("./src/events.ts"),A=D("./src/types/cmcd.ts"),O=D("./src/utils/buffer-helper.ts"),R=D("./src/utils/logger.ts");function b(y,p){for(var l=0;l<p.length;l++){var r=p[l];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(y,r.key,r)}}function I(y,p,l){return p&&b(y.prototype,p),l&&b(y,l),Object.defineProperty(y,"prototype",{writable:!1}),y}function L(y,p){var l=typeof Symbol<"u"&&y[Symbol.iterator]||y["@@iterator"];if(l)return(l=l.call(y)).next.bind(l);if(Array.isArray(y)||(l=S(y))||p&&y&&typeof y.length=="number"){l&&(y=l);var r=0;return function(){return r>=y.length?{done:!0}:{done:!1,value:y[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function S(y,p){if(!!y){if(typeof y=="string")return g(y,p);var l=Object.prototype.toString.call(y).slice(8,-1);if(l==="Object"&&y.constructor&&(l=y.constructor.name),l==="Map"||l==="Set")return Array.from(y);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return g(y,p)}}function g(y,p){(p==null||p>y.length)&&(p=y.length);for(var l=0,r=new Array(p);l<p;l++)r[l]=y[l];return r}function _(){return _=Object.assign?Object.assign.bind():function(y){for(var p=1;p<arguments.length;p++){var l=arguments[p];for(var r in l)Object.prototype.hasOwnProperty.call(l,r)&&(y[r]=l[r])}return y},_.apply(this,arguments)}var E=function(){function y(l){var r=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(c){try{r.apply(c,{ot:A.CMCDObjectType.MANIFEST,su:!r.initialized})}catch(n){R.logger.warn("Could not generate manifest CMCD data.",n)}},this.applyFragmentData=function(c){try{var n=c.frag,i=r.hls.levels[n.level],d=r.getObjectType(n),o={d:n.duration*1e3,ot:d};(d===A.CMCDObjectType.VIDEO||d===A.CMCDObjectType.AUDIO||d==A.CMCDObjectType.MUXED)&&(o.br=i.bitrate/1e3,o.tb=r.getTopBandwidth(d)/1e3,o.bl=r.getBufferLength(d)),r.apply(c,o)}catch(t){R.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=l;var e=this.config=l.config,f=e.cmcd;f!=null&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=f.sessionId||y.uuid(),this.cid=f.contentId,this.useHeaders=f.useHeaders===!0,this.registerListeners())}var p=y.prototype;return p.registerListeners=function(){var r=this.hls;r.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),r.on(F.Events.BUFFER_CREATED,this.onBufferCreated,this)},p.unregisterListeners=function(){var r=this.hls;r.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),r.off(F.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},p.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},p.onMediaAttached=function(r,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},p.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},p.onBufferCreated=function(r,e){var f,c;this.audioBuffer=(f=e.tracks.audio)===null||f===void 0?void 0:f.buffer,this.videoBuffer=(c=e.tracks.video)===null||c===void 0?void 0:c.buffer},p.createData=function(){var r;return{v:A.CMCDVersion,sf:A.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(r=this.media)===null||r===void 0?void 0:r.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},p.apply=function(r,e){e===void 0&&(e={}),_(e,this.createData());var f=e.ot===A.CMCDObjectType.INIT||e.ot===A.CMCDObjectType.VIDEO||e.ot===A.CMCDObjectType.MUXED;if(this.starved&&f&&(e.bs=!0,e.su=!0,this.starved=!1),e.su==null&&(e.su=this.buffering),this.useHeaders){var c=y.toHeaders(e);if(!Object.keys(c).length)return;r.headers||(r.headers={}),_(r.headers,c)}else{var n=y.toQuery(e);if(!n)return;r.url=y.appendQueryToUri(r.url,n)}},p.getObjectType=function(r){var e=r.type;if(e==="subtitle")return A.CMCDObjectType.TIMED_TEXT;if(r.sn==="initSegment")return A.CMCDObjectType.INIT;if(e==="audio")return A.CMCDObjectType.AUDIO;if(e==="main")return this.hls.audioTracks.length?A.CMCDObjectType.VIDEO:A.CMCDObjectType.MUXED},p.getTopBandwidth=function(r){var e=0,f,c=this.hls;if(r===A.CMCDObjectType.AUDIO)f=c.audioTracks;else{var n=c.maxAutoLevel,i=n>-1?n+1:c.levels.length;f=c.levels.slice(0,i)}for(var d=L(f),o;!(o=d()).done;){var t=o.value;t.bitrate>e&&(e=t.bitrate)}return e>0?e:NaN},p.getBufferLength=function(r){var e=this.hls.media,f=r===A.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!f||!e)return NaN;var c=O.BufferHelper.bufferInfo(f,e.currentTime,this.config.maxBufferHole);return c.len*1e3},p.createPlaylistLoader=function(){var r=this.config.pLoader,e=this.applyPlaylistData,f=r||this.config.loader;return function(){function c(i){this.loader=void 0,this.loader=new f(i)}var n=c.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(d,o,t){e(d),this.loader.load(d,o,t)},I(c,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),c}()},p.createFragmentLoader=function(){var r=this.config.fLoader,e=this.applyFragmentData,f=r||this.config.loader;return function(){function c(i){this.loader=void 0,this.loader=new f(i)}var n=c.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(d,o,t){e(d),this.loader.load(d,o,t)},I(c,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),c}()},y.uuid=function(){var r=URL.createObjectURL(new Blob),e=r.toString();return URL.revokeObjectURL(r),e.slice(e.lastIndexOf("/")+1)},y.serialize=function(r){for(var e=[],f=function(P){return!Number.isNaN(P)&&P!=null&&P!==""&&P!==!1},c=function(P){return Math.round(P)},n=function(P){return c(P/100)*100},i=function(P){return encodeURIComponent(P)},d={br:c,d:c,bl:n,dl:n,mtp:n,nor:i,rtp:n,tb:c},o=Object.keys(r||{}).sort(),t=L(o),v;!(v=t()).done;){var s=v.value,h=r[s];if(!!f(h)&&!(s==="v"&&h===1)&&!(s=="pr"&&h===1)){var u=d[s];u&&(h=u(h));var a=typeof h,m=void 0;s==="ot"||s==="sf"||s==="st"?m=s+"="+h:a==="boolean"?m=s:a==="number"?m=s+"="+h:m=s+"="+JSON.stringify(h),e.push(m)}}return e.join(",")},y.toHeaders=function(r){for(var e=Object.keys(r),f={},c=["Object","Request","Session","Status"],n=[{},{},{},{}],i={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},d=0,o=e;d<o.length;d++){var t=o[d],v=i[t]!=null?i[t]:1;n[v][t]=r[t]}for(var s=0;s<n.length;s++){var h=y.serialize(n[s]);h&&(f["CMCD-"+c[s]]=h)}return f},y.toQuery=function(r){return"CMCD="+encodeURIComponent(y.serialize(r))},y.appendQueryToUri=function(r,e){if(!e)return r;var f=r.includes("?")?"&":"?";return""+r+f+e},y}()},"./src/controller/eme-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>E});var F=D("./src/events.ts"),A=D("./src/errors.ts"),O=D("./src/utils/logger.ts"),R=D("./src/utils/mediakeys-helper.ts");function b(y,p){for(var l=0;l<p.length;l++){var r=p[l];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(y,r.key,r)}}function I(y,p,l){return p&&b(y.prototype,p),l&&b(y,l),Object.defineProperty(y,"prototype",{writable:!1}),y}var L=3,S=function(p,l,r){var e={audioCapabilities:[],videoCapabilities:[]};return p.forEach(function(f){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+f+'"',robustness:r.audioRobustness||""})}),l.forEach(function(f){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+f+'"',robustness:r.videoRobustness||""})}),[e]},g=function(p,l,r,e){switch(p){case R.KeySystems.WIDEVINE:return S(l,r,e);default:throw new Error("Unknown key-system: "+p)}},_=function(){function y(l){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=l,this._config=l.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var p=y.prototype;return p.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},p._registerListeners=function(){this.hls.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this)},p._unregisterListeners=function(){this.hls.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this)},p.getLicenseServerUrl=function(r){switch(r){case R.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+r+'"')},p._attemptKeySystemAccess=function(r,e,f){var c=this,n=g(r,e,f,this._drmSystemOptions);O.logger.log("Requesting encrypted media key-system access");var i=this.requestMediaKeySystemAccess(r,n);this.mediaKeysPromise=i.then(function(d){return c._onMediaKeySystemAccessObtained(r,d)}),i.catch(function(d){O.logger.error('Failed to obtain key-system "'+r+'" access:',d)})},p._onMediaKeySystemAccessObtained=function(r,e){var f=this;O.logger.log('Access for key-system "'+r+'" obtained');var c={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:r};this._mediaKeysList.push(c);var n=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(i){return c.mediaKeys=i,O.logger.log('Media-keys created for key-system "'+r+'"'),f._onMediaKeysCreated(),i});return n.catch(function(i){O.logger.error("Failed to create media-keys:",i)}),n},p._onMediaKeysCreated=function(){var r=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),r._onNewMediaKeySession(e.mediaKeysSession))})},p._onNewMediaKeySession=function(r){var e=this;O.logger.log("New key-system session "+r.sessionId),r.addEventListener("message",function(f){e._onKeySessionMessage(r,f.message)},!1)},p._onKeySessionMessage=function(r,e){O.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(f){O.logger.log("Received license data (length: "+(f&&f.byteLength)+"), updating key-session"),r.update(f).catch(function(c){O.logger.warn("Updating key-session failed: "+c)})})},p.onMediaEncrypted=function(r){var e=this;if(O.logger.log('Media is encrypted using "'+r.initDataType+'" init data type'),!this.mediaKeysPromise){O.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(F.Events.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var f=function(n){!e._media||(e._attemptSetMediaKeys(n),e._generateRequestWithPreferredKeySession(r.initDataType,r.initData))};this.mediaKeysPromise.then(f).catch(f)},p._attemptSetMediaKeys=function(r){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){O.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(F.Events.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}O.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},p._generateRequestWithPreferredKeySession=function(r,e){var f=this,c=this._mediaKeysList[0];if(!c){O.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(F.Events.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(c.mediaKeysSessionInitialized){O.logger.warn("Key-Session already initialized but requested again");return}var n=c.mediaKeysSession;if(!n){O.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(F.Events.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!e){O.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(F.Events.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}O.logger.log('Generating key-session request for "'+r+'" init data type'),c.mediaKeysSessionInitialized=!0,n.generateRequest(r,e).then(function(){O.logger.debug("Key-session generation succeeded")}).catch(function(i){O.logger.error("Error generating key-session request:",i),f.hls.trigger(F.Events.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},p._createLicenseXhr=function(r,e,f){var c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,c,r,e,f);var n=this._licenseXhrSetup;if(n)try{n.call(this.hls,c,r),n=void 0}catch(i){O.logger.error(i)}try{c.readyState||c.open("POST",r,!0),n&&n.call(this.hls,c,r)}catch(i){throw new Error("issue setting up KeySystem license XHR "+i)}return c},p._onLicenseRequestReadyStageChange=function(r,e,f,c){switch(r.readyState){case 4:if(r.status===200){this._requestLicenseFailureCount=0,O.logger.log("License request succeeded");var n=r.response,i=this._licenseResponseCallback;if(i)try{n=i.call(this.hls,r,e)}catch(o){O.logger.error(o)}c(n)}else{if(O.logger.error("License Request XHR failed ("+e+"). Status: "+r.status+" ("+r.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>L){this.hls.trigger(F.Events.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var d=L-this._requestLicenseFailureCount+1;O.logger.warn("Retrying license request, "+d+" attempts left"),this._requestLicense(f,c)}break}},p._generateLicenseRequestChallenge=function(r,e){switch(r.mediaKeySystemDomain){case R.KeySystems.WIDEVINE:return e}throw new Error("unsupported key-system: "+r.mediaKeySystemDomain)},p._requestLicense=function(r,e){O.logger.log("Requesting content license for key-system");var f=this._mediaKeysList[0];if(!f){O.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(F.Events.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var c=this.getLicenseServerUrl(f.mediaKeySystemDomain),n=this._createLicenseXhr(c,r,e);O.logger.log("Sending license request to URL: "+c);var i=this._generateLicenseRequestChallenge(f,r);n.send(i)}catch(d){O.logger.error("Failure requesting DRM license: "+d),this.hls.trigger(F.Events.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},p.onMediaAttached=function(r,e){if(!!this._emeEnabled){var f=e.media;this._media=f,f.addEventListener("encrypted",this._onMediaEncrypted)}},p.onMediaDetached=function(){var r=this._media,e=this._mediaKeysList;!r||(r.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(f){if(f.mediaKeysSession)return f.mediaKeysSession.close().catch(function(){})})).then(function(){return r.setMediaKeys(null)}).catch(function(){}))},p.onManifestParsed=function(r,e){if(!!this._emeEnabled){var f=e.levels.map(function(n){return n.audioCodec}).filter(function(n){return!!n}),c=e.levels.map(function(n){return n.videoCodec}).filter(function(n){return!!n});this._attemptKeySystemAccess(R.KeySystems.WIDEVINE,f,c)}},I(y,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),y}();const E=_},"./src/controller/fps-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>R});var F=D("./src/events.ts"),A=D("./src/utils/logger.ts"),O=function(){function b(L){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=L,this.registerListeners()}var I=b.prototype;return I.setStreamController=function(S){this.streamController=S},I.registerListeners=function(){this.hls.on(F.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},I.unregisterListeners=function(){this.hls.off(F.Events.MEDIA_ATTACHING,this.onMediaAttaching)},I.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},I.onMediaAttaching=function(S,g){var _=this.hls.config;if(_.capLevelOnFPSDrop){var E=g.media instanceof self.HTMLVideoElement?g.media:null;this.media=E,E&&typeof E.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),_.fpsDroppedMonitoringPeriod)}},I.checkFPS=function(S,g,_){var E=performance.now();if(g){if(this.lastTime){var y=E-this.lastTime,p=_-this.lastDroppedFrames,l=g-this.lastDecodedFrames,r=1e3*p/y,e=this.hls;if(e.trigger(F.Events.FPS_DROP,{currentDropped:p,currentDecoded:l,totalDroppedFrames:_}),r>0&&p>e.config.fpsDroppedMonitoringThreshold*l){var f=e.currentLevel;A.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=f)&&(f=f-1,e.trigger(F.Events.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:e.currentLevel}),e.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=E,this.lastDroppedFrames=_,this.lastDecodedFrames=g}},I.checkFPSInterval=function(){var S=this.media;if(S)if(this.isVideoPlaybackQualityAvailable){var g=S.getVideoPlaybackQuality();this.checkFPS(S,g.totalVideoFrames,g.droppedVideoFrames)}else this.checkFPS(S,S.webkitDecodedFrameCount,S.webkitDroppedFrameCount)},b}();const R=O},"./src/controller/fragment-finders.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{findFragWithCC:()=>L,findFragmentByPDT:()=>O,findFragmentByPTS:()=>R,fragmentWithinToleranceTest:()=>b,pdtWithinToleranceTest:()=>I});var F=D("./src/polyfills/number.ts"),A=D("./src/utils/binary-search.ts");function O(S,g,_){if(g===null||!Array.isArray(S)||!S.length||!(0,F.isFiniteNumber)(g))return null;var E=S[0].programDateTime;if(g<(E||0))return null;var y=S[S.length-1].endProgramDateTime;if(g>=(y||0))return null;_=_||0;for(var p=0;p<S.length;++p){var l=S[p];if(I(g,_,l))return l}return null}function R(S,g,_,E){_===void 0&&(_=0),E===void 0&&(E=0);var y=null;if(S?y=g[S.sn-g[0].sn+1]||null:_===0&&g[0].start===0&&(y=g[0]),y&&b(_,E,y)===0)return y;var p=A.default.search(g,b.bind(null,_,E));return p||y}function b(S,g,_){S===void 0&&(S=0),g===void 0&&(g=0);var E=Math.min(g,_.duration+(_.deltaPTS?_.deltaPTS:0));return _.start+_.duration-E<=S?1:_.start-E>S&&_.start?-1:0}function I(S,g,_){var E=Math.min(g,_.duration+(_.deltaPTS?_.deltaPTS:0))*1e3,y=_.endProgramDateTime||0;return y-E>S}function L(S,g){return A.default.search(S,function(_){return _.cc<g?1:_.cc>g?-1:0})}},"./src/controller/fragment-tracker.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{FragmentState:()=>O,FragmentTracker:()=>R});var F=D("./src/events.ts"),A=D("./src/types/loader.ts"),O;(function(L){L.NOT_LOADED="NOT_LOADED",L.APPENDING="APPENDING",L.PARTIAL="PARTIAL",L.OK="OK"})(O||(O={}));var R=function(){function L(g){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=g,this._registerListeners()}var S=L.prototype;return S._registerListeners=function(){var _=this.hls;_.on(F.Events.BUFFER_APPENDED,this.onBufferAppended,this),_.on(F.Events.FRAG_BUFFERED,this.onFragBuffered,this),_.on(F.Events.FRAG_LOADED,this.onFragLoaded,this)},S._unregisterListeners=function(){var _=this.hls;_.off(F.Events.BUFFER_APPENDED,this.onBufferAppended,this),_.off(F.Events.FRAG_BUFFERED,this.onFragBuffered,this),_.off(F.Events.FRAG_LOADED,this.onFragLoaded,this)},S.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},S.getAppendedFrag=function(_,E){if(E===A.PlaylistLevelType.MAIN){var y=this.activeFragment,p=this.activeParts;if(!y)return null;if(p)for(var l=p.length;l--;){var r=p[l],e=r?r.end:y.appendedPTS;if(r.start<=_&&e!==void 0&&_<=e)return l>9&&(this.activeParts=p.slice(l-9)),r}else if(y.start<=_&&y.appendedPTS!==void 0&&_<=y.appendedPTS)return y}return this.getBufferedFrag(_,E)},S.getBufferedFrag=function(_,E){for(var y=this.fragments,p=Object.keys(y),l=p.length;l--;){var r=y[p[l]];if(r?.body.type===E&&r.buffered){var e=r.body;if(e.start<=_&&_<=e.end)return e}}return null},S.detectEvictedFragments=function(_,E,y){var p=this;Object.keys(this.fragments).forEach(function(l){var r=p.fragments[l];if(!!r){if(!r.buffered){r.body.type===y&&p.removeFragment(r.body);return}var e=r.range[_];!e||e.time.some(function(f){var c=!p.isTimeBuffered(f.startPTS,f.endPTS,E);return c&&p.removeFragment(r.body),c})}})},S.detectPartialFragments=function(_){var E=this,y=this.timeRanges,p=_.frag,l=_.part;if(!(!y||p.sn==="initSegment")){var r=I(p),e=this.fragments[r];!e||(Object.keys(y).forEach(function(f){var c=p.elementaryStreams[f];if(!!c){var n=y[f],i=l!==null||c.partial===!0;e.range[f]=E.getBufferedTimes(p,l,i,n)}}),e.loaded=null,Object.keys(e.range).length?e.buffered=!0:this.removeFragment(e.body))}},S.fragBuffered=function(_){var E=I(_),y=this.fragments[E];y&&(y.loaded=null,y.buffered=!0)},S.getBufferedTimes=function(_,E,y,p){for(var l={time:[],partial:y},r=E?E.start:_.start,e=E?E.end:_.end,f=_.minEndPTS||e,c=_.maxStartPTS||r,n=0;n<p.length;n++){var i=p.start(n)-this.bufferPadding,d=p.end(n)+this.bufferPadding;if(c>=i&&f<=d){l.time.push({startPTS:Math.max(r,p.start(n)),endPTS:Math.min(e,p.end(n))});break}else if(r<d&&e>i)l.partial=!0,l.time.push({startPTS:Math.max(r,p.start(n)),endPTS:Math.min(e,p.end(n))});else if(e<=i)break}return l},S.getPartialFragment=function(_){var E=null,y,p,l,r=0,e=this.bufferPadding,f=this.fragments;return Object.keys(f).forEach(function(c){var n=f[c];!n||b(n)&&(p=n.body.start-e,l=n.body.end+e,_>=p&&_<=l&&(y=Math.min(_-p,l-_),r<=y&&(E=n.body,r=y)))}),E},S.getState=function(_){var E=I(_),y=this.fragments[E];return y?y.buffered?b(y)?O.PARTIAL:O.OK:O.APPENDING:O.NOT_LOADED},S.isTimeBuffered=function(_,E,y){for(var p,l,r=0;r<y.length;r++){if(p=y.start(r)-this.bufferPadding,l=y.end(r)+this.bufferPadding,_>=p&&E<=l)return!0;if(E<=p)return!1}return!1},S.onFragLoaded=function(_,E){var y=E.frag,p=E.part;if(!(y.sn==="initSegment"||y.bitrateTest||p)){var l=I(y);this.fragments[l]={body:y,loaded:E,buffered:!1,range:Object.create(null)}}},S.onBufferAppended=function(_,E){var y=this,p=E.frag,l=E.part,r=E.timeRanges;if(p.type===A.PlaylistLevelType.MAIN)if(this.activeFragment=p,l){var e=this.activeParts;e||(this.activeParts=e=[]),e.push(l)}else this.activeParts=null;this.timeRanges=r,Object.keys(r).forEach(function(f){var c=r[f];if(y.detectEvictedFragments(f,c),!l)for(var n=0;n<c.length;n++)p.appendedPTS=Math.max(c.end(n),p.appendedPTS||0)})},S.onFragBuffered=function(_,E){this.detectPartialFragments(E)},S.hasFragment=function(_){var E=I(_);return!!this.fragments[E]},S.removeFragmentsInRange=function(_,E,y){var p=this;Object.keys(this.fragments).forEach(function(l){var r=p.fragments[l];if(!!r&&r.buffered){var e=r.body;e.type===y&&e.start<E&&e.end>_&&p.removeFragment(e)}})},S.removeFragment=function(_){var E=I(_);_.stats.loaded=0,_.clearElementaryStreamInfo(),delete this.fragments[E]},S.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},L}();function b(L){var S,g;return L.buffered&&(((S=L.range.video)===null||S===void 0?void 0:S.partial)||((g=L.range.audio)===null||g===void 0?void 0:g.partial))}function I(L){return L.type+"_"+L.level+"_"+L.urlId+"_"+L.sn}},"./src/controller/gap-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{MAX_START_GAP_JUMP:()=>I,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>L,SKIP_BUFFER_RANGE_START:()=>S,STALL_MINIMUM_DURATION_MS:()=>b,default:()=>g});var F=D("./src/utils/buffer-helper.ts"),A=D("./src/errors.ts"),O=D("./src/events.ts"),R=D("./src/utils/logger.ts"),b=250,I=2,L=.1,S=.05,g=function(){function _(y,p,l,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=y,this.media=p,this.fragmentTracker=l,this.hls=r}var E=_.prototype;return E.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},E.poll=function(p,l){var r=this.config,e=this.media,f=this.stalled;if(e!==null){var c=e.currentTime,n=e.seeking,i=this.seeking&&!n,d=!this.seeking&&n;if(this.seeking=n,c!==p){if(this.moved=!0,f!==null){if(this.stallReported){var o=self.performance.now()-f;R.logger.warn("playback not stuck anymore @"+c+", after "+Math.round(o)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((d||i)&&(this.stalled=null),!(e.paused&&!n||e.ended||e.playbackRate===0||!F.BufferHelper.getBuffered(e).length)){var t=F.BufferHelper.bufferInfo(e,c,0),v=t.len>0,s=t.nextStart||0;if(!(!v&&!s)){if(n){var h=t.len>I,u=!s||l&&l.start<=c||s-c>I&&!this.fragmentTracker.getPartialFragment(c);if(h||u)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var a,m=Math.max(s,t.start||0)-c,T=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,P=T==null||(a=T.details)===null||a===void 0?void 0:a.live,M=P?T.details.targetduration*2:I;if(m>0&&m<=M){this._trySkipBufferHole(null);return}}var C=self.performance.now();if(f===null){this.stalled=C;return}var x=C-f;if(!(!n&&x>=b&&(this._reportStall(t),!this.media))){var U=F.BufferHelper.bufferInfo(e,c,r.maxBufferHole);this._tryFixBufferStall(U,x)}}}}},E._tryFixBufferStall=function(p,l){var r=this.config,e=this.fragmentTracker,f=this.media;if(f!==null){var c=f.currentTime,n=e.getPartialFragment(c);if(n){var i=this._trySkipBufferHole(n);if(i||!this.media)return}p.len>r.maxBufferHole&&l>r.highBufferWatchdogPeriod*1e3&&(R.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},E._reportStall=function(p){var l=this.hls,r=this.media,e=this.stallReported;!e&&r&&(this.stallReported=!0,R.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer ("+JSON.stringify(p)+")"),l.trigger(O.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:p.len}))},E._trySkipBufferHole=function(p){var l=this.config,r=this.hls,e=this.media;if(e===null)return 0;for(var f=e.currentTime,c=0,n=F.BufferHelper.getBuffered(e),i=0;i<n.length;i++){var d=n.start(i);if(f+l.maxBufferHole>=c&&f<d){var o=Math.max(d+S,e.currentTime+L);return R.logger.warn("skipping hole, adjusting currentTime from "+f+" to "+o),this.moved=!0,this.stalled=null,e.currentTime=o,p&&r.trigger(O.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+f+" to "+o,frag:p}),o}c=n.end(i)}return 0},E._tryNudgeBuffer=function(){var p=this.config,l=this.hls,r=this.media,e=this.nudgeRetry;if(r!==null){var f=r.currentTime;if(this.nudgeRetry++,e<p.nudgeMaxRetry){var c=f+(e+1)*p.nudgeOffset;R.logger.warn("Nudging 'currentTime' from "+f+" to "+c),r.currentTime=c,l.trigger(O.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else R.logger.error("Playhead still not moving while enough data buffered @"+f+" after "+p.nudgeMaxRetry+" nudges"),l.trigger(O.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},_}()},"./src/controller/id3-track-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>p});var F=D("./src/polyfills/number.ts"),A=D("./src/events.ts"),O=D("./src/utils/texttrack-utils.ts"),R=D("./src/demux/id3.ts"),b=D("./src/loader/date-range.ts"),I=D("./src/types/demuxer.ts"),L=.25;function S(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var g=function(){var l=S();try{new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function _(l,r){return l.getTime()/1e3-r}function E(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var y=function(){function l(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var r=l.prototype;return r.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},r._registerListeners=function(){var f=this.hls;f.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(A.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),f.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),f.on(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},r._unregisterListeners=function(){var f=this.hls;f.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(A.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),f.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),f.off(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},r.onMediaAttached=function(f,c){this.media=c.media},r.onMediaDetaching=function(){!this.id3Track||((0,O.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},r.onManifestLoading=function(){this.dateRangeCuesAppended={}},r.createTrack=function(f){var c=this.getID3Track(f.textTracks);return c.mode="hidden",c},r.getID3Track=function(f){if(!!this.media){for(var c=0;c<f.length;c++){var n=f[c];if(n.kind==="metadata"&&n.label==="id3")return(0,O.sendAddTrackEvent)(n,this.media),n}return this.media.addTextTrack("metadata","id3")}},r.onFragParsingMetadata=function(f,c){if(!!this.media){var n=this.hls.config,i=n.enableEmsgMetadataCues,d=n.enableID3MetadataCues;if(!(!i&&!d)){var o=c.frag,t=c.samples,v=c.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var s=S(),h=0;h<t.length;h++){var u=t[h].type;if(!(u===I.MetadataSchema.emsg&&!i||!d)){var a=R.getID3Frames(t[h].data);if(a){var m=t[h].pts,T=m+t[h].duration;T>g&&(T=g);var P=T-m;P<=0&&(T=m+L);for(var M=0;M<a.length;M++){var C=a[M];if(!R.isTimeStampFrame(C)){this.updateId3CueEnds(m);var x=new s(m,T,"");x.value=C,u&&(x.type=u),this.id3Track.addCue(x)}}}}}}}},r.updateId3CueEnds=function(f){var c,n=(c=this.id3Track)===null||c===void 0?void 0:c.cues;if(n)for(var i=n.length;i--;){var d=n[i];d.startTime<f&&d.endTime===g&&(d.endTime=f)}},r.onBufferFlushing=function(f,c){var n=c.startOffset,i=c.endOffset,d=c.type,o=this.id3Track,t=this.hls;if(!!t){var v=t.config,s=v.enableEmsgMetadataCues,h=v.enableID3MetadataCues;if(o&&(s||h)){var u;d==="audio"?u=function(m){return m.type===I.MetadataSchema.audioId3&&h}:d==="video"?u=function(m){return m.type===I.MetadataSchema.emsg&&s}:u=function(m){return m.type===I.MetadataSchema.audioId3&&h||m.type===I.MetadataSchema.emsg&&s},(0,O.removeCuesInRange)(o,n,i,u)}}},r.onLevelUpdated=function(f,c){var n=this,i=c.details;if(!(!this.media||!i.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var d=this.dateRangeCuesAppended,o=this.id3Track,t=i.dateRanges,v=Object.keys(t);if(o)for(var s=Object.keys(d).filter(function(C){return!v.includes(C)}),h=function(x){var U=s[x];Object.keys(d[U].cues).forEach(function(k){o.removeCue(d[U].cues[k])}),delete d[U]},u=s.length;u--;)h(u);var a=i.fragments[i.fragments.length-1];if(!(v.length===0||!(0,F.isFiniteNumber)(a?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var m=a.programDateTime/1e3-a.start,T=S(),P=function(x){var U=v[x],k=t[U],w=d[U],N=w?.cues||{},K=w?.durationKnown||!1,G=_(k.startDate,m),H=g,V=k.endDate;if(V)H=_(V,m),K=!0;else if(k.endOnNext&&!K){var X=v.reduce(function(J,Z){var q=t[Z];return q.class===k.class&&q.id!==Z&&q.startDate>k.startDate&&J.push(q),J},[]).sort(function(J,Z){return J.startDate.getTime()-Z.startDate.getTime()})[0];X&&(H=_(X.startDate,m),K=!0)}for(var Y=Object.keys(k.attr),Q=0;Q<Y.length;Q++){var $=Y[Q];if(!($===b.DateRangeAttribute.ID||$===b.DateRangeAttribute.CLASS||$===b.DateRangeAttribute.START_DATE||$===b.DateRangeAttribute.DURATION||$===b.DateRangeAttribute.END_DATE||$===b.DateRangeAttribute.END_ON_NEXT)){var z=N[$];if(z)K&&!w.durationKnown&&(z.endTime=H);else{var j=k.attr[$];z=new T(G,H,""),($===b.DateRangeAttribute.SCTE35_OUT||$===b.DateRangeAttribute.SCTE35_IN)&&(j=E(j)),z.value={key:$,data:j},z.type=I.MetadataSchema.dateRange,n.id3Track.addCue(z),N[$]=z}}}d[U]={cues:N,dateRange:k,durationKnown:K}},M=0;M<v.length;M++)P(M)}}},l}();const p=y},"./src/controller/latency-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>I});var F=D("./src/errors.ts"),A=D("./src/events.ts"),O=D("./src/utils/logger.ts");function R(L,S){for(var g=0;g<S.length;g++){var _=S[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(L,_.key,_)}}function b(L,S,g){return S&&R(L.prototype,S),g&&R(L,g),Object.defineProperty(L,"prototype",{writable:!1}),L}var I=function(){function L(g){var _=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return _.timeupdate()},this.hls=g,this.config=g.config,this.registerListeners()}var S=L.prototype;return S.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},S.registerListeners=function(){this.hls.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(A.Events.ERROR,this.onError,this)},S.unregisterListeners=function(){this.hls.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(A.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(A.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(A.Events.ERROR,this.onError)},S.onMediaAttached=function(_,E){this.media=E.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},S.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},S.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},S.onLevelUpdated=function(_,E){var y=E.details;this.levelDetails=y,y.advanced&&this.timeupdate(),!y.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},S.onError=function(_,E){E.details===F.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,O.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},S.timeupdate=function(){var _=this.media,E=this.levelDetails;if(!(!_||!E)){this.currentTime=_.currentTime;var y=this.computeLatency();if(y!==null){this._latency=y;var p=this.config,l=p.lowLatencyMode,r=p.maxLiveSyncPlaybackRate;if(!(!l||r===1)){var e=this.targetLatency;if(e!==null){var f=y-e,c=Math.min(this.maxLatency,e+E.targetduration),n=f<c;if(E.live&&n&&f>.05&&this.forwardBufferLength>1){var i=Math.min(2,Math.max(1,r)),d=Math.round(2/(1+Math.exp(-.75*f-this.edgeStalled))*20)/20;_.playbackRate=Math.min(i,Math.max(1,d))}else _.playbackRate!==1&&_.playbackRate!==0&&(_.playbackRate=1)}}}}},S.estimateLiveEdge=function(){var _=this.levelDetails;return _===null?null:_.edge+_.age},S.computeLatency=function(){var _=this.estimateLiveEdge();return _===null?null:_-this.currentTime},b(L,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var _=this.config,E=this.levelDetails;return _.liveMaxLatencyDuration!==void 0?_.liveMaxLatencyDuration:E?_.liveMaxLatencyDurationCount*E.targetduration:0}},{key:"targetLatency",get:function(){var _=this.levelDetails;if(_===null)return null;var E=_.holdBack,y=_.partHoldBack,p=_.targetduration,l=this.config,r=l.liveSyncDuration,e=l.liveSyncDurationCount,f=l.lowLatencyMode,c=this.hls.userConfig,n=f&&y||E;(c.liveSyncDuration||c.liveSyncDurationCount||n===0)&&(n=r!==void 0?r:e*p);var i=p,d=1;return n+Math.min(this.stallCount*d,i)}},{key:"liveSyncPosition",get:function(){var _=this.estimateLiveEdge(),E=this.targetLatency,y=this.levelDetails;if(_===null||E===null||y===null)return null;var p=y.edge,l=_-E-this.edgeStalled,r=p-y.totalduration,e=p-(this.config.lowLatencyMode&&y.partTarget||y.targetduration);return Math.min(Math.max(r,l),e)}},{key:"drift",get:function(){var _=this.levelDetails;return _===null?1:_.drift}},{key:"edgeStalled",get:function(){var _=this.levelDetails;if(_===null)return 0;var E=(this.config.lowLatencyMode&&_.partTarget||_.targetduration)*3;return Math.max(_.age-E,0)}},{key:"forwardBufferLength",get:function(){var _=this.media,E=this.levelDetails;if(!_||!E)return 0;var y=_.buffered.length;return(y?_.buffered.end(y-1):E.edge)-this.currentTime}}]),L}()},"./src/controller/level-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>l});var F=D("./src/types/level.ts"),A=D("./src/events.ts"),O=D("./src/errors.ts"),R=D("./src/utils/codecs.ts"),b=D("./src/controller/level-helper.ts"),I=D("./src/controller/base-playlist-controller.ts"),L=D("./src/types/loader.ts");function S(){return S=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var f=arguments[e];for(var c in f)Object.prototype.hasOwnProperty.call(f,c)&&(r[c]=f[c])}return r},S.apply(this,arguments)}function g(r,e){for(var f=0;f<e.length;f++){var c=e[f];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,c.key,c)}}function _(r,e,f){return e&&g(r.prototype,e),f&&g(r,f),Object.defineProperty(r,"prototype",{writable:!1}),r}function E(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,y(r,e)}function y(r,e){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,n){return c.__proto__=n,c},y(r,e)}var p=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),l=function(r){E(e,r);function e(c){var n;return n=r.call(this,c,"[level-controller]")||this,n._levels=[],n._firstLevel=-1,n._startLevel=void 0,n.currentLevelIndex=-1,n.manualLevelIndex=-1,n.onParsedComplete=void 0,n._registerListeners(),n}var f=e.prototype;return f._registerListeners=function(){var n=this.hls;n.on(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),n.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(A.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.on(A.Events.FRAG_LOADED,this.onFragLoaded,this),n.on(A.Events.ERROR,this.onError,this)},f._unregisterListeners=function(){var n=this.hls;n.off(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),n.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(A.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.off(A.Events.FRAG_LOADED,this.onFragLoaded,this),n.off(A.Events.ERROR,this.onError,this)},f.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,r.prototype.destroy.call(this)},f.startLoad=function(){var n=this._levels;n.forEach(function(i){i.loadError=0}),r.prototype.startLoad.call(this)},f.onManifestLoaded=function(n,i){var d=[],o=[],t=[],v,s={},h,u=!1,a=!1,m=!1;if(i.levels.forEach(function(C){var x=C.attrs;u=u||!!(C.width&&C.height),a=a||!!C.videoCodec,m=m||!!C.audioCodec,p&&C.audioCodec&&C.audioCodec.indexOf("mp4a.40.34")!==-1&&(C.audioCodec=void 0);var U=C.bitrate+"-"+C.attrs.RESOLUTION+"-"+C.attrs.CODECS;h=s[U],h?h.url.push(C.url):(h=new F.Level(C),s[U]=h,d.push(h)),x&&(x.AUDIO&&(0,b.addGroupId)(h,"audio",x.AUDIO),x.SUBTITLES&&(0,b.addGroupId)(h,"text",x.SUBTITLES))}),(u||a)&&m&&(d=d.filter(function(C){var x=C.videoCodec,U=C.width,k=C.height;return!!x||!!(U&&k)})),d=d.filter(function(C){var x=C.audioCodec,U=C.videoCodec;return(!x||(0,R.isCodecSupportedInMp4)(x,"audio"))&&(!U||(0,R.isCodecSupportedInMp4)(U,"video"))}),i.audioTracks&&(o=i.audioTracks.filter(function(C){return!C.audioCodec||(0,R.isCodecSupportedInMp4)(C.audioCodec,"audio")}),(0,b.assignTrackIdsByGroup)(o)),i.subtitles&&(t=i.subtitles,(0,b.assignTrackIdsByGroup)(t)),d.length>0){v=d[0].bitrate,d.sort(function(C,x){return C.bitrate-x.bitrate}),this._levels=d;for(var T=0;T<d.length;T++)if(d[T].bitrate===v){this._firstLevel=T,this.log("manifest loaded, "+d.length+" level(s) found, first bitrate: "+v);break}var P=m&&!a,M={levels:d,audioTracks:o,subtitleTracks:t,firstLevel:this._firstLevel,stats:i.stats,audio:m,video:a,altAudio:!P&&o.some(function(C){return!!C.url})};this.hls.trigger(A.Events.MANIFEST_PARSED,M),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:i.url,reason:"no level with compatible codecs found in manifest"})},f.onError=function(n,i){var d;if(r.prototype.onError.call(this,n,i),!i.fatal){var o=i.context,t=this._levels[this.currentLevelIndex];if(o&&(o.type===L.PlaylistContextType.AUDIO_TRACK&&t.audioGroupIds&&o.groupId===t.audioGroupIds[t.urlId]||o.type===L.PlaylistContextType.SUBTITLE_TRACK&&t.textGroupIds&&o.groupId===t.textGroupIds[t.urlId])){this.redundantFailover(this.currentLevelIndex);return}var v=!1,s=!0,h;switch(i.details){case O.ErrorDetails.FRAG_LOAD_ERROR:case O.ErrorDetails.FRAG_LOAD_TIMEOUT:case O.ErrorDetails.KEY_LOAD_ERROR:case O.ErrorDetails.KEY_LOAD_TIMEOUT:if(i.frag){var u=i.frag.type===L.PlaylistLevelType.MAIN?i.frag.level:this.currentLevelIndex,a=this._levels[u];a?(a.fragmentError++,a.fragmentError>this.hls.config.fragLoadingMaxRetry&&(h=u)):h=u}break;case O.ErrorDetails.LEVEL_LOAD_ERROR:case O.ErrorDetails.LEVEL_LOAD_TIMEOUT:o&&(o.deliveryDirectives&&(s=!1),h=o.level),v=!0;break;case O.ErrorDetails.REMUX_ALLOC_ERROR:h=(d=i.level)!=null?d:this.currentLevelIndex,v=!0;break}h!==void 0&&this.recoverLevel(i,h,v,s)}},f.recoverLevel=function(n,i,d,o){var t=n.details,v=this._levels[i];if(v.loadError++,d){var s=this.retryLoadingOrFail(n);if(s)n.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(o){var h=v.url.length;if(h>1&&v.loadError<h)n.levelRetry=!0,this.redundantFailover(i);else if(this.manualLevelIndex===-1){for(var u=-1,a=this._levels,m=a.length;m--;){var T=(m+this.currentLevelIndex)%a.length;if(T!==this.currentLevelIndex&&a[T].loadError===0){u=T;break}}u>-1&&this.currentLevelIndex!==u&&(this.warn(t+": switch to "+u),n.levelRetry=!0,this.hls.nextAutoLevel=u)}}},f.redundantFailover=function(n){var i=this._levels[n],d=i.url.length;if(d>1){var o=(i.urlId+1)%d;this.warn("Switching to redundant URL-id "+o),this._levels.forEach(function(t){t.urlId=o}),this.level=n}},f.onFragLoaded=function(n,i){var d=i.frag;if(d!==void 0&&d.type===L.PlaylistLevelType.MAIN){var o=this._levels[d.level];o!==void 0&&(o.fragmentError=0,o.loadError=0)}},f.onLevelLoaded=function(n,i){var d,o=i.level,t=i.details,v=this._levels[o];if(!v){var s;this.warn("Invalid level index "+o),(s=i.deliveryDirectives)!==null&&s!==void 0&&s.skip&&(t.deltaUpdateFailed=!0);return}o===this.currentLevelIndex?(v.fragmentError===0&&(v.loadError=0,this.retryCount=0),this.playlistLoaded(o,i,v.details)):(d=i.deliveryDirectives)!==null&&d!==void 0&&d.skip&&(t.deltaUpdateFailed=!0)},f.onAudioTrackSwitched=function(n,i){var d=this.hls.levels[this.currentLevelIndex];if(!!d&&d.audioGroupIds){for(var o=-1,t=this.hls.audioTracks[i.id].groupId,v=0;v<d.audioGroupIds.length;v++)if(d.audioGroupIds[v]===t){o=v;break}o!==d.urlId&&(d.urlId=o,this.startLoad())}},f.loadPlaylist=function(n){var i=this.currentLevelIndex,d=this._levels[i];if(this.canLoad&&d&&d.url.length>0){var o=d.urlId,t=d.url[o];if(n)try{t=n.addDirectives(t)}catch(v){this.warn("Could not construct new URL with HLS Delivery Directives: "+v)}this.log("Attempt loading level index "+i+(n?" at sn "+n.msn+" part "+n.part:"")+" with URL-id "+o+" "+t),this.clearTimer(),this.hls.trigger(A.Events.LEVEL_LOADING,{url:t,level:i,id:o,deliveryDirectives:n||null})}},f.removeLevel=function(n,i){var d=function(v,s){return s!==i},o=this._levels.filter(function(t,v){return v!==n?!0:t.url.length>1&&i!==void 0?(t.url=t.url.filter(d),t.audioGroupIds&&(t.audioGroupIds=t.audioGroupIds.filter(d)),t.textGroupIds&&(t.textGroupIds=t.textGroupIds.filter(d)),t.urlId=0,!0):!1}).map(function(t,v){var s=t.details;return s!=null&&s.fragments&&s.fragments.forEach(function(h){h.level=v}),t});this._levels=o,this.hls.trigger(A.Events.LEVELS_UPDATED,{levels:o})},_(e,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(n){var i,d=this._levels;if(d.length!==0&&!(this.currentLevelIndex===n&&(i=d[n])!==null&&i!==void 0&&i.details)){if(n<0||n>=d.length){var o=n<0;if(this.hls.trigger(A.Events.ERROR,{type:O.ErrorTypes.OTHER_ERROR,details:O.ErrorDetails.LEVEL_SWITCH_ERROR,level:n,fatal:o,reason:"invalid level idx"}),o)return;n=Math.min(n,d.length-1)}this.clearTimer();var t=this.currentLevelIndex,v=d[t],s=d[n];this.log("switching to level "+n+" from "+t),this.currentLevelIndex=n;var h=S({},s,{level:n,maxBitrate:s.maxBitrate,uri:s.uri,urlId:s.urlId});delete h._urlId,this.hls.trigger(A.Events.LEVEL_SWITCHING,h);var u=s.details;if(!u||u.live){var a=this.switchParams(s.uri,v?.details);this.loadPlaylist(a)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(n){this.manualLevelIndex=n,this._startLevel===void 0&&(this._startLevel=n),n!==-1&&(this.level=n)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(n){this._firstLevel=n}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var n=this.hls.config.startLevel;return n!==void 0?n:this._firstLevel}else return this._startLevel},set:function(n){this._startLevel=n}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(n){this.level=n,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=n)}}]),e}(I.default)},"./src/controller/level-helper.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{addGroupId:()=>b,addSliding:()=>r,adjustSliding:()=>l,assignTrackIdsByGroup:()=>I,computeReloadInterval:()=>e,getFragmentWithSN:()=>f,getPartWith:()=>c,mapFragmentIntersection:()=>p,mapPartIntersection:()=>y,mergeDetails:()=>_,updateFragPTSDTS:()=>g,updatePTS:()=>L});var F=D("./src/polyfills/number.ts"),A=D("./src/utils/logger.ts"),O=D("./src/loader/date-range.ts");function R(){return R=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var d=arguments[i];for(var o in d)Object.prototype.hasOwnProperty.call(d,o)&&(n[o]=d[o])}return n},R.apply(this,arguments)}function b(n,i,d){switch(i){case"audio":n.audioGroupIds||(n.audioGroupIds=[]),n.audioGroupIds.push(d);break;case"text":n.textGroupIds||(n.textGroupIds=[]),n.textGroupIds.push(d);break}}function I(n){var i={};n.forEach(function(d){var o=d.groupId||"";d.id=i[o]=i[o]||0,i[o]++})}function L(n,i,d){var o=n[i],t=n[d];S(o,t)}function S(n,i){var d=i.startPTS;if((0,F.isFiniteNumber)(d)){var o=0,t;i.sn>n.sn?(o=d-n.start,t=n):(o=n.start-d,t=i),t.duration!==o&&(t.duration=o)}else if(i.sn>n.sn){var v=n.cc===i.cc;v&&n.minEndPTS?i.start=n.start+(n.minEndPTS-n.start):i.start=n.start+n.duration}else i.start=Math.max(n.start-i.duration,0)}function g(n,i,d,o,t,v){var s=o-d;s<=0&&(A.logger.warn("Fragment should have a positive duration",i),o=d+i.duration,v=t+i.duration);var h=d,u=o,a=i.startPTS,m=i.endPTS;if((0,F.isFiniteNumber)(a)){var T=Math.abs(a-d);(0,F.isFiniteNumber)(i.deltaPTS)?i.deltaPTS=Math.max(T,i.deltaPTS):i.deltaPTS=T,h=Math.max(d,a),d=Math.min(d,a),t=Math.min(t,i.startDTS),u=Math.min(o,m),o=Math.max(o,m),v=Math.max(v,i.endDTS)}i.duration=o-d;var P=d-i.start;i.appendedPTS=o,i.start=i.startPTS=d,i.maxStartPTS=h,i.startDTS=t,i.endPTS=o,i.minEndPTS=u,i.endDTS=v;var M=i.sn;if(!n||M<n.startSN||M>n.endSN)return 0;var C,x=M-n.startSN,U=n.fragments;for(U[x]=i,C=x;C>0;C--)S(U[C],U[C-1]);for(C=x;C<U.length-1;C++)S(U[C],U[C+1]);return n.fragmentHint&&S(U[U.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,P}function _(n,i){for(var d=null,o=n.fragments,t=o.length-1;t>=0;t--){var v=o[t].initSegment;if(v){d=v;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;var s=0,h;if(p(n,i,function(C,x){C.relurl&&(s=C.cc-x.cc),(0,F.isFiniteNumber)(C.startPTS)&&(0,F.isFiniteNumber)(C.endPTS)&&(x.start=x.startPTS=C.startPTS,x.startDTS=C.startDTS,x.appendedPTS=C.appendedPTS,x.maxStartPTS=C.maxStartPTS,x.endPTS=C.endPTS,x.endDTS=C.endDTS,x.minEndPTS=C.minEndPTS,x.duration=C.endPTS-C.startPTS,x.duration&&(h=x),i.PTSKnown=i.alignedSliding=!0),x.elementaryStreams=C.elementaryStreams,x.loader=C.loader,x.stats=C.stats,x.urlId=C.urlId,C.initSegment&&(x.initSegment=C.initSegment,d=C.initSegment)}),d){var u=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;u.forEach(function(C){var x;(!C.initSegment||C.initSegment.relurl===((x=d)===null||x===void 0?void 0:x.relurl))&&(C.initSegment=d)})}if(i.skippedSegments)if(i.deltaUpdateFailed=i.fragments.some(function(C){return!C}),i.deltaUpdateFailed){A.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var a=i.skippedSegments;a--;)i.fragments.shift();i.startSN=i.fragments[0].sn,i.startCC=i.fragments[0].cc}else i.canSkipDateRanges&&(i.dateRanges=E(n.dateRanges,i.dateRanges,i.recentlyRemovedDateranges));var m=i.fragments;if(s){A.logger.warn("discontinuity sliding from playlist, take drift into account");for(var T=0;T<m.length;T++)m[T].cc+=s}i.skippedSegments&&(i.startCC=i.fragments[0].cc),y(n.partList,i.partList,function(C,x){x.elementaryStreams=C.elementaryStreams,x.stats=C.stats}),h?g(i,h,h.startPTS,h.endPTS,h.startDTS,h.endDTS):l(n,i),m.length&&(i.totalduration=i.edge-m[0].start),i.driftStartTime=n.driftStartTime,i.driftStart=n.driftStart;var P=i.advancedDateTime;if(i.advanced&&P){var M=i.edge;i.driftStart||(i.driftStartTime=P,i.driftStart=M),i.driftEndTime=P,i.driftEnd=M}else i.driftEndTime=n.driftEndTime,i.driftEnd=n.driftEnd,i.advancedDateTime=n.advancedDateTime}function E(n,i,d){var o=R({},n);return d&&d.forEach(function(t){delete o[t]}),Object.keys(i).forEach(function(t){var v=new O.DateRange(i[t].attr,o[t]);v.isValid?o[t]=v:A.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(i[t].attr)+'"')}),o}function y(n,i,d){if(n&&i)for(var o=0,t=0,v=n.length;t<=v;t++){var s=n[t],h=i[t+o];s&&h&&s.index===h.index&&s.fragment.sn===h.fragment.sn?d(s,h):o--}}function p(n,i,d){for(var o=i.skippedSegments,t=Math.max(n.startSN,i.startSN)-i.startSN,v=(n.fragmentHint?1:0)+(o?i.endSN:Math.min(n.endSN,i.endSN))-i.startSN,s=i.startSN-n.startSN,h=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments,u=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments,a=t;a<=v;a++){var m=u[s+a],T=h[a];o&&!T&&a<o&&(T=i.fragments[a]=m),m&&T&&d(m,T)}}function l(n,i){var d=i.startSN+i.skippedSegments-n.startSN,o=n.fragments;d<0||d>=o.length||r(i,o[d].start)}function r(n,i){if(i){for(var d=n.fragments,o=n.skippedSegments;o<d.length;o++)d[o].start+=i;n.fragmentHint&&(n.fragmentHint.start+=i)}}function e(n,i){var d=1e3*n.levelTargetDuration,o=d/2,t=n.age,v=t>0&&t<d*3,s=i.loading.end-i.loading.start,h,u=n.availabilityDelay;if(n.updated===!1)if(v){var a=333*n.misses;h=Math.max(Math.min(o,s*2),a),n.availabilityDelay=(n.availabilityDelay||0)+h}else h=o;else v?(u=Math.min(u||d/2,t),n.availabilityDelay=u,h=u+d-t):h=d-s;return Math.round(h)}function f(n,i,d){if(!n||!n.details)return null;var o=n.details,t=o.fragments[i-o.startSN];return t||(t=o.fragmentHint,t&&t.sn===i)?t:i<o.startSN&&d&&d.sn===i?d:null}function c(n,i,d){if(!n||!n.details)return null;var o=n.details.partList;if(o)for(var t=o.length;t--;){var v=o[t];if(v.index===d&&v.fragment.sn===i)return v}return null}},"./src/controller/stream-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>c});var F=D("./src/polyfills/number.ts"),A=D("./src/controller/base-stream-controller.ts"),O=D("./src/is-supported.ts"),R=D("./src/events.ts"),b=D("./src/utils/buffer-helper.ts"),I=D("./src/controller/fragment-tracker.ts"),L=D("./src/types/loader.ts"),S=D("./src/loader/fragment.ts"),g=D("./src/demux/transmuxer-interface.ts"),_=D("./src/types/transmuxer.ts"),E=D("./src/controller/gap-controller.ts"),y=D("./src/errors.ts");function p(n,i){for(var d=0;d<i.length;d++){var o=i[d];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}function l(n,i,d){return i&&p(n.prototype,i),d&&p(n,d),Object.defineProperty(n,"prototype",{writable:!1}),n}function r(n,i){n.prototype=Object.create(i.prototype),n.prototype.constructor=n,e(n,i)}function e(n,i){return e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,t){return o.__proto__=t,o},e(n,i)}var f=100,c=function(n){r(i,n);function i(o,t){var v;return v=n.call(this,o,t,"[stream-controller]")||this,v.audioCodecSwap=!1,v.gapController=null,v.level=-1,v._forceStartLoad=!1,v.altAudio=!1,v.audioOnly=!1,v.fragPlaying=null,v.onvplaying=null,v.onvseeked=null,v.fragLastKbps=0,v.couldBacktrack=!1,v.backtrackFragment=null,v.audioCodecSwitch=!1,v.videoBuffer=null,v._registerListeners(),v}var d=i.prototype;return d._registerListeners=function(){var t=this.hls;t.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(R.Events.ERROR,this.onError,this),t.on(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(R.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},d._unregisterListeners=function(){var t=this.hls;t.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(R.Events.ERROR,this.onError,this),t.off(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(R.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},d.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},d.startLoad=function(t){if(this.levels){var v=this.lastCurrentTime,s=this.hls;if(this.stopLoad(),this.setInterval(f),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var h=s.startLevel;h===-1&&(s.config.testBandwidth&&this.levels.length>1?(h=0,this.bitrateTest=!0):h=s.nextAutoLevel),this.level=s.nextLoadLevel=h,this.loadedmetadata=!1}v>0&&t===-1&&(this.log("Override startPosition with lastCurrentTime @"+v.toFixed(3)),t=v),this.state=A.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=A.State.STOPPED},d.stopLoad=function(){this._forceStartLoad=!1,n.prototype.stopLoad.call(this)},d.doTick=function(){switch(this.state){case A.State.IDLE:this.doTickIdle();break;case A.State.WAITING_LEVEL:{var t,v=this.levels,s=this.level,h=v==null||(t=v[s])===null||t===void 0?void 0:t.details;if(h&&(!h.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(h))break;this.state=A.State.IDLE;break}break}case A.State.FRAG_LOADING_WAITING_RETRY:{var u,a=self.performance.now(),m=this.retryDate;(!m||a>=m||(u=this.media)!==null&&u!==void 0&&u.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=A.State.IDLE)}break;default:break}this.onTickEnd()},d.onTickEnd=function(){n.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},d.doTickIdle=function(){var t,v,s=this.hls,h=this.levelLastLoaded,u=this.levels,a=this.media,m=s.config,T=s.nextLoadLevel;if(!(h===null||!a&&(this.startFragRequested||!m.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!u||!u[T])){var P=u[T];this.level=s.nextLoadLevel=T;var M=P.details;if(!M||this.state===A.State.WAITING_LEVEL||M.live&&this.levelLastLoaded!==T){this.state=A.State.WAITING_LEVEL;return}var C=this.getMainFwdBufferInfo();if(C!==null){var x=C.len,U=this.getMaxBufferLength(P.maxBitrate);if(!(x>=U)){if(this._streamEnded(C,M)){var k={};this.altAudio&&(k.type="video"),this.hls.trigger(R.Events.BUFFER_EOS,k),this.state=A.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>C.end&&(this.backtrackFragment=null);var w=this.backtrackFragment?this.backtrackFragment.start:C.end,N=this.getNextFragment(w,M);if(this.couldBacktrack&&!this.fragPrevious&&N&&N.sn!=="initSegment"&&this.fragmentTracker.getState(N)!==I.FragmentState.OK){var K,G=((K=this.backtrackFragment)!=null?K:N).sn,H=G-M.startSN,V=M.fragments[H-1];V&&N.cc===V.cc&&(N=V,this.fragmentTracker.removeFragment(V))}else this.backtrackFragment&&C.len&&(this.backtrackFragment=null);if(N&&this.fragmentTracker.getState(N)===I.FragmentState.OK&&this.nextLoadPosition>w){var X=this.audioOnly&&!this.altAudio?S.ElementaryStreamTypes.AUDIO:S.ElementaryStreamTypes.VIDEO;a&&this.afterBufferFlushed(a,X,L.PlaylistLevelType.MAIN),N=this.getNextFragment(this.nextLoadPosition,M)}!N||(N.initSegment&&!N.initSegment.data&&!this.bitrateTest&&(N=N.initSegment),((t=N.decryptdata)===null||t===void 0?void 0:t.keyFormat)==="identity"&&!((v=N.decryptdata)!==null&&v!==void 0&&v.key)?this.loadKey(N,M):this.loadFragment(N,M,w))}}}},d.loadFragment=function(t,v,s){var h,u=this.fragmentTracker.getState(t);this.fragCurrent=t,u===I.FragmentState.NOT_LOADED?t.sn==="initSegment"?this._loadInitSegment(t):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t)):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,t,v,s)):u===I.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):((h=this.media)===null||h===void 0?void 0:h.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},d.getAppendedFrag=function(t){var v=this.fragmentTracker.getAppendedFrag(t,L.PlaylistLevelType.MAIN);return v&&"fragment"in v?v.fragment:v},d.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,L.PlaylistLevelType.MAIN)},d.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},d.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},d.nextLevelSwitch=function(){var t=this.levels,v=this.media;if(v!=null&&v.readyState){var s,h=this.getAppendedFrag(v.currentTime);if(h&&h.start>1&&this.flushMainBuffer(0,h.start-1),!v.paused&&t){var u=this.hls.nextLoadLevel,a=t[u],m=this.fragLastKbps;m&&this.fragCurrent?s=this.fragCurrent.duration*a.maxBitrate/(1e3*m)+1:s=0}else s=0;var T=this.getBufferedFrag(v.currentTime+s);if(T){var P=this.followingBufferedFrag(T);if(P){this.abortCurrentFrag();var M=P.maxStartPTS?P.maxStartPTS:P.start,C=P.duration,x=Math.max(T.end,M+Math.min(Math.max(C-this.config.maxFragLookUpTolerance,C*.5),C*.75));this.flushMainBuffer(x,Number.POSITIVE_INFINITY)}}}},d.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t!=null&&t.loader&&t.loader.abort(),this.state){case A.State.KEY_LOADING:case A.State.FRAG_LOADING:case A.State.FRAG_LOADING_WAITING_RETRY:case A.State.PARSING:case A.State.PARSED:this.state=A.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},d.flushMainBuffer=function(t,v){n.prototype.flushMainBuffer.call(this,t,v,this.altAudio?"video":null)},d.onMediaAttached=function(t,v){n.prototype.onMediaAttached.call(this,t,v);var s=v.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),s.addEventListener("playing",this.onvplaying),s.addEventListener("seeked",this.onvseeked),this.gapController=new E.default(this.config,s,this.fragmentTracker,this.hls)},d.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),n.prototype.onMediaDetaching.call(this)},d.onMediaPlaying=function(){this.tick()},d.onMediaSeeked=function(){var t=this.media,v=t?t.currentTime:null;(0,F.isFiniteNumber)(v)&&this.log("Media seeked to "+v.toFixed(3)),this.tick()},d.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(R.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},d.onManifestParsed=function(t,v){var s=!1,h=!1,u;v.levels.forEach(function(a){u=a.audioCodec,u&&(u.indexOf("mp4a.40.2")!==-1&&(s=!0),u.indexOf("mp4a.40.5")!==-1&&(h=!0))}),this.audioCodecSwitch=s&&h&&!(0,O.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=v.levels,this.startFragRequested=!1},d.onLevelLoading=function(t,v){var s=this.levels;if(!(!s||this.state!==A.State.IDLE)){var h=s[v.level];(!h.details||h.details.live&&this.levelLastLoaded!==v.level||this.waitForCdnTuneIn(h.details))&&(this.state=A.State.WAITING_LEVEL)}},d.onLevelLoaded=function(t,v){var s,h=this.levels,u=v.level,a=v.details,m=a.totalduration;if(!h){this.warn("Levels were reset while loading level "+u);return}this.log("Level "+u+" loaded ["+a.startSN+","+a.endSN+"], cc ["+a.startCC+", "+a.endCC+"] duration:"+m);var T=this.fragCurrent;T&&(this.state===A.State.FRAG_LOADING||this.state===A.State.FRAG_LOADING_WAITING_RETRY)&&T.level!==v.level&&T.loader&&(this.state=A.State.IDLE,this.backtrackFragment=null,T.loader.abort());var P=h[u],M=0;if(a.live||(s=P.details)!==null&&s!==void 0&&s.live){if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed)return;M=this.alignPlaylists(a,P.details)}if(P.details=a,this.levelLastLoaded=u,this.hls.trigger(R.Events.LEVEL_UPDATED,{details:a,level:u}),this.state===A.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=A.State.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,M),this.tick()},d._handleFragmentLoadProgress=function(t){var v,s=t.frag,h=t.part,u=t.payload,a=this.levels;if(!a){this.warn("Levels were reset while fragment load was in progress. Fragment "+s.sn+" of level "+s.level+" will not be buffered");return}var m=a[s.level],T=m.details;if(!T){this.warn("Dropping fragment "+s.sn+" of level "+s.level+" after level details were reset");return}var P=m.videoCodec,M=T.PTSKnown||!T.live,C=(v=s.initSegment)===null||v===void 0?void 0:v.data,x=this._getAudioCodec(m),U=this.transmuxer=this.transmuxer||new g.default(this.hls,L.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),k=h?h.index:-1,w=k!==-1,N=new _.ChunkMetadata(s.level,s.sn,s.stats.chunkCount,u.byteLength,k,w),K=this.initPTS[s.cc];U.push(u,C,x,P,s,h,T.totalduration,M,N,K)},d.onAudioTrackSwitching=function(t,v){var s=this.altAudio,h=!!v.url,u=v.id;if(!h){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var a=this.fragCurrent;a!=null&&a.loader&&(this.log("Switching to main audio track, cancel main fragment load"),a.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var m=this.hls;s&&m.trigger(R.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),m.trigger(R.Events.AUDIO_TRACK_SWITCHED,{id:u})}},d.onAudioTrackSwitched=function(t,v){var s=v.id,h=!!this.hls.audioTracks[s].url;if(h){var u=this.videoBuffer;u&&this.mediaBuffer!==u&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=u)}this.altAudio=h,this.tick()},d.onBufferCreated=function(t,v){var s=v.tracks,h,u,a=!1;for(var m in s){var T=s[m];if(T.id==="main"){if(u=m,h=T,m==="video"){var P=s[m];P&&(this.videoBuffer=P.buffer)}}else a=!0}a&&h?(this.log("Alternate track found, use "+u+".buffered to schedule main fragment loading"),this.mediaBuffer=h.buffer):this.mediaBuffer=this.media},d.onFragBuffered=function(t,v){var s=v.frag,h=v.part;if(!(s&&s.type!==L.PlaylistLevelType.MAIN)){if(this.fragContextChanged(s)){this.warn("Fragment "+s.sn+(h?" p: "+h.index:"")+" of level "+s.level+" finished buffering, but was aborted. state: "+this.state),this.state===A.State.PARSED&&(this.state=A.State.IDLE);return}var u=h?h.stats:s.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),s.sn!=="initSegment"&&(this.fragPrevious=s),this.fragBufferedComplete(s,h)}},d.onError=function(t,v){switch(v.details){case y.ErrorDetails.FRAG_LOAD_ERROR:case y.ErrorDetails.FRAG_LOAD_TIMEOUT:case y.ErrorDetails.KEY_LOAD_ERROR:case y.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(L.PlaylistLevelType.MAIN,v);break;case y.ErrorDetails.LEVEL_LOAD_ERROR:case y.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==A.State.ERROR&&(v.fatal?(this.warn(""+v.details),this.state=A.State.ERROR):!v.levelRetry&&this.state===A.State.WAITING_LEVEL&&(this.state=A.State.IDLE));break;case y.ErrorDetails.BUFFER_FULL_ERROR:if(v.parent==="main"&&(this.state===A.State.PARSING||this.state===A.State.PARSED)){var s=!0,h=this.getFwdBufferInfo(this.media,L.PlaylistLevelType.MAIN);h&&h.len>.5&&(s=!this.reduceMaxBufferLength(h.len)),s&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break;default:break}},d.checkBuffer=function(){var t=this.media,v=this.gapController;if(!(!t||!v||!t.readyState)){if(this.loadedmetadata||!b.BufferHelper.getBuffered(t).length){var s=this.state!==A.State.IDLE?this.fragCurrent:null;v.poll(this.lastCurrentTime,s)}this.lastCurrentTime=t.currentTime}},d.onFragLoadEmergencyAborted=function(){this.state=A.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},d.onBufferFlushed=function(t,v){var s=v.type;if(s!==S.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var h=(s===S.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(h,s,L.PlaylistLevelType.MAIN)}},d.onLevelsUpdated=function(t,v){this.levels=v.levels},d.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},d.seekToStartPos=function(){var t=this.media;if(!!t){var v=t.currentTime,s=this.startPosition;if(s>=0&&v<s){if(t.seeking){this.log("could not seek to "+s+", already seeking at "+v);return}var h=b.BufferHelper.getBuffered(t),u=h.length?h.start(0):0,a=u-s;a>0&&(a<this.config.maxBufferHole||a<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+a+" to match buffer start"),s+=a,this.startPosition=s),this.log("seek to target start position "+s+" from current time "+v),t.currentTime=s}}},d._getAudioCodec=function(t){var v=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&v&&(this.log("Swapping audio codec"),v.indexOf("mp4a.40.5")!==-1?v="mp4a.40.2":v="mp4a.40.5"),v},d._loadBitrateTestFrag=function(t){var v=this;t.bitrateTest=!0,this._doFragLoad(t).then(function(s){var h=v.hls;if(!(!s||h.nextLoadLevel||v.fragContextChanged(t))){v.fragLoadError=0,v.state=A.State.IDLE,v.startFragRequested=!1,v.bitrateTest=!1;var u=t.stats;u.parsing.start=u.parsing.end=u.buffering.start=u.buffering.end=self.performance.now(),h.trigger(R.Events.FRAG_LOADED,s),t.bitrateTest=!1}})},d._handleTransmuxComplete=function(t){var v,s="main",h=this.hls,u=t.remuxResult,a=t.chunkMeta,m=this.getCurrentContext(a);if(!m){this.warn("The loading context changed while buffering fragment "+a.sn+" of level "+a.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(a.level);return}var T=m.frag,P=m.part,M=m.level,C=u.video,x=u.text,U=u.id3,k=u.initSegment,w=M.details,N=this.altAudio?void 0:u.audio;if(!this.fragContextChanged(T)){if(this.state=A.State.PARSING,k){k.tracks&&(this._bufferInitSegment(M,k.tracks,T,a),h.trigger(R.Events.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:s,tracks:k.tracks}));var K=k.initPTS,G=k.timescale;(0,F.isFiniteNumber)(K)&&(this.initPTS[T.cc]=K,h.trigger(R.Events.INIT_PTS_FOUND,{frag:T,id:s,initPTS:K,timescale:G}))}if(C&&u.independent!==!1){if(w){var H=C.startPTS,V=C.endPTS,X=C.startDTS,Y=C.endDTS;if(P)P.elementaryStreams[C.type]={startPTS:H,endPTS:V,startDTS:X,endDTS:Y};else if(C.firstKeyFrame&&C.independent&&(this.couldBacktrack=!0),C.dropped&&C.independent){var Q=this.getMainFwdBufferInfo(),$=(Q?Q.end:this.getLoadPosition())+this.config.maxBufferHole,z=C.firstKeyFramePTS?C.firstKeyFramePTS:H;if($<z-this.config.maxBufferHole){this.backtrack(T);return}T.setElementaryStreamInfo(C.type,T.start,V,T.start,Y,!0)}T.setElementaryStreamInfo(C.type,H,V,X,Y),this.backtrackFragment&&(this.backtrackFragment=T),this.bufferFragmentData(C,T,P,a)}}else if(u.independent===!1){this.backtrack(T);return}if(N){var j=N.startPTS,J=N.endPTS,Z=N.startDTS,q=N.endDTS;P&&(P.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:j,endPTS:J,startDTS:Z,endDTS:q}),T.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,j,J,Z,q),this.bufferFragmentData(N,T,P,a)}if(w&&U!==null&&U!==void 0&&(v=U.samples)!==null&&v!==void 0&&v.length){var le={id:s,frag:T,details:w,samples:U.samples};h.trigger(R.Events.FRAG_PARSING_METADATA,le)}if(w&&x){var ee={id:s,frag:T,details:w,samples:x.samples};h.trigger(R.Events.FRAG_PARSING_USERDATA,ee)}}},d._bufferInitSegment=function(t,v,s,h){var u=this;if(this.state===A.State.PARSING){this.audioOnly=!!v.audio&&!v.video,this.altAudio&&!this.audioOnly&&delete v.audio;var a=v.audio,m=v.video,T=v.audiovideo;if(a){var P=t.audioCodec,M=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(P&&(P.indexOf("mp4a.40.5")!==-1?P="mp4a.40.2":P="mp4a.40.5"),a.metadata.channelCount!==1&&M.indexOf("firefox")===-1&&(P="mp4a.40.5")),M.indexOf("android")!==-1&&a.container!=="audio/mpeg"&&(P="mp4a.40.2",this.log("Android: force audio codec to "+P)),t.audioCodec&&t.audioCodec!==P&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+P+'"'),a.levelCodec=P,a.id="main",this.log("Init audio buffer, container:"+a.container+", codecs[selected/level/parsed]=["+(P||"")+"/"+(t.audioCodec||"")+"/"+a.codec+"]")}m&&(m.levelCodec=t.videoCodec,m.id="main",this.log("Init video buffer, container:"+m.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+m.codec+"]")),T&&this.log("Init audiovideo buffer, container:"+T.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+T.codec+"]"),this.hls.trigger(R.Events.BUFFER_CODECS,v),Object.keys(v).forEach(function(C){var x=v[C],U=x.initSegment;U!=null&&U.byteLength&&u.hls.trigger(R.Events.BUFFER_APPENDING,{type:C,data:U,frag:s,part:null,chunkMeta:h,parent:s.type})}),this.tick()}},d.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,L.PlaylistLevelType.MAIN)},d.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=A.State.IDLE},d.checkFragmentChanged=function(){var t=this.media,v=null;if(t&&t.readyState>1&&t.seeking===!1){var s=t.currentTime;if(b.BufferHelper.isBuffered(t,s)?v=this.getAppendedFrag(s):b.BufferHelper.isBuffered(t,s+.1)&&(v=this.getAppendedFrag(s+.1)),v){this.backtrackFragment=null;var h=this.fragPlaying,u=v.level;(!h||v.sn!==h.sn||h.level!==u||v.urlId!==h.urlId)&&(this.hls.trigger(R.Events.FRAG_CHANGED,{frag:v}),(!h||h.level!==u)&&this.hls.trigger(R.Events.LEVEL_SWITCHED,{level:u}),this.fragPlaying=v)}}},l(i,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var v=t.currentTime,s=this.currentFrag;if(s&&(0,F.isFiniteNumber)(v)&&(0,F.isFiniteNumber)(s.programDateTime)){var h=s.programDateTime+(v-s.start)*1e3;return new Date(h)}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),i}(A.default)},"./src/controller/subtitle-stream-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{SubtitleStreamController:()=>r});var F=D("./src/events.ts"),A=D("./src/utils/buffer-helper.ts"),O=D("./src/controller/fragment-finders.ts"),R=D("./src/utils/discontinuities.ts"),b=D("./src/controller/level-helper.ts"),I=D("./src/controller/fragment-tracker.ts"),L=D("./src/controller/base-stream-controller.ts"),S=D("./src/types/loader.ts"),g=D("./src/types/level.ts");function _(f,c){for(var n=0;n<c.length;n++){var i=c[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(f,i.key,i)}}function E(f,c,n){return c&&_(f.prototype,c),n&&_(f,n),Object.defineProperty(f,"prototype",{writable:!1}),f}function y(f,c){f.prototype=Object.create(c.prototype),f.prototype.constructor=f,p(f,c)}function p(f,c){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,d){return i.__proto__=d,i},p(f,c)}var l=500,r=function(f){y(c,f);function c(i,d){var o;return o=f.call(this,i,d,"[subtitle-stream-controller]")||this,o.levels=[],o.currentTrackId=-1,o.tracksBuffered=[],o.mainDetails=null,o._registerListeners(),o}var n=c.prototype;return n.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},n._registerListeners=function(){var d=this.hls;d.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.on(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.on(F.Events.ERROR,this.onError,this),d.on(F.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),d.on(F.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),d.on(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),d.on(F.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),d.on(F.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},n._unregisterListeners=function(){var d=this.hls;d.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.off(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.off(F.Events.ERROR,this.onError,this),d.off(F.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),d.off(F.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),d.off(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),d.off(F.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),d.off(F.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},n.startLoad=function(){this.stopLoad(),this.state=L.State.IDLE,this.setInterval(l),this.tick()},n.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},n.onLevelLoaded=function(d,o){this.mainDetails=o.details},n.onSubtitleFragProcessed=function(d,o){var t=o.frag,v=o.success;if(this.fragPrevious=t,this.state=L.State.IDLE,!!v){var s=this.tracksBuffered[this.currentTrackId];if(!!s){for(var h,u=t.start,a=0;a<s.length;a++)if(u>=s[a].start&&u<=s[a].end){h=s[a];break}var m=t.start+t.duration;h?h.end=m:(h={start:u,end:m},s.push(h)),this.fragmentTracker.fragBuffered(t)}}},n.onBufferFlushing=function(d,o){var t=o.startOffset,v=o.endOffset;if(t===0&&v!==Number.POSITIVE_INFINITY){var s=this.currentTrackId,h=this.levels;if(!h.length||!h[s]||!h[s].details)return;var u=h[s].details,a=u.targetduration,m=v-a;if(m<=0)return;o.endOffsetSubtitles=Math.max(0,m),this.tracksBuffered.forEach(function(T){for(var P=0;P<T.length;){if(T[P].end<=m){T.shift();continue}else if(T[P].start<m)T[P].start=m;else break;P++}}),this.fragmentTracker.removeFragmentsInRange(t,m,S.PlaylistLevelType.SUBTITLE)}},n.onError=function(d,o){var t,v=o.frag;!v||v.type!==S.PlaylistLevelType.SUBTITLE||((t=this.fragCurrent)!==null&&t!==void 0&&t.loader&&this.fragCurrent.loader.abort(),this.state=L.State.IDLE)},n.onSubtitleTracksUpdated=function(d,o){var t=this,v=o.subtitleTracks;this.tracksBuffered=[],this.levels=v.map(function(s){return new g.Level(s)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(s){t.tracksBuffered[s.id]=[]}),this.mediaBuffer=null},n.onSubtitleTrackSwitch=function(d,o){if(this.currentTrackId=o.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var t=this.levels[this.currentTrackId];t!=null&&t.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,t&&this.setInterval(l)},n.onSubtitleTrackLoaded=function(d,o){var t,v=o.details,s=o.id,h=this.currentTrackId,u=this.levels;if(!!u.length){var a=u[h];if(!(s>=u.length||s!==h||!a)){if(this.mediaBuffer=this.mediaBufferTimeRanges,v.live||(t=a.details)!==null&&t!==void 0&&t.live){var m=this.mainDetails;if(v.deltaUpdateFailed||!m)return;var T=m.fragments[0];if(!a.details)v.hasProgramDateTime&&m.hasProgramDateTime?(0,R.alignMediaPlaylistByPDT)(v,m):T&&(0,b.addSliding)(v,T.start);else{var P=this.alignPlaylists(v,a.details);P===0&&T&&(0,b.addSliding)(v,T.start)}}if(a.details=v,this.levelLastLoaded=s,this.tick(),v.live&&!this.fragCurrent&&this.media&&this.state===L.State.IDLE){var M=(0,O.findFragmentByPTS)(null,v.fragments,this.media.currentTime,0);M||(this.warn("Subtitle playlist not aligned with playback"),a.details=void 0)}}}},n._handleFragmentLoadComplete=function(d){var o=d.frag,t=d.payload,v=o.decryptdata,s=this.hls;if(!this.fragContextChanged(o)&&t&&t.byteLength>0&&v&&v.key&&v.iv&&v.method==="AES-128"){var h=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(t),v.key.buffer,v.iv.buffer).then(function(u){var a=performance.now();s.trigger(F.Events.FRAG_DECRYPTED,{frag:o,payload:u,stats:{tstart:h,tdecrypt:a}})})}},n.doTick=function(){if(!this.media){this.state=L.State.IDLE;return}if(this.state===L.State.IDLE){var d=this.currentTrackId,o=this.levels;if(!o.length||!o[d]||!o[d].details)return;var t=o[d].details,v=t.targetduration,s=this.config,h=this.media,u=A.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],h.currentTime-v,s.maxBufferHole),a=u.end,m=u.len,T=this.getMaxBufferLength()+v;if(m>T)return;console.assert(t,"Subtitle track details are defined on idle subtitle stream controller tick");var P=t.fragments,M=P.length,C=t.edge,x,U=this.fragPrevious;if(a<C){var k=s.maxFragLookUpTolerance;x=(0,O.findFragmentByPTS)(U,P,Math.max(P[0].start,a),k),!x&&U&&U.start<P[0].start&&(x=P[0])}else x=P[M-1];if(x=this.mapToInitFragWhenRequired(x),!x||this.fragmentTracker.getState(x)!==I.FragmentState.NOT_LOADED)return;x.encrypted?this.loadKey(x,t):this.loadFragment(x,t,a)}},n.loadFragment=function(d,o,t){this.fragCurrent=d,d.sn==="initSegment"?this._loadInitSegment(d):f.prototype.loadFragment.call(this,d,o,t)},E(c,[{key:"mediaBufferTimeRanges",get:function(){return new e(this.tracksBuffered[this.currentTrackId]||[])}}]),c}(L.default),e=function(c){this.buffered=void 0;var n=function(d,o,t){if(o=o>>>0,o>t-1)throw new DOMException("Failed to execute '"+d+"' on 'TimeRanges': The index provided ("+o+") is greater than the maximum bound ("+t+")");return c[o][d]};this.buffered={get length(){return c.length},end:function(d){return n("end",d,c.length)},start:function(d){return n("start",d,c.length)}}}},"./src/controller/subtitle-track-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>E});var F=D("./src/events.ts"),A=D("./src/utils/texttrack-utils.ts"),O=D("./src/controller/base-playlist-controller.ts"),R=D("./src/types/loader.ts");function b(y,p){for(var l=0;l<p.length;l++){var r=p[l];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(y,r.key,r)}}function I(y,p,l){return p&&b(y.prototype,p),l&&b(y,l),Object.defineProperty(y,"prototype",{writable:!1}),y}function L(y,p){y.prototype=Object.create(p.prototype),y.prototype.constructor=y,S(y,p)}function S(y,p){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},S(y,p)}var g=function(y){L(p,y);function p(r){var e;return e=y.call(this,r,"[subtitle-track-controller]")||this,e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.registerListeners(),e}var l=p.prototype;return l.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,y.prototype.destroy.call(this)},l.registerListeners=function(){var e=this.hls;e.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(F.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(F.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){var e=this.hls;e.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(F.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(F.Events.ERROR,this.onError,this)},l.onMediaAttached=function(e,f){this.media=f.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},l.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},l.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=_(this.media.textTracks);e.forEach(function(f){(0,A.clearCurrentCues)(f)}),this.subtitleTrack=-1,this.media=null}},l.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},l.onManifestParsed=function(e,f){this.tracks=f.subtitleTracks},l.onSubtitleTrackLoaded=function(e,f){var c=f.id,n=f.details,i=this.trackId,d=this.tracksInGroup[i];if(!d){this.warn("Invalid subtitle track id "+c);return}var o=d.details;d.details=f.details,this.log("subtitle track "+c+" loaded ["+n.startSN+"-"+n.endSN+"]"),c===this.trackId&&(this.retryCount=0,this.playlistLoaded(c,f,o))},l.onLevelLoading=function(e,f){this.switchLevel(f.level)},l.onLevelSwitching=function(e,f){this.switchLevel(f.level)},l.switchLevel=function(e){var f=this.hls.levels[e];if(!!(f!=null&&f.textGroupIds)){var c=f.textGroupIds[f.urlId];if(this.groupId!==c){var n=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,i=this.tracks.filter(function(t){return!c||t.groupId===c});this.tracksInGroup=i;var d=this.findTrackId(n?.name)||this.findTrackId();this.groupId=c;var o={subtitleTracks:i};this.log("Updating subtitle tracks, "+i.length+' track(s) found in "'+c+'" group-id'),this.hls.trigger(F.Events.SUBTITLE_TRACKS_UPDATED,o),d!==-1&&this.setSubtitleTrack(d,n)}}},l.findTrackId=function(e){for(var f=this.tracksInGroup,c=0;c<f.length;c++){var n=f[c];if((!this.selectDefaultTrack||n.default)&&(!e||e===n.name))return n.id}return-1},l.onError=function(e,f){y.prototype.onError.call(this,e,f),!(f.fatal||!f.context)&&f.context.type===R.PlaylistContextType.SUBTITLE_TRACK&&f.context.id===this.trackId&&f.context.groupId===this.groupId&&this.retryLoadingOrFail(f)},l.loadPlaylist=function(e){var f=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(f)){var c=f.id,n=f.groupId,i=f.url;if(e)try{i=e.addDirectives(i)}catch(d){this.warn("Could not construct new URL with HLS Delivery Directives: "+d)}this.log("Loading subtitle playlist for id "+c),this.hls.trigger(F.Events.SUBTITLE_TRACK_LOADING,{url:i,id:c,groupId:n,deliveryDirectives:e||null})}},l.toggleTrackModes=function(e){var f=this,c=this.media,n=this.trackId;if(!!c){var i=_(c.textTracks),d=i.filter(function(v){return v.groupId===f.groupId});if(e===-1)[].slice.call(i).forEach(function(v){v.mode="disabled"});else{var o=d[n];o&&(o.mode="disabled")}var t=d[e];t&&(t.mode=this.subtitleDisplay?"showing":"hidden")}},l.setSubtitleTrack=function(e,f){var c,n=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(c=n[e])!==null&&c!==void 0&&c.details)||e<-1||e>=n.length)){this.clearTimer();var i=n[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,i){var d=i.id,o=i.groupId,t=o===void 0?"":o,v=i.name,s=i.type,h=i.url;this.hls.trigger(F.Events.SUBTITLE_TRACK_SWITCH,{id:d,groupId:t,name:v,type:s,url:h});var u=this.switchParams(i.url,f?.details);this.loadPlaylist(u)}else this.hls.trigger(F.Events.SUBTITLE_TRACK_SWITCH,{id:e})}},l.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,f=_(this.media.textTracks),c=0;c<f.length;c++)if(f[c].mode==="hidden")e=c;else if(f[c].mode==="showing"){e=c;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},I(p,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var f=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,f)}}]),p}(O.default);function _(y){for(var p=[],l=0;l<y.length;l++){var r=y[l];r.kind==="subtitles"&&r.label&&p.push(y[l])}return p}const E=g},"./src/controller/timeline-controller.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{TimelineController:()=>E});var F=D("./src/polyfills/number.ts"),A=D("./src/events.ts"),O=D("./src/utils/cea-608-parser.ts"),R=D("./src/utils/output-filter.ts"),b=D("./src/utils/webvtt-parser.ts"),I=D("./src/utils/texttrack-utils.ts"),L=D("./src/utils/imsc1-ttml-parser.ts"),S=D("./src/utils/mp4-tools.ts"),g=D("./src/types/loader.ts"),_=D("./src/utils/logger.ts"),E=function(){function r(f){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=l(),this.captionsProperties=void 0,this.hls=f,this.config=f.config,this.Cues=f.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var c=new R.default(this,"textTrack1"),n=new R.default(this,"textTrack2"),i=new R.default(this,"textTrack3"),d=new R.default(this,"textTrack4");this.cea608Parser1=new O.default(1,c,n),this.cea608Parser2=new O.default(3,i,d)}f.on(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),f.on(A.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),f.on(A.Events.FRAG_LOADING,this.onFragLoading,this),f.on(A.Events.FRAG_LOADED,this.onFragLoaded,this),f.on(A.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),f.on(A.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),f.on(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),f.on(A.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),f.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=r.prototype;return e.destroy=function(){var c=this.hls;c.off(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),c.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.off(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),c.off(A.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),c.off(A.Events.FRAG_LOADING,this.onFragLoading,this),c.off(A.Events.FRAG_LOADED,this.onFragLoaded,this),c.off(A.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),c.off(A.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),c.off(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),c.off(A.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),c.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},e.addCues=function(c,n,i,d,o){for(var t=!1,v=o.length;v--;){var s=o[v],h=p(s[0],s[1],n,i);if(h>=0&&(s[0]=Math.min(s[0],n),s[1]=Math.max(s[1],i),t=!0,h/(i-n)>.5))return}if(t||o.push([n,i]),this.config.renderTextTracksNatively){var u=this.captionsTracks[c];this.Cues.newCue(u,n,i,d)}else{var a=this.Cues.newCue(null,n,i,d);this.hls.trigger(A.Events.CUES_PARSED,{type:"captions",cues:a,track:c})}},e.onInitPtsFound=function(c,n){var i=this,d=n.frag,o=n.id,t=n.initPTS,v=n.timescale,s=this.unparsedVttFrags;o==="main"&&(this.initPTS[d.cc]=t,this.timescale[d.cc]=v),s.length&&(this.unparsedVttFrags=[],s.forEach(function(h){i.onFragLoaded(A.Events.FRAG_LOADED,h)}))},e.getExistingTrack=function(c){var n=this.media;if(n)for(var i=0;i<n.textTracks.length;i++){var d=n.textTracks[i];if(d[c])return d}return null},e.createCaptionsTrack=function(c){this.config.renderTextTracksNatively?this.createNativeTrack(c):this.createNonNativeTrack(c)},e.createNativeTrack=function(c){if(!this.captionsTracks[c]){var n=this.captionsProperties,i=this.captionsTracks,d=this.media,o=n[c],t=o.label,v=o.languageCode,s=this.getExistingTrack(c);if(s)i[c]=s,(0,I.clearCurrentCues)(i[c]),(0,I.sendAddTrackEvent)(i[c],d);else{var h=this.createTextTrack("captions",t,v);h&&(h[c]=!0,i[c]=h)}}},e.createNonNativeTrack=function(c){if(!this.nonNativeCaptionsTracks[c]){var n=this.captionsProperties[c];if(!!n){var i=n.label,d={_id:c,label:i,kind:"captions",default:n.media?!!n.media.default:!1,closedCaptions:n.media};this.nonNativeCaptionsTracks[c]=d,this.hls.trigger(A.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[d]})}}},e.createTextTrack=function(c,n,i){var d=this.media;if(!!d)return d.addTextTrack(c,n,i)},e.onMediaAttaching=function(c,n){this.media=n.media,this._cleanTracks()},e.onMediaDetaching=function(){var c=this.captionsTracks;Object.keys(c).forEach(function(n){(0,I.clearCurrentCues)(c[n]),delete c[n]}),this.nonNativeCaptionsTracks={}},e.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=l(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=function(){var c=this.media;if(!!c){var n=c.textTracks;if(n)for(var i=0;i<n.length;i++)(0,I.clearCurrentCues)(n[i])}},e.onSubtitleTracksUpdated=function(c,n){var i=this;this.textTracks=[];var d=n.subtitleTracks||[],o=d.some(function(h){return h.textCodec===L.IMSC1_CODEC});if(this.config.enableWebVTT||o&&this.config.enableIMSC1){var t=this.tracks&&d&&this.tracks.length===d.length;if(this.tracks=d||[],this.config.renderTextTracksNatively){var v=this.media?this.media.textTracks:[];this.tracks.forEach(function(h,u){var a;if(u<v.length){for(var m=null,T=0;T<v.length;T++)if(y(v[T],h)){m=v[T];break}m&&(a=m)}if(a)(0,I.clearCurrentCues)(a);else{var P=i._captionsOrSubtitlesFromCharacteristics(h);a=i.createTextTrack(P,h.name,h.lang),a&&(a.mode="disabled")}a&&(a.groupId=h.groupId,i.textTracks.push(a))})}else if(!t&&this.tracks&&this.tracks.length){var s=this.tracks.map(function(h){return{label:h.name,kind:h.type.toLowerCase(),default:h.default,subtitleTrack:h}});this.hls.trigger(A.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:s})}}},e._captionsOrSubtitlesFromCharacteristics=function(c){var n;if((n=c.attrs)!==null&&n!==void 0&&n.CHARACTERISTICS){var i=/transcribes-spoken-dialog/gi.test(c.attrs.CHARACTERISTICS),d=/describes-music-and-sound/gi.test(c.attrs.CHARACTERISTICS);if(i&&d)return"captions"}return"subtitles"},e.onManifestLoaded=function(c,n){var i=this;this.config.enableCEA708Captions&&n.captions&&n.captions.forEach(function(d){var o=/(?:CC|SERVICE)([1-4])/.exec(d.instreamId);if(!!o){var t="textTrack"+o[1],v=i.captionsProperties[t];!v||(v.label=d.name,d.lang&&(v.languageCode=d.lang),v.media=d)}})},e.closedCaptionsForLevel=function(c){var n=this.hls.levels[c.level];return n?.attrs["CLOSED-CAPTIONS"]},e.onFragLoading=function(c,n){var i=this.cea608Parser1,d=this.cea608Parser2,o=this.lastSn,t=this.lastPartIndex;if(!(!this.enabled||!(i&&d))&&n.frag.type===g.PlaylistLevelType.MAIN){var v,s,h=n.frag.sn,u=(v=n==null||(s=n.part)===null||s===void 0?void 0:s.index)!=null?v:-1;h===o+1||h===o&&u===t+1||(i.reset(),d.reset()),this.lastSn=h,this.lastPartIndex=u}},e.onFragLoaded=function(c,n){var i=n.frag,d=n.payload,o=this.initPTS,t=this.unparsedVttFrags;if(i.type===g.PlaylistLevelType.SUBTITLE)if(d.byteLength){if(!(0,F.isFiniteNumber)(o[i.cc])){t.push(n),o.length&&this.hls.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Missing initial subtitle PTS")});return}var v=i.decryptdata,s="stats"in n;if(v==null||v.key==null||v.method!=="AES-128"||s){var h=this.tracks[i.level],u=this.vttCCs;u[i.cc]||(u[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),h&&h.textCodec===L.IMSC1_CODEC?this._parseIMSC1(i,d):this._parseVTTs(i,d,u)}}else this.hls.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})},e._parseIMSC1=function(c,n){var i=this,d=this.hls;(0,L.parseIMSC1)(n,this.initPTS[c.cc],this.timescale[c.cc],function(o){i._appendCues(o,c.level),d.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:c})},function(o){_.logger.log("Failed to parse IMSC1: "+o),d.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c,error:o})})},e._parseVTTs=function(c,n,i){var d,o=this,t=this.hls,v=(d=c.initSegment)!==null&&d!==void 0&&d.data?(0,S.appendUint8Array)(c.initSegment.data,new Uint8Array(n)):n;(0,b.parseWebVTT)(v,this.initPTS[c.cc],this.timescale[c.cc],i,c.cc,c.start,function(s){o._appendCues(s,c.level),t.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:c})},function(s){o._fallbackToIMSC1(c,n),_.logger.log("Failed to parse VTT cue: "+s),t.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c,error:s})})},e._fallbackToIMSC1=function(c,n){var i=this,d=this.tracks[c.level];d.textCodec||(0,L.parseIMSC1)(n,this.initPTS[c.cc],this.timescale[c.cc],function(){d.textCodec=L.IMSC1_CODEC,i._parseIMSC1(c,n)},function(){d.textCodec="wvtt"})},e._appendCues=function(c,n){var i=this.hls;if(this.config.renderTextTracksNatively){var d=this.textTracks[n];if(!d||d.mode==="disabled")return;c.forEach(function(v){return(0,I.addCueToTrack)(d,v)})}else{var o=this.tracks[n];if(!o)return;var t=o.default?"default":"subtitles"+n;i.trigger(A.Events.CUES_PARSED,{type:"subtitles",cues:c,track:t})}},e.onFragDecrypted=function(c,n){var i=n.frag;if(i.type===g.PlaylistLevelType.SUBTITLE){if(!(0,F.isFiniteNumber)(this.initPTS[i.cc])){this.unparsedVttFrags.push(n);return}this.onFragLoaded(A.Events.FRAG_LOADED,n)}},e.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},e.onFragParsingUserdata=function(c,n){var i=this.cea608Parser1,d=this.cea608Parser2;if(!(!this.enabled||!(i&&d))){var o=n.frag,t=n.samples;if(!(o.type===g.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(o)==="NONE"))for(var v=0;v<t.length;v++){var s=t[v].bytes;if(s){var h=this.extractCea608Data(s);i.addData(t[v].pts,h[0]),d.addData(t[v].pts,h[1])}}}},e.onBufferFlushing=function(c,n){var i=n.startOffset,d=n.endOffset,o=n.endOffsetSubtitles,t=n.type,v=this.media;if(!(!v||v.currentTime<d)){if(!t||t==="video"){var s=this.captionsTracks;Object.keys(s).forEach(function(u){return(0,I.removeCuesInRange)(s[u],i,d)})}if(this.config.renderTextTracksNatively&&i===0&&o!==void 0){var h=this.textTracks;Object.keys(h).forEach(function(u){return(0,I.removeCuesInRange)(h[u],i,o)})}}},e.extractCea608Data=function(c){for(var n=[[],[]],i=c[0]&31,d=2,o=0;o<i;o++){var t=c[d++],v=127&c[d++],s=127&c[d++];if(!(v===0&&s===0)){var h=(4&t)!==0;if(h){var u=3&t;(u===0||u===1)&&(n[u].push(v),n[u].push(s))}}}return n},r}();function y(r,e){return r&&r.label===e.name&&!(r.textTrack1||r.textTrack2)}function p(r,e,f,c){return Math.min(e,c)-Math.max(r,f)}function l(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>F});var F=function(){function A(R,b){this.subtle=void 0,this.aesIV=void 0,this.subtle=R,this.aesIV=b}var O=A.prototype;return O.decrypt=function(b,I){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},I,b)},A}()},"./src/crypt/aes-decryptor.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>O,removePadding:()=>A});var F=D("./src/utils/typed-array.ts");function A(R){var b=R.byteLength,I=b&&new DataView(R.buffer).getUint8(b-1);return I?(0,F.sliceUint8)(R,0,b-I):R}var O=function(){function R(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var b=R.prototype;return b.uint8ArrayToUint32Array_=function(L){for(var S=new DataView(L),g=new Uint32Array(4),_=0;_<4;_++)g[_]=S.getUint32(_*4);return g},b.initTable=function(){var L=this.sBox,S=this.invSBox,g=this.subMix,_=g[0],E=g[1],y=g[2],p=g[3],l=this.invSubMix,r=l[0],e=l[1],f=l[2],c=l[3],n=new Uint32Array(256),i=0,d=0,o=0;for(o=0;o<256;o++)o<128?n[o]=o<<1:n[o]=o<<1^283;for(o=0;o<256;o++){var t=d^d<<1^d<<2^d<<3^d<<4;t=t>>>8^t&255^99,L[i]=t,S[t]=i;var v=n[i],s=n[v],h=n[s],u=n[t]*257^t*16843008;_[i]=u<<24|u>>>8,E[i]=u<<16|u>>>16,y[i]=u<<8|u>>>24,p[i]=u,u=h*16843009^s*65537^v*257^i*16843008,r[t]=u<<24|u>>>8,e[t]=u<<16|u>>>16,f[t]=u<<8|u>>>24,c[t]=u,i?(i=v^n[n[n[h^v]]],d^=n[n[d]]):i=d=1}},b.expandKey=function(L){for(var S=this.uint8ArrayToUint32Array_(L),g=!0,_=0;_<S.length&&g;)g=S[_]===this.key[_],_++;if(!g){this.key=S;var E=this.keySize=S.length;if(E!==4&&E!==6&&E!==8)throw new Error("Invalid aes key size="+E);var y=this.ksRows=(E+6+1)*4,p,l,r=this.keySchedule=new Uint32Array(y),e=this.invKeySchedule=new Uint32Array(y),f=this.sBox,c=this.rcon,n=this.invSubMix,i=n[0],d=n[1],o=n[2],t=n[3],v,s;for(p=0;p<y;p++){if(p<E){v=r[p]=S[p];continue}s=v,p%E===0?(s=s<<8|s>>>24,s=f[s>>>24]<<24|f[s>>>16&255]<<16|f[s>>>8&255]<<8|f[s&255],s^=c[p/E|0]<<24):E>6&&p%E===4&&(s=f[s>>>24]<<24|f[s>>>16&255]<<16|f[s>>>8&255]<<8|f[s&255]),r[p]=v=(r[p-E]^s)>>>0}for(l=0;l<y;l++)p=y-l,l&3?s=r[p]:s=r[p-4],l<4||p<=4?e[l]=s:e[l]=i[f[s>>>24]]^d[f[s>>>16&255]]^o[f[s>>>8&255]]^t[f[s&255]],e[l]=e[l]>>>0}},b.networkToHostOrderSwap=function(L){return L<<24|(L&65280)<<8|(L&16711680)>>8|L>>>24},b.decrypt=function(L,S,g){for(var _=this.keySize+6,E=this.invKeySchedule,y=this.invSBox,p=this.invSubMix,l=p[0],r=p[1],e=p[2],f=p[3],c=this.uint8ArrayToUint32Array_(g),n=c[0],i=c[1],d=c[2],o=c[3],t=new Int32Array(L),v=new Int32Array(t.length),s,h,u,a,m,T,P,M,C,x,U,k,w,N,K=this.networkToHostOrderSwap;S<t.length;){for(C=K(t[S]),x=K(t[S+1]),U=K(t[S+2]),k=K(t[S+3]),m=C^E[0],T=k^E[1],P=U^E[2],M=x^E[3],w=4,N=1;N<_;N++)s=l[m>>>24]^r[T>>16&255]^e[P>>8&255]^f[M&255]^E[w],h=l[T>>>24]^r[P>>16&255]^e[M>>8&255]^f[m&255]^E[w+1],u=l[P>>>24]^r[M>>16&255]^e[m>>8&255]^f[T&255]^E[w+2],a=l[M>>>24]^r[m>>16&255]^e[T>>8&255]^f[P&255]^E[w+3],m=s,T=h,P=u,M=a,w=w+4;s=y[m>>>24]<<24^y[T>>16&255]<<16^y[P>>8&255]<<8^y[M&255]^E[w],h=y[T>>>24]<<24^y[P>>16&255]<<16^y[M>>8&255]<<8^y[m&255]^E[w+1],u=y[P>>>24]<<24^y[M>>16&255]<<16^y[m>>8&255]<<8^y[T&255]^E[w+2],a=y[M>>>24]<<24^y[m>>16&255]<<16^y[T>>8&255]<<8^y[P&255]^E[w+3],v[S]=K(s^n),v[S+1]=K(a^i),v[S+2]=K(u^d),v[S+3]=K(h^o),n=C,i=x,d=U,o=k,S=S+4}return v.buffer},R}()},"./src/crypt/decrypter.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>S});var F=D("./src/crypt/aes-crypto.ts"),A=D("./src/crypt/fast-aes-key.ts"),O=D("./src/crypt/aes-decryptor.ts"),R=D("./src/utils/logger.ts"),b=D("./src/utils/mp4-tools.ts"),I=D("./src/utils/typed-array.ts"),L=16,S=function(){function g(E,y,p){var l=p===void 0?{}:p,r=l.removePKCS7Padding,e=r===void 0?!0:r;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=E,this.config=y,this.removePKCS7Padding=e,e)try{var f=self.crypto;f&&(this.subtle=f.subtle||f.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var _=g.prototype;return _.destroy=function(){this.observer=null},_.isSync=function(){return this.config.enableSoftwareAES},_.flush=function(){var y=this.currentResult;if(!y){this.reset();return}var p=new Uint8Array(y);return this.reset(),this.removePKCS7Padding?(0,O.removePadding)(p):p},_.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},_.decrypt=function(y,p,l,r){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(y),p,l);var e=this.flush();e&&r(e.buffer)}else this.webCryptoDecrypt(new Uint8Array(y),p,l).then(r)},_.softwareDecrypt=function(y,p,l){var r=this.currentIV,e=this.currentResult,f=this.remainderData;this.logOnce("JS AES decrypt"),f&&(y=(0,b.appendUint8Array)(f,y),this.remainderData=null);var c=this.getValidChunk(y);if(!c.length)return null;r&&(l=r);var n=this.softwareDecrypter;n||(n=this.softwareDecrypter=new O.default),n.expandKey(p);var i=e;return this.currentResult=n.decrypt(c.buffer,0,l),this.currentIV=(0,I.sliceUint8)(c,-16).buffer,i||null},_.webCryptoDecrypt=function(y,p,l){var r=this,e=this.subtle;return(this.key!==p||!this.fastAesKey)&&(this.key=p,this.fastAesKey=new A.default(e,p)),this.fastAesKey.expandKey().then(function(f){if(!e)return Promise.reject(new Error("web crypto not initialized"));var c=new F.default(e,l);return c.decrypt(y.buffer,f)}).catch(function(f){return r.onWebCryptoError(f,y,p,l)})},_.onWebCryptoError=function(y,p,l,r){return R.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",y),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(p,l,r)},_.getValidChunk=function(y){var p=y,l=y.length-y.length%L;return l!==y.length&&(p=(0,I.sliceUint8)(y,0,l),this.remainderData=(0,I.sliceUint8)(y,l)),p},_.logOnce=function(y){!this.logEnabled||(R.logger.log("[decrypter.ts]: "+y),this.logEnabled=!1)},g}()},"./src/crypt/fast-aes-key.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>F});var F=function(){function A(R,b){this.subtle=void 0,this.key=void 0,this.subtle=R,this.key=b}var O=A.prototype;return O.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},A}()},"./src/demux/aacdemuxer.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>S});var F=D("./src/demux/base-audio-demuxer.ts"),A=D("./src/demux/adts.ts"),O=D("./src/utils/logger.ts"),R=D("./src/demux/id3.ts");function b(g,_){g.prototype=Object.create(_.prototype),g.prototype.constructor=g,I(g,_)}function I(g,_){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,p){return y.__proto__=p,y},I(g,_)}var L=function(g){b(_,g);function _(y,p){var l;return l=g.call(this)||this,l.observer=void 0,l.config=void 0,l.observer=y,l.config=p,l}var E=_.prototype;return E.resetInitSegment=function(p,l,r,e){g.prototype.resetInitSegment.call(this,p,l,r,e),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:l,duration:e,inputTimeScale:9e4,dropped:0}},_.probe=function(p){if(!p)return!1;for(var l=R.getID3Data(p,0)||[],r=l.length,e=p.length;r<e;r++)if(A.probe(p,r))return O.logger.log("ADTS sync word found !"),!0;return!1},E.canParse=function(p,l){return A.canParse(p,l)},E.appendFrame=function(p,l,r){A.initTrackConfig(p,this.observer,l,r,p.manifestCodec);var e=A.appendFrame(p,l,r,this.basePTS,this.frameIndex);if(e&&e.missing===0)return e},_}(F.default);const S=L},"./src/demux/adts.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{appendFrame:()=>r,canGetFrameLength:()=>S,canParse:()=>_,getAudioConfig:()=>R,getFrameDuration:()=>p,getFullFrameLength:()=>L,getHeaderLength:()=>I,initTrackConfig:()=>y,isHeader:()=>g,isHeaderPattern:()=>b,parseFrameHeader:()=>l,probe:()=>E});var F=D("./src/utils/logger.ts"),A=D("./src/errors.ts"),O=D("./src/events.ts");function R(e,f,c,n){var i,d,o,t,v=navigator.userAgent.toLowerCase(),s=n,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=((f[c+2]&192)>>>6)+1;var u=(f[c+2]&60)>>>2;if(u>h.length-1){e.trigger(O.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+u});return}return o=(f[c+2]&1)<<2,o|=(f[c+3]&192)>>>6,F.logger.log("manifest codec:"+n+", ADTS type:"+i+", samplingIndex:"+u),/firefox/i.test(v)?u>=6?(i=5,t=new Array(4),d=u-3):(i=2,t=new Array(2),d=u):v.indexOf("android")!==-1?(i=2,t=new Array(2),d=u):(i=5,t=new Array(4),n&&(n.indexOf("mp4a.40.29")!==-1||n.indexOf("mp4a.40.5")!==-1)||!n&&u>=6?d=u-3:((n&&n.indexOf("mp4a.40.2")!==-1&&(u>=6&&o===1||/vivaldi/i.test(v))||!n&&o===1)&&(i=2,t=new Array(2)),d=u)),t[0]=i<<3,t[0]|=(u&14)>>1,t[1]|=(u&1)<<7,t[1]|=o<<3,i===5&&(t[1]|=(d&14)>>1,t[2]=(d&1)<<7,t[2]|=8,t[3]=0),{config:t,samplerate:h[u],channelCount:o,codec:"mp4a.40."+i,manifestCodec:s}}function b(e,f){return e[f]===255&&(e[f+1]&246)===240}function I(e,f){return e[f+1]&1?7:9}function L(e,f){return(e[f+3]&3)<<11|e[f+4]<<3|(e[f+5]&224)>>>5}function S(e,f){return f+5<e.length}function g(e,f){return f+1<e.length&&b(e,f)}function _(e,f){return S(e,f)&&b(e,f)&&L(e,f)<=e.length-f}function E(e,f){if(g(e,f)){var c=I(e,f);if(f+c>=e.length)return!1;var n=L(e,f);if(n<=c)return!1;var i=f+n;return i===e.length||g(e,i)}return!1}function y(e,f,c,n,i){if(!e.samplerate){var d=R(f,c,n,i);if(!d)return;e.config=d.config,e.samplerate=d.samplerate,e.channelCount=d.channelCount,e.codec=d.codec,e.manifestCodec=d.manifestCodec,F.logger.log("parsed codec:"+e.codec+", rate:"+d.samplerate+", channels:"+d.channelCount)}}function p(e){return 9216e4/e}function l(e,f){var c=I(e,f);if(f+c<=e.length){var n=L(e,f)-c;if(n>0)return{headerLength:c,frameLength:n}}}function r(e,f,c,n,i){var d=p(e.samplerate),o=n+i*d,t=l(f,c),v;if(t){var s=t.frameLength,h=t.headerLength,u=h+s,a=Math.max(0,c+u-f.length);a?(v=new Uint8Array(u-h),v.set(f.subarray(c+h,f.length),0)):v=f.subarray(c+h,c+u);var m={unit:v,pts:o};return a||e.samples.push(m),{sample:m,length:u,missing:a}}var T=f.length-c;v=new Uint8Array(T),v.set(f.subarray(c,f.length),0);var P={unit:v,pts:o};return{sample:P,length:T,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>g,initPTSFn:()=>S});var F=D("./src/polyfills/number.ts"),A=D("./src/demux/id3.ts"),O=D("./src/types/demuxer.ts"),R=D("./src/demux/dummy-demuxed-track.ts"),b=D("./src/utils/mp4-tools.ts"),I=D("./src/utils/typed-array.ts"),L=function(){function _(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var E=_.prototype;return E.resetInitSegment=function(p,l,r,e){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},E.resetTimeStamp=function(p){this.initPTS=p,this.resetContiguity()},E.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},E.canParse=function(p,l){return!1},E.appendFrame=function(p,l,r){},E.demux=function(p,l){this.cachedData&&(p=(0,b.appendUint8Array)(this.cachedData,p),this.cachedData=null);var r=A.getID3Data(p,0),e=r?r.length:0,f,c=this._audioTrack,n=this._id3Track,i=r?A.getTimeStamp(r):void 0,d=p.length;for((this.basePTS===null||this.frameIndex===0&&(0,F.isFiniteNumber)(i))&&(this.basePTS=S(i,l,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&n.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:O.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});e<d;){if(this.canParse(p,e)){var o=this.appendFrame(c,p,e);o?(this.frameIndex++,this.lastPTS=o.sample.pts,e+=o.length,f=e):e=d}else A.canParse(p,e)?(r=A.getID3Data(p,e),n.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:O.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),e+=r.length,f=e):e++;if(e===d&&f!==d){var t=(0,I.sliceUint8)(p,f);this.cachedData?this.cachedData=(0,b.appendUint8Array)(this.cachedData,t):this.cachedData=t}}return{audioTrack:c,videoTrack:(0,R.dummyTrack)(),id3Track:n,textTrack:(0,R.dummyTrack)()}},E.demuxSampleAes=function(p,l,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},E.flush=function(p){var l=this.cachedData;return l&&(this.cachedData=null,this.demux(l,0)),{audioTrack:this._audioTrack,videoTrack:(0,R.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,R.dummyTrack)()}},E.destroy=function(){},_}(),S=function(E,y,p){return(0,F.isFiniteNumber)(E)?E*90:y*9e4+(p||0)};const g=L},"./src/demux/chunk-cache.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>F});var F=function(){function O(){this.chunks=[],this.dataLength=0}var R=O.prototype;return R.push=function(I){this.chunks.push(I),this.dataLength+=I.length},R.flush=function(){var I=this.chunks,L=this.dataLength,S;if(I.length)I.length===1?S=I[0]:S=A(I,L);else return new Uint8Array(0);return this.reset(),S},R.reset=function(){this.chunks.length=0,this.dataLength=0},O}();function A(O,R){for(var b=new Uint8Array(R),I=0,L=0;L<O.length;L++){var S=O[L];b.set(S,I),I+=S.length}return b}},"./src/demux/dummy-demuxed-track.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{dummyTrack:()=>F});function F(A,O){return A===void 0&&(A=""),O===void 0&&(O=9e4),{type:A,id:-1,pid:-1,inputTimeScale:O,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>O});var F=D("./src/utils/logger.ts"),A=function(){function R(I){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=I,this.bytesAvailable=I.byteLength,this.word=0,this.bitsAvailable=0}var b=R.prototype;return b.loadWord=function(){var L=this.data,S=this.bytesAvailable,g=L.byteLength-S,_=new Uint8Array(4),E=Math.min(4,S);if(E===0)throw new Error("no bytes available");_.set(L.subarray(g,g+E)),this.word=new DataView(_.buffer).getUint32(0),this.bitsAvailable=E*8,this.bytesAvailable-=E},b.skipBits=function(L){var S;this.bitsAvailable>L?(this.word<<=L,this.bitsAvailable-=L):(L-=this.bitsAvailable,S=L>>3,L-=S>>3,this.bytesAvailable-=S,this.loadWord(),this.word<<=L,this.bitsAvailable-=L)},b.readBits=function(L){var S=Math.min(this.bitsAvailable,L),g=this.word>>>32-S;return L>32&&F.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=S,this.bitsAvailable>0?this.word<<=S:this.bytesAvailable>0&&this.loadWord(),S=L-S,S>0&&this.bitsAvailable?g<<S|this.readBits(S):g},b.skipLZ=function(){var L;for(L=0;L<this.bitsAvailable;++L)if((this.word&2147483648>>>L)!==0)return this.word<<=L,this.bitsAvailable-=L,L;return this.loadWord(),L+this.skipLZ()},b.skipUEG=function(){this.skipBits(1+this.skipLZ())},b.skipEG=function(){this.skipBits(1+this.skipLZ())},b.readUEG=function(){var L=this.skipLZ();return this.readBits(L+1)-1},b.readEG=function(){var L=this.readUEG();return 1&L?1+L>>>1:-1*(L>>>1)},b.readBoolean=function(){return this.readBits(1)===1},b.readUByte=function(){return this.readBits(8)},b.readUShort=function(){return this.readBits(16)},b.readUInt=function(){return this.readBits(32)},b.skipScalingList=function(L){for(var S=8,g=8,_,E=0;E<L;E++)g!==0&&(_=this.readEG(),g=(S+_+256)%256),S=g===0?S:g},b.readSPS=function(){var L=0,S=0,g=0,_=0,E,y,p,l=this.readUByte.bind(this),r=this.readBits.bind(this),e=this.readUEG.bind(this),f=this.readBoolean.bind(this),c=this.skipBits.bind(this),n=this.skipEG.bind(this),i=this.skipUEG.bind(this),d=this.skipScalingList.bind(this);l();var o=l();if(r(5),c(3),l(),i(),o===100||o===110||o===122||o===244||o===44||o===83||o===86||o===118||o===128){var t=e();if(t===3&&c(1),i(),i(),c(1),f())for(y=t!==3?8:12,p=0;p<y;p++)f()&&(p<6?d(16):d(64))}i();var v=e();if(v===0)e();else if(v===1)for(c(1),n(),n(),E=e(),p=0;p<E;p++)n();i(),c(1);var s=e(),h=e(),u=r(1);u===0&&c(1),c(1),f()&&(L=e(),S=e(),g=e(),_=e());var a=[1,1];if(f()&&f()){var m=l();switch(m){case 1:a=[1,1];break;case 2:a=[12,11];break;case 3:a=[10,11];break;case 4:a=[16,11];break;case 5:a=[40,33];break;case 6:a=[24,11];break;case 7:a=[20,11];break;case 8:a=[32,11];break;case 9:a=[80,33];break;case 10:a=[18,11];break;case 11:a=[15,11];break;case 12:a=[64,33];break;case 13:a=[160,99];break;case 14:a=[4,3];break;case 15:a=[3,2];break;case 16:a=[2,1];break;case 255:{a=[l()<<8|l(),l()<<8|l()];break}}}return{width:Math.ceil((s+1)*16-L*2-S*2),height:(2-u)*(h+1)*16-(u?2:4)*(g+_),pixelRatio:a}},b.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},R}();const O=A},"./src/demux/id3.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{canParse:()=>b,decodeFrame:()=>_,getID3Data:()=>O,getID3Frames:()=>g,getTimeStamp:()=>I,isFooter:()=>A,isHeader:()=>F,isTimeStampFrame:()=>L,testables:()=>e,utf8ArrayToStr:()=>r});var F=function(i,d){return d+10<=i.length&&i[d]===73&&i[d+1]===68&&i[d+2]===51&&i[d+3]<255&&i[d+4]<255&&i[d+6]<128&&i[d+7]<128&&i[d+8]<128&&i[d+9]<128},A=function(i,d){return d+10<=i.length&&i[d]===51&&i[d+1]===68&&i[d+2]===73&&i[d+3]<255&&i[d+4]<255&&i[d+6]<128&&i[d+7]<128&&i[d+8]<128&&i[d+9]<128},O=function(i,d){for(var o=d,t=0;F(i,d);){t+=10;var v=R(i,d+6);t+=v,A(i,d+10)&&(t+=10),d+=t}if(t>0)return i.subarray(o,o+t)},R=function(i,d){var o=0;return o=(i[d]&127)<<21,o|=(i[d+1]&127)<<14,o|=(i[d+2]&127)<<7,o|=i[d+3]&127,o},b=function(i,d){return F(i,d)&&R(i,d+6)+10<=i.length-d},I=function(i){for(var d=g(i),o=0;o<d.length;o++){var t=d[o];if(L(t))return l(t)}},L=function(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"},S=function(i){var d=String.fromCharCode(i[0],i[1],i[2],i[3]),o=R(i,4),t=10;return{type:d,size:o,data:i.subarray(t,t+o)}},g=function(i){for(var d=0,o=[];F(i,d);){var t=R(i,d+6);d+=10;for(var v=d+t;d+8<v;){var s=S(i.subarray(d)),h=_(s);h&&o.push(h),d+=s.size+10}A(i,d)&&(d+=10)}return o},_=function(i){return i.type==="PRIV"?E(i):i.type[0]==="W"?p(i):y(i)},E=function(i){if(!(i.size<2)){var d=r(i.data,!0),o=new Uint8Array(i.data.subarray(d.length+1));return{key:i.type,info:d,data:o.buffer}}},y=function(i){if(!(i.size<2)){if(i.type==="TXXX"){var d=1,o=r(i.data.subarray(d),!0);d+=o.length+1;var t=r(i.data.subarray(d));return{key:i.type,info:o,data:t}}var v=r(i.data.subarray(1));return{key:i.type,data:v}}},p=function(i){if(i.type==="WXXX"){if(i.size<2)return;var d=1,o=r(i.data.subarray(d),!0);d+=o.length+1;var t=r(i.data.subarray(d));return{key:i.type,info:o,data:t}}var v=r(i.data);return{key:i.type,data:v}},l=function(i){if(i.data.byteLength===8){var d=new Uint8Array(i.data),o=d[3]&1,t=(d[4]<<23)+(d[5]<<15)+(d[6]<<7)+d[7];return t/=45,o&&(t+=4772185884e-2),Math.round(t)}},r=function(i,d){d===void 0&&(d=!1);var o=c();if(o){var t=o.decode(i);if(d){var v=t.indexOf("\0");return v!==-1?t.substring(0,v):t}return t.replace(/\0/g,"")}for(var s=i.length,h,u,a,m="",T=0;T<s;){if(h=i[T++],h===0&&d)return m;if(h===0||h===3)continue;switch(h>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:m+=String.fromCharCode(h);break;case 12:case 13:u=i[T++],m+=String.fromCharCode((h&31)<<6|u&63);break;case 14:u=i[T++],a=i[T++],m+=String.fromCharCode((h&15)<<12|(u&63)<<6|(a&63)<<0);break;default:}}return m},e={decodeTextFrame:y},f;function c(){return!f&&typeof self.TextDecoder<"u"&&(f=new self.TextDecoder("utf-8")),f}},"./src/demux/mp3demuxer.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>S});var F=D("./src/demux/base-audio-demuxer.ts"),A=D("./src/demux/id3.ts"),O=D("./src/utils/logger.ts"),R=D("./src/demux/mpegaudio.ts");function b(g,_){g.prototype=Object.create(_.prototype),g.prototype.constructor=g,I(g,_)}function I(g,_){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,p){return y.__proto__=p,y},I(g,_)}var L=function(g){b(_,g);function _(){return g.apply(this,arguments)||this}var E=_.prototype;return E.resetInitSegment=function(p,l,r,e){g.prototype.resetInitSegment.call(this,p,l,r,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:l,duration:e,inputTimeScale:9e4,dropped:0}},_.probe=function(p){if(!p)return!1;for(var l=A.getID3Data(p,0)||[],r=l.length,e=p.length;r<e;r++)if(R.probe(p,r))return O.logger.log("MPEG Audio sync word found !"),!0;return!1},E.canParse=function(p,l){return R.canParse(p,l)},E.appendFrame=function(p,l,r){if(this.basePTS!==null)return R.appendFrame(p,l,r,this.basePTS,this.frameIndex)},_}(F.default);const S=L},"./src/demux/mp4demuxer.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>L});var F=D("./src/polyfills/number.ts"),A=D("./src/types/demuxer.ts"),O=D("./src/utils/mp4-tools.ts"),R=D("./src/demux/dummy-demuxed-track.ts"),b=/\/emsg[-/]ID3/i,I=function(){function S(_,E){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=E}var g=S.prototype;return g.resetTimeStamp=function(){},g.resetInitSegment=function(E,y,p,l){var r=(0,O.parseInitSegment)(E),e=this.videoTrack=(0,R.dummyTrack)("video",1),f=this.audioTrack=(0,R.dummyTrack)("audio",1),c=this.txtTrack=(0,R.dummyTrack)("text",1);if(this.id3Track=(0,R.dummyTrack)("id3",1),this.timeOffset=0,r.video){var n=r.video,i=n.id,d=n.timescale,o=n.codec;e.id=i,e.timescale=c.timescale=d,e.codec=o}if(r.audio){var t=r.audio,v=t.id,s=t.timescale,h=t.codec;f.id=v,f.timescale=s,f.codec=h}c.id=O.RemuxerTrackIdConfig.text,e.sampleDuration=0,e.duration=f.duration=l},g.resetContiguity=function(){},S.probe=function(E){return E=E.length>16384?E.subarray(0,16384):E,(0,O.findBox)(E,["moof"]).length>0},g.demux=function(E,y){this.timeOffset=y;var p=E,l=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(p=(0,O.appendUint8Array)(this.remainderData,E));var e=(0,O.segmentValidRange)(p);this.remainderData=e.remainder,l.samples=e.valid||new Uint8Array}else l.samples=p;var f=this.extractID3Track(l,y);return r.samples=(0,O.parseSamples)(y,l),{videoTrack:l,audioTrack:this.audioTrack,id3Track:f,textTrack:this.txtTrack}},g.flush=function(){var E=this.timeOffset,y=this.videoTrack,p=this.txtTrack;y.samples=this.remainderData||new Uint8Array,this.remainderData=null;var l=this.extractID3Track(y,this.timeOffset);return p.samples=(0,O.parseSamples)(E,y),{videoTrack:y,audioTrack:(0,R.dummyTrack)(),id3Track:l,textTrack:(0,R.dummyTrack)()}},g.extractID3Track=function(E,y){var p=this.id3Track;if(E.samples.length){var l=(0,O.findBox)(E.samples,["emsg"]);l&&l.forEach(function(r){var e=(0,O.parseEmsg)(r);if(b.test(e.schemeIdUri)){var f=(0,F.isFiniteNumber)(e.presentationTime)?e.presentationTime/e.timeScale:y+e.presentationTimeDelta/e.timeScale,c=e.eventDuration===4294967295?Number.POSITIVE_INFINITY:e.eventDuration/e.timeScale;c<=.001&&(c=Number.POSITIVE_INFINITY);var n=e.payload;p.samples.push({data:n,len:n.byteLength,dts:f,pts:f,type:A.MetadataSchema.emsg,duration:c})}})}return p},g.demuxSampleAes=function(E,y,p){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},g.destroy=function(){},S}();const L=I},"./src/demux/mpegaudio.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{appendFrame:()=>I,canParse:()=>_,isHeader:()=>g,isHeaderPattern:()=>S,parseHeader:()=>L,probe:()=>E});var F=null,A=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],O=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],R=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],b=[0,1,1,4];function I(y,p,l,r,e){if(!(l+24>p.length)){var f=L(p,l);if(f&&l+f.frameLength<=p.length){var c=f.samplesPerFrame*9e4/f.sampleRate,n=r+e*c,i={unit:p.subarray(l,l+f.frameLength),pts:n,dts:n};return y.config=[],y.channelCount=f.channelCount,y.samplerate=f.sampleRate,y.samples.push(i),{sample:i,length:f.frameLength,missing:0}}}}function L(y,p){var l=y[p+1]>>3&3,r=y[p+1]>>1&3,e=y[p+2]>>4&15,f=y[p+2]>>2&3;if(l!==1&&e!==0&&e!==15&&f!==3){var c=y[p+2]>>1&1,n=y[p+3]>>6,i=l===3?3-r:r===3?3:4,d=A[i*14+e-1]*1e3,o=l===3?0:l===2?1:2,t=O[o*3+f],v=n===3?1:2,s=R[l][r],h=b[r],u=s*8*h,a=Math.floor(s*d/t+c)*h;if(F===null){var m=navigator.userAgent||"",T=m.match(/Chrome\/(\d+)/i);F=T?parseInt(T[1]):0}var P=!!F&&F<=87;return P&&r===2&&d>=224e3&&n===0&&(y[p+3]=y[p+3]|128),{sampleRate:t,channelCount:v,frameLength:a,samplesPerFrame:u}}}function S(y,p){return y[p]===255&&(y[p+1]&224)===224&&(y[p+1]&6)!==0}function g(y,p){return p+1<y.length&&S(y,p)}function _(y,p){var l=4;return S(y,p)&&l<=y.length-p}function E(y,p){if(p+1<y.length&&S(y,p)){var l=4,r=L(y,p),e=l;r!=null&&r.frameLength&&(e=r.frameLength);var f=p+e;return f===y.length||g(y,f)}return!1}},"./src/demux/sample-aes.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>R});var F=D("./src/crypt/decrypter.ts"),A=D("./src/utils/mp4-tools.ts"),O=function(){function b(L,S,g){this.keyData=void 0,this.decrypter=void 0,this.keyData=g,this.decrypter=new F.default(L,S,{removePKCS7Padding:!1})}var I=b.prototype;return I.decryptBuffer=function(S,g){this.decrypter.decrypt(S,this.keyData.key.buffer,this.keyData.iv.buffer,g)},I.decryptAacSample=function(S,g,_,E){var y=S[g].unit;if(!(y.length<=16)){var p=y.subarray(16,y.length-y.length%16),l=p.buffer.slice(p.byteOffset,p.byteOffset+p.length),r=this;this.decryptBuffer(l,function(e){var f=new Uint8Array(e);y.set(f,16),E||r.decryptAacSamples(S,g+1,_)})}},I.decryptAacSamples=function(S,g,_){for(;;g++){if(g>=S.length){_();return}if(!(S[g].unit.length<32)){var E=this.decrypter.isSync();if(this.decryptAacSample(S,g,_,E),!E)return}}},I.getAvcEncryptedData=function(S){for(var g=Math.floor((S.length-48)/160)*16+16,_=new Int8Array(g),E=0,y=32;y<S.length-16;y+=160,E+=16)_.set(S.subarray(y,y+16),E);return _},I.getAvcDecryptedUnit=function(S,g){for(var _=new Uint8Array(g),E=0,y=32;y<S.length-16;y+=160,E+=16)S.set(_.subarray(E,E+16),y);return S},I.decryptAvcSample=function(S,g,_,E,y,p){var l=(0,A.discardEPB)(y.data),r=this.getAvcEncryptedData(l),e=this;this.decryptBuffer(r.buffer,function(f){y.data=e.getAvcDecryptedUnit(l,f),p||e.decryptAvcSamples(S,g,_+1,E)})},I.decryptAvcSamples=function(S,g,_,E){if(S instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;g++,_=0){if(g>=S.length){E();return}for(var y=S[g].units;!(_>=y.length);_++){var p=y[_];if(!(p.data.length<=48||p.type!==1&&p.type!==5)){var l=this.decrypter.isSync();if(this.decryptAvcSample(S,g,_,E,p,l),!l)return}}}},b}();const R=O},"./src/demux/transmuxer-interface.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>_});var F=D("./src/demux/webworkify-webpack.js"),A=D("./src/events.ts"),O=D("./src/demux/transmuxer.ts"),R=D("./src/utils/logger.ts"),b=D("./src/errors.ts"),I=D("./src/utils/mediasource-helper.ts"),L=D("./node_modules/eventemitter3/index.js"),S=D.n(L),g=(0,I.getMediaSource)()||{isTypeSupported:function(){return!1}},_=function(){function E(p,l,r,e){var f=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var c=p.config;this.hls=p,this.id=l,this.useWorker=!!c.enableWorker,this.onTransmuxComplete=r,this.onFlush=e;var n=function(v,s){s=s||{},s.frag=f.frag,s.id=f.id,f.hls.trigger(v,s)};this.observer=new L.EventEmitter,this.observer.on(A.Events.FRAG_DECRYPTED,n),this.observer.on(A.Events.ERROR,n);var i={mp4:g.isTypeSupported("video/mp4"),mpeg:g.isTypeSupported("audio/mpeg"),mp3:g.isTypeSupported('audio/mp4; codecs="mp3"')},d=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){R.logger.log("demuxing in webworker");var o;try{o=this.worker=(0,F.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(t){f.useWorker=!1,R.logger.warn("Exception in webworker, fallback to inline"),f.hls.trigger(A.Events.ERROR,{type:b.ErrorTypes.OTHER_ERROR,details:b.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(t.message+"  ("+t.filename+":"+t.lineno+")")})},o.postMessage({cmd:"init",typeSupported:i,vendor:d,id:l,config:JSON.stringify(c)})}catch(t){R.logger.warn("Error in worker:",t),R.logger.error("Error while initializing DemuxerWorker, fallback to inline"),o&&self.URL.revokeObjectURL(o.objectURL),this.transmuxer=new O.default(this.observer,i,c,d,l),this.worker=null}}else this.transmuxer=new O.default(this.observer,i,c,d,l)}var y=E.prototype;return y.destroy=function(){var l=this.worker;if(l)l.removeEventListener("message",this.onwmsg),l.terminate(),this.worker=null,this.onwmsg=void 0;else{var r=this.transmuxer;r&&(r.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},y.push=function(l,r,e,f,c,n,i,d,o,t){var v,s,h=this;o.transmuxing.start=self.performance.now();var u=this.transmuxer,a=this.worker,m=n?n.start:c.start,T=c.decryptdata,P=this.frag,M=!(P&&c.cc===P.cc),C=!(P&&o.level===P.level),x=P?o.sn-P.sn:-1,U=this.part?o.part-this.part.index:-1,k=x===0&&o.id>1&&o.id===P?.stats.chunkCount,w=!C&&(x===1||x===0&&(U===1||k&&U<=0)),N=self.performance.now();(C||x||c.stats.parsing.start===0)&&(c.stats.parsing.start=N),n&&(U||!w)&&(n.stats.parsing.start=N);var K=!(P&&((v=c.initSegment)===null||v===void 0?void 0:v.url)===((s=P.initSegment)===null||s===void 0?void 0:s.url)),G=new O.TransmuxState(M,w,d,C,m,K);if(!w||M||K){R.logger.log("[transmuxer-interface, "+c.type+"]: Starting new transmux session for sn: "+o.sn+" p: "+o.part+" level: "+o.level+" id: "+o.id+`
        discontinuity: `+M+`
        trackSwitch: `+C+`
        contiguous: `+w+`
        accurateTimeOffset: `+d+`
        timeOffset: `+m+`
        initSegmentChange: `+K);var H=new O.TransmuxConfig(e,f,r,i,t);this.configureTransmuxer(H)}if(this.frag=c,this.part=n,a)a.postMessage({cmd:"demux",data:l,decryptdata:T,chunkMeta:o,state:G},l instanceof ArrayBuffer?[l]:[]);else if(u){var V=u.push(l,T,o,G);(0,O.isPromise)(V)?V.then(function(X){h.handleTransmuxComplete(X)}):this.handleTransmuxComplete(V)}},y.flush=function(l){var r=this;l.transmuxing.start=self.performance.now();var e=this.transmuxer,f=this.worker;if(f)f.postMessage({cmd:"flush",chunkMeta:l});else if(e){var c=e.flush(l);(0,O.isPromise)(c)?c.then(function(n){r.handleFlushResult(n,l)}):this.handleFlushResult(c,l)}},y.handleFlushResult=function(l,r){var e=this;l.forEach(function(f){e.handleTransmuxComplete(f)}),this.onFlush(r)},y.onWorkerMessage=function(l){var r=l.data,e=this.hls;switch(r.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(r.data);break}case"flush":{this.onFlush(r.data);break}case"workerLog":R.logger[r.data.logType]&&R.logger[r.data.logType](r.data.message);break;default:{r.data=r.data||{},r.data.frag=this.frag,r.data.id=this.id,e.trigger(r.event,r.data);break}}},y.configureTransmuxer=function(l){var r=this.worker,e=this.transmuxer;r?r.postMessage({cmd:"configure",config:l}):e&&e.configure(l)},y.handleTransmuxComplete=function(l){l.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(l)},E}()},"./src/demux/transmuxer-worker.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>I});var F=D("./src/demux/transmuxer.ts"),A=D("./src/events.ts"),O=D("./src/utils/logger.ts"),R=D("./node_modules/eventemitter3/index.js"),b=D.n(R);function I(E){var y=new R.EventEmitter,p=function(e,f){E.postMessage({event:e,data:f})};y.on(A.Events.FRAG_DECRYPTED,p),y.on(A.Events.ERROR,p);var l=function(){var e=function(n){var i=function(o){p("workerLog",{logType:n,message:o})};O.logger[n]=i};for(var f in O.logger)e(f)};E.addEventListener("message",function(r){var e=r.data;switch(e.cmd){case"init":{var f=JSON.parse(e.config);E.transmuxer=new F.default(y,e.typeSupported,f,e.vendor,e.id),(0,O.enableLogs)(f.debug,e.id),l(),p("init",null);break}case"configure":{E.transmuxer.configure(e.config);break}case"demux":{var c=E.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);(0,F.isPromise)(c)?c.then(function(d){L(E,d)}):L(E,c);break}case"flush":{var n=e.chunkMeta,i=E.transmuxer.flush(n);(0,F.isPromise)(i)?i.then(function(d){g(E,d,n)}):g(E,i,n);break}default:break}})}function L(E,y){if(_(y.remuxResult))return!1;var p=[],l=y.remuxResult,r=l.audio,e=l.video;return r&&S(p,r),e&&S(p,e),E.postMessage({event:"transmuxComplete",data:y},p),!0}function S(E,y){y.data1&&E.push(y.data1.buffer),y.data2&&E.push(y.data2.buffer)}function g(E,y,p){var l=y.reduce(function(r,e){return L(E,e)||r},!1);l||E.postMessage({event:"transmuxComplete",data:y[0]}),E.postMessage({event:"flush",data:p})}function _(E){return!E.audio&&!E.video&&!E.text&&!E.id3&&!E.initSegment}},"./src/demux/transmuxer.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{TransmuxConfig:()=>f,TransmuxState:()=>c,default:()=>p,isPromise:()=>e});var F=D("./src/events.ts"),A=D("./src/errors.ts"),O=D("./src/crypt/decrypter.ts"),R=D("./src/demux/aacdemuxer.ts"),b=D("./src/demux/mp4demuxer.ts"),I=D("./src/demux/tsdemuxer.ts"),L=D("./src/demux/mp3demuxer.ts"),S=D("./src/remux/mp4-remuxer.ts"),g=D("./src/remux/passthrough-remuxer.ts"),_=D("./src/utils/logger.ts"),E;try{E=self.performance.now.bind(self.performance)}catch{_.logger.debug("Unable to use Performance API on this environment"),E=self.Date.now}var y=[{demux:I.default,remux:S.default},{demux:b.default,remux:g.default},{demux:R.default,remux:S.default},{demux:L.default,remux:S.default}],p=function(){function n(d,o,t,v,s){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=d,this.typeSupported=o,this.config=t,this.vendor=v,this.id=s}var i=n.prototype;return i.configure=function(o){this.transmuxConfig=o,this.decrypter&&this.decrypter.reset()},i.push=function(o,t,v,s){var h=this,u=v.transmuxing;u.executeStart=E();var a=new Uint8Array(o),m=this.config,T=this.currentTransmuxState,P=this.transmuxConfig;s&&(this.currentTransmuxState=s);var M=s||T,C=M.contiguous,x=M.discontinuity,U=M.trackSwitch,k=M.accurateTimeOffset,w=M.timeOffset,N=M.initSegmentChange,K=P.audioCodec,G=P.videoCodec,H=P.defaultInitPts,V=P.duration,X=P.initSegmentData;(x||U||N)&&this.resetInitSegment(X,K,G,V),(x||N)&&this.resetInitialTimestamp(H),C||this.resetContiguity();var Y=l(a,t);if(Y&&Y.method==="AES-128"){var Q=this.getDecrypter();if(m.enableSoftwareAES){var $=Q.softwareDecrypt(a,Y.key.buffer,Y.iv.buffer);if(!$)return u.executeEnd=E(),r(v);a=new Uint8Array($)}else return this.decryptionPromise=Q.webCryptoDecrypt(a,Y.key.buffer,Y.iv.buffer).then(function(J){var Z=h.push(J,null,v);return h.decryptionPromise=null,Z}),this.decryptionPromise}this.needsProbing(a,x,U)&&this.configureTransmuxer(a,P);var z=this.transmux(a,Y,w,k,v),j=this.currentTransmuxState;return j.contiguous=!0,j.discontinuity=!1,j.trackSwitch=!1,u.executeEnd=E(),z},i.flush=function(o){var t=this,v=o.transmuxing;v.executeStart=E();var s=this.decrypter,h=this.currentTransmuxState,u=this.decryptionPromise;if(u)return u.then(function(){return t.flush(o)});var a=[],m=h.timeOffset;if(s){var T=s.flush();T&&a.push(this.push(T,null,o))}var P=this.demuxer,M=this.remuxer;if(!P||!M)return this.observer.emit(F.Events.ERROR,F.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),v.executeEnd=E(),[r(o)];var C=P.flush(m);return e(C)?C.then(function(x){return t.flushRemux(a,x,o),a}):(this.flushRemux(a,C,o),a)},i.flushRemux=function(o,t,v){var s=t.audioTrack,h=t.videoTrack,u=t.id3Track,a=t.textTrack,m=this.currentTransmuxState,T=m.accurateTimeOffset,P=m.timeOffset;_.logger.log("[transmuxer.ts]: Flushed fragment "+v.sn+(v.part>-1?" p: "+v.part:"")+" of level "+v.level);var M=this.remuxer.remux(s,h,u,a,P,T,!0,this.id);o.push({remuxResult:M,chunkMeta:v}),v.transmuxing.executeEnd=E()},i.resetInitialTimestamp=function(o){var t=this.demuxer,v=this.remuxer;!t||!v||(t.resetTimeStamp(o),v.resetTimeStamp(o))},i.resetContiguity=function(){var o=this.demuxer,t=this.remuxer;!o||!t||(o.resetContiguity(),t.resetNextTimestamp())},i.resetInitSegment=function(o,t,v,s){var h=this.demuxer,u=this.remuxer;!h||!u||(h.resetInitSegment(o,t,v,s),u.resetInitSegment(o,t,v))},i.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},i.transmux=function(o,t,v,s,h){var u;return t&&t.method==="SAMPLE-AES"?u=this.transmuxSampleAes(o,t,v,s,h):u=this.transmuxUnencrypted(o,v,s,h),u},i.transmuxUnencrypted=function(o,t,v,s){var h=this.demuxer.demux(o,t,!1,!this.config.progressive),u=h.audioTrack,a=h.videoTrack,m=h.id3Track,T=h.textTrack,P=this.remuxer.remux(u,a,m,T,t,v,!1,this.id);return{remuxResult:P,chunkMeta:s}},i.transmuxSampleAes=function(o,t,v,s,h){var u=this;return this.demuxer.demuxSampleAes(o,t,v).then(function(a){var m=u.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,v,s,!1,u.id);return{remuxResult:m,chunkMeta:h}})},i.configureTransmuxer=function(o,t){for(var v=this.config,s=this.observer,h=this.typeSupported,u=this.vendor,a=t.audioCodec,m=t.defaultInitPts,T=t.duration,P=t.initSegmentData,M=t.videoCodec,C,x=0,U=y.length;x<U;x++)if(y[x].demux.probe(o)){C=y[x];break}C||(_.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),C={demux:b.default,remux:g.default});var k=this.demuxer,w=this.remuxer,N=C.remux,K=C.demux;(!w||!(w instanceof N))&&(this.remuxer=new N(s,v,h,u)),(!k||!(k instanceof K))&&(this.demuxer=new K(s,v,h),this.probe=K.probe),this.resetInitSegment(P,a,M,T),this.resetInitialTimestamp(m)},i.needsProbing=function(o,t,v){return!this.demuxer||!this.remuxer||t||v},i.getDecrypter=function(){var o=this.decrypter;return o||(o=this.decrypter=new O.default(this.observer,this.config)),o},n}();function l(n,i){var d=null;return n.byteLength>0&&i!=null&&i.key!=null&&i.iv!==null&&i.method!=null&&(d=i),d}var r=function(i){return{remuxResult:{},chunkMeta:i}};function e(n){return"then"in n&&n.then instanceof Function}var f=function(i,d,o,t,v){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=i,this.videoCodec=d,this.initSegmentData=o,this.duration=t,this.defaultInitPts=v},c=function(i,d,o,t,v,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=i,this.contiguous=d,this.accurateTimeOffset=o,this.trackSwitch=t,this.timeOffset=v,this.initSegmentChange=s}},"./src/demux/tsdemuxer.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>c});var F=D("./src/demux/adts.ts"),A=D("./src/demux/mpegaudio.ts"),O=D("./src/demux/exp-golomb.ts"),R=D("./src/demux/sample-aes.ts"),b=D("./src/events.ts"),I=D("./src/utils/mp4-tools.ts"),L=D("./src/utils/logger.ts"),S=D("./src/errors.ts"),g=D("./src/types/demuxer.ts");function _(){return _=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var d=arguments[i];for(var o in d)Object.prototype.hasOwnProperty.call(d,o)&&(n[o]=d[o])}return n},_.apply(this,arguments)}var E=188,y=function(){function n(d,o,t){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=d,this.config=o,this.typeSupported=t}n.probe=function(o){var t=n.syncOffset(o);return t>0&&L.logger.warn("MPEG2-TS detected but first sync word found @ offset "+t),t!==-1},n.syncOffset=function(o){for(var t=Math.min(E*5,o.length-E*2)+1,v=0;v<t;){if(o[v]===71&&o[v+E]===71)return v;v++}return-1},n.createTrack=function(o,t){return{container:o==="video"||o==="audio"?"video/mp2t":void 0,type:o,id:I.RemuxerTrackIdConfig[o],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:o==="audio"?t:void 0}};var i=n.prototype;return i.resetInitSegment=function(o,t,v,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=n.createTrack("video"),this._audioTrack=n.createTrack("audio",s),this._id3Track=n.createTrack("id3"),this._txtTrack=n.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=v,this._duration=s},i.resetTimeStamp=function(){},i.resetContiguity=function(){var o=this._audioTrack,t=this._avcTrack,v=this._id3Track;o&&(o.pesData=null),t&&(t.pesData=null),v&&(v.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},i.demux=function(o,t,v,s){v===void 0&&(v=!1),s===void 0&&(s=!1),v||(this.sampleAes=null);var h,u=this._avcTrack,a=this._audioTrack,m=this._id3Track,T=this._txtTrack,P=u.pid,M=u.pesData,C=a.pid,x=m.pid,U=a.pesData,k=m.pesData,w=null,N=this.pmtParsed,K=this._pmtId,G=o.length;if(this.remainderData&&(o=(0,I.appendUint8Array)(this.remainderData,o),G=o.length,this.remainderData=null),G<E&&!s)return this.remainderData=o,{audioTrack:a,videoTrack:u,id3Track:m,textTrack:T};var H=Math.max(0,n.syncOffset(o));G-=(G-H)%E,G<o.byteLength&&!s&&(this.remainderData=new Uint8Array(o.buffer,G,o.buffer.byteLength-G));for(var V=0,X=H;X<G;X+=E)if(o[X]===71){var Y=!!(o[X+1]&64),Q=((o[X+1]&31)<<8)+o[X+2],$=(o[X+3]&48)>>4,z=void 0;if($>1){if(z=X+5+o[X+4],z===X+E)continue}else z=X+4;switch(Q){case P:Y&&(M&&(h=e(M))&&this.parseAVCPES(u,T,h,!1),M={data:[],size:0}),M&&(M.data.push(o.subarray(z,X+E)),M.size+=X+E-z);break;case C:if(Y){if(U&&(h=e(U)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,h);break;case"mp3":this.parseMPEGPES(a,h);break}U={data:[],size:0}}U&&(U.data.push(o.subarray(z,X+E)),U.size+=X+E-z);break;case x:Y&&(k&&(h=e(k))&&this.parseID3PES(m,h),k={data:[],size:0}),k&&(k.data.push(o.subarray(z,X+E)),k.size+=X+E-z);break;case 0:Y&&(z+=o[z]+1),K=this._pmtId=l(o,z);break;case K:{Y&&(z+=o[z]+1);var j=r(o,z,this.typeSupported,v);P=j.avc,P>0&&(u.pid=P),C=j.audio,C>0&&(a.pid=C,a.segmentCodec=j.segmentCodec),x=j.id3,x>0&&(m.pid=x),w!==null&&!N&&(L.logger.log("unknown PID '"+w+"' in TS found"),w=null,X=H-188),N=this.pmtParsed=!0;break}case 17:case 8191:break;default:w=Q;break}}else V++;V>0&&this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+V+" TS packet/s that do not start with 0x47"}),u.pesData=M,a.pesData=U,m.pesData=k;var J={audioTrack:a,videoTrack:u,id3Track:m,textTrack:T};return s&&this.extractRemainingSamples(J),J},i.flush=function(){var o=this.remainderData;this.remainderData=null;var t;return o?t=this.demux(o,-1,!1,!0):t={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t},i.extractRemainingSamples=function(o){var t=o.audioTrack,v=o.videoTrack,s=o.id3Track,h=o.textTrack,u=v.pesData,a=t.pesData,m=s.pesData,T;if(u&&(T=e(u))?(this.parseAVCPES(v,h,T,!0),v.pesData=null):v.pesData=u,a&&(T=e(a))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,T);break;case"mp3":this.parseMPEGPES(t,T);break}t.pesData=null}else a!=null&&a.size&&L.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;m&&(T=e(m))?(this.parseID3PES(s,T),s.pesData=null):s.pesData=m},i.demuxSampleAes=function(o,t,v){var s=this.demux(o,v,!0,!this.config.progressive),h=this.sampleAes=new R.default(this.observer,this.config,t);return this.decrypt(s,h)},i.decrypt=function(o,t){return new Promise(function(v){var s=o.audioTrack,h=o.videoTrack;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,function(){h.samples?t.decryptAvcSamples(h.samples,0,0,function(){v(o)}):v(o)}):h.samples&&t.decryptAvcSamples(h.samples,0,0,function(){v(o)})})},i.destroy=function(){this._duration=0},i.parseAVCPES=function(o,t,v,s){var h=this,u=this.parseAVCNALu(o,v.data),a=!1,m=this.avcSample,T,P=!1;v.data=null,m&&u.length&&!o.audFound&&(f(m,o),m=this.avcSample=p(!1,v.pts,v.dts,"")),u.forEach(function(M){switch(M.type){case 1:{T=!0,m||(m=h.avcSample=p(!0,v.pts,v.dts,"")),a&&(m.debug+="NDR "),m.frame=!0;var C=M.data;if(P&&C.length>4){var x=new O.default(C).readSliceType();(x===2||x===4||x===7||x===9)&&(m.key=!0)}break}case 5:T=!0,m||(m=h.avcSample=p(!0,v.pts,v.dts,"")),a&&(m.debug+="IDR "),m.key=!0,m.frame=!0;break;case 6:{T=!0,a&&m&&(m.debug+="SEI "),(0,I.parseSEIMessageFromNALu)(M.data,1,v.pts,t.samples);break}case 7:if(T=!0,P=!0,a&&m&&(m.debug+="SPS "),!o.sps){var U=new O.default(M.data),k=U.readSPS();o.width=k.width,o.height=k.height,o.pixelRatio=k.pixelRatio,o.sps=[M.data],o.duration=h._duration;for(var w=M.data.subarray(1,4),N="avc1.",K=0;K<3;K++){var G=w[K].toString(16);G.length<2&&(G="0"+G),N+=G}o.codec=N}break;case 8:T=!0,a&&m&&(m.debug+="PPS "),o.pps||(o.pps=[M.data]);break;case 9:T=!1,o.audFound=!0,m&&f(m,o),m=h.avcSample=p(!1,v.pts,v.dts,a?"AUD ":"");break;case 12:T=!0;break;default:T=!1,m&&(m.debug+="unknown NAL "+M.type+" ");break}if(m&&T){var H=m.units;H.push(M)}}),s&&m&&(f(m,o),this.avcSample=null)},i.getLastNalUnit=function(o){var t,v=this.avcSample,s;if((!v||v.units.length===0)&&(v=o[o.length-1]),(t=v)!==null&&t!==void 0&&t.units){var h=v.units;s=h[h.length-1]}return s},i.parseAVCNALu=function(o,t){var v=t.byteLength,s=o.naluState||0,h=s,u=[],a=0,m,T,P,M=-1,C=0;for(s===-1&&(M=0,C=t[0]&31,s=0,a=1);a<v;){if(m=t[a++],!s){s=m?0:1;continue}if(s===1){s=m?0:2;continue}if(!m)s=3;else if(m===1){if(M>=0){var x={data:t.subarray(M,a-s-1),type:C};u.push(x)}else{var U=this.getLastNalUnit(o.samples);if(U&&(h&&a<=4-h&&U.state&&(U.data=U.data.subarray(0,U.data.byteLength-h)),T=a-s-1,T>0)){var k=new Uint8Array(U.data.byteLength+T);k.set(U.data,0),k.set(t.subarray(0,T),U.data.byteLength),U.data=k,U.state=0}}a<v?(P=t[a]&31,M=a,C=P,s=0):s=-1}else s=0}if(M>=0&&s>=0){var w={data:t.subarray(M,v),type:C,state:s};u.push(w)}if(u.length===0){var N=this.getLastNalUnit(o.samples);if(N){var K=new Uint8Array(N.data.byteLength+t.byteLength);K.set(N.data,0),K.set(t,N.data.byteLength),N.data=K}}return o.naluState=s,u},i.parseAACPES=function(o,t){var v=0,s=this.aacOverFlow,h=t.data;if(s){this.aacOverFlow=null;var u=s.missing,a=s.sample.unit.byteLength;if(u===-1){var m=new Uint8Array(a+h.byteLength);m.set(s.sample.unit,0),m.set(h,a),h=m}else{var T=a-u;s.sample.unit.set(h.subarray(0,u),T),o.samples.push(s.sample),v=s.missing}}var P,M;for(P=v,M=h.length;P<M-1&&!F.isHeader(h,P);P++);if(P!==v){var C,x;if(P<M-1?(C="AAC PES did not start with ADTS header,offset:"+P,x=!1):(C="no ADTS header found in AAC PES",x=!0),L.logger.warn("parsing error:"+C),this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:x,reason:C}),x)return}F.initTrackConfig(o,this.observer,h,P,this.audioCodec);var U;if(t.pts!==void 0)U=t.pts;else if(s){var k=F.getFrameDuration(o.samplerate);U=s.sample.pts+k}else{L.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var w=0,N;P<M;)if(N=F.appendFrame(o,h,P,U,w),P+=N.length,N.missing){this.aacOverFlow=N;break}else for(w++;P<M-1&&!F.isHeader(h,P);P++);},i.parseMPEGPES=function(o,t){var v=t.data,s=v.length,h=0,u=0,a=t.pts;if(a===void 0){L.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;u<s;)if(A.isHeader(v,u)){var m=A.appendFrame(o,v,u,a,h);if(m)u+=m.length,h++;else break}else u++},i.parseID3PES=function(o,t){if(t.pts===void 0){L.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var v=_({},t,{type:this._avcTrack?g.MetadataSchema.emsg:g.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});o.samples.push(v)},n}();function p(n,i,d,o){return{key:n,frame:!1,pts:i,dts:d,units:[],debug:o,length:0}}function l(n,i){return(n[i+10]&31)<<8|n[i+11]}function r(n,i,d,o){var t={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},v=(n[i+1]&15)<<8|n[i+2],s=i+3+v-4,h=(n[i+10]&15)<<8|n[i+11];for(i+=12+h;i<s;){var u=(n[i+1]&31)<<8|n[i+2];switch(n[i]){case 207:if(!o){L.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:t.audio===-1&&(t.audio=u);break;case 21:t.id3===-1&&(t.id3=u);break;case 219:if(!o){L.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:t.avc===-1&&(t.avc=u);break;case 3:case 4:d.mpeg!==!0&&d.mp3!==!0?L.logger.log("MPEG audio found, not supported in this browser"):t.audio===-1&&(t.audio=u,t.segmentCodec="mp3");break;case 36:L.logger.warn("Unsupported HEVC stream type found");break;default:break}i+=((n[i+3]&15)<<8|n[i+4])+5}return t}function e(n){var i=0,d,o,t,v,s,h=n.data;if(!n||n.size===0)return null;for(;h[0].length<19&&h.length>1;){var u=new Uint8Array(h[0].length+h[1].length);u.set(h[0]),u.set(h[1],h[0].length),h[0]=u,h.splice(1,1)}d=h[0];var a=(d[0]<<16)+(d[1]<<8)+d[2];if(a===1){if(o=(d[4]<<8)+d[5],o&&o>n.size-6)return null;var m=d[7];m&192&&(v=(d[9]&14)*536870912+(d[10]&255)*4194304+(d[11]&254)*16384+(d[12]&255)*128+(d[13]&254)/2,m&64?(s=(d[14]&14)*536870912+(d[15]&255)*4194304+(d[16]&254)*16384+(d[17]&255)*128+(d[18]&254)/2,v-s>54e5&&(L.logger.warn(Math.round((v-s)/9e4)+"s delta between PTS and DTS, align them"),v=s)):s=v),t=d[8];var T=t+9;if(n.size<=T)return null;n.size-=T;for(var P=new Uint8Array(n.size),M=0,C=h.length;M<C;M++){d=h[M];var x=d.byteLength;if(T)if(T>x){T-=x;continue}else d=d.subarray(T),x-=T,T=0;P.set(d,i),i+=x}return o&&(o-=t+3),{data:P,pts:v,dts:s,len:o}}return null}function f(n,i){if(n.units.length&&n.frame){if(n.pts===void 0){var d=i.samples,o=d.length;if(o){var t=d[o-1];n.pts=t.pts,n.dts=t.dts}else{i.dropped++;return}}i.samples.push(n)}n.debug.length&&L.logger.log(n.pts+"/"+n.dts+":"+n.debug)}const c=y},"./src/demux/webworkify-webpack.js":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>_});var F=function(){var y=ENTRY_MODULE,p={};function l(e){var f=p[e];if(f!==void 0)return f.exports;var c=p[e]={exports:{}};return y[e].call(c.exports,c,c.exports,l),c.exports}l.m=y,function(){l.n=function(e){var f=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(f,{a:f}),f}}(),function(){l.d=function(e,f){for(var c in f)l.o(f,c)&&!l.o(e,c)&&Object.defineProperty(e,c,{enumerable:!0,get:f[c]})}}(),function(){l.o=function(e,f){return Object.prototype.hasOwnProperty.call(e,f)}}(),function(){l.r=function(e){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}();var r=l(ENTRY_MODULE);return r.default||r};F.toString();var A="[\\.|\\-|\\+|\\w|/|@]+",O="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+A+").*?\\)";function R(E){return(E+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function b(E){return!isNaN(1*E)}function I(E,y,p){var l={};l[p]=[];var r=y.toString(),e=r.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||r.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!e)return l;for(var f=e[1],c=new RegExp("(\\\\n|\\W)"+R(f)+O,"g"),n;n=c.exec(r);)n[3]!=="dll-reference"&&l[p].push(n[3]);for(c=new RegExp("\\("+R(f)+'\\("(dll-reference\\s('+A+'))"\\)\\)'+O,"g");n=c.exec(r);)E[n[2]]||(l[p].push(n[1]),E[n[2]]=D(n[1]).m),l[n[2]]=l[n[2]]||[],l[n[2]].push(n[4]);for(var i=Object.keys(l),d=0;d<i.length;d++)for(var o=0;o<l[i[d]].length;o++)b(l[i[d]][o])&&(l[i[d]][o]=1*l[i[d]][o]);return l}function L(E){var y=Object.keys(E);return y.reduce(function(p,l){return p||E[l].length>0},!1)}function S(E,y){for(var p={main:[y]},l={main:[]},r={main:{}};L(p);)for(var e=Object.keys(p),f=0;f<e.length;f++){var c=e[f],n=p[c],i=n.pop();if(r[c]=r[c]||{},!(r[c][i]||!E[c][i])){r[c][i]=!0,l[c]=l[c]||[],l[c].push(i);for(var d=I(E,E[c][i],c),o=Object.keys(d),t=0;t<o.length;t++)p[o[t]]=p[o[t]]||[],p[o[t]]=p[o[t]].concat(d[o[t]])}}return l}function g(E,y,p,l){var r=E[l].map(function(f){return'"'+f+'": '+y[l][f].toString()}).join(","),e=F.toString().split("ENTRY_MODULE");return e[0]+"{"+r+"}"+e[1]+'"'+p+'"'+e[2]}function _(E,y){y=y||{};var p={main:D.m},l=y.all?{main:Object.keys(p.main)}:S(p,E),r="";Object.keys(l).filter(function(i){return i!=="main"}).forEach(function(i){for(var d=0;l[i][d];)d++;l[i].push(d),p[i][d]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",r=r+("var "+i+" = ("+g(l,p,d,modules)+`)();
`)}),r=r+("(("+g(l,p,E,"main")+")())(self);");var e=new window.Blob([r],{type:"text/javascript"}),f=window.URL||window.webkitURL||window.mozURL||window.msURL,c=f.createObjectURL(e),n=new window.Worker(c);return n.objectURL=c,n}},"./src/errors.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{ErrorDetails:()=>A,ErrorTypes:()=>F});var F;(function(O){O.NETWORK_ERROR="networkError",O.MEDIA_ERROR="mediaError",O.KEY_SYSTEM_ERROR="keySystemError",O.MUX_ERROR="muxError",O.OTHER_ERROR="otherError"})(F||(F={}));var A;(function(O){O.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",O.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",O.KEY_SYSTEM_NO_SESSION="keySystemNoSession",O.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",O.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",O.MANIFEST_LOAD_ERROR="manifestLoadError",O.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",O.MANIFEST_PARSING_ERROR="manifestParsingError",O.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",O.LEVEL_EMPTY_ERROR="levelEmptyError",O.LEVEL_LOAD_ERROR="levelLoadError",O.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",O.LEVEL_SWITCH_ERROR="levelSwitchError",O.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",O.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",O.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",O.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",O.FRAG_LOAD_ERROR="fragLoadError",O.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",O.FRAG_DECRYPT_ERROR="fragDecryptError",O.FRAG_PARSING_ERROR="fragParsingError",O.REMUX_ALLOC_ERROR="remuxAllocError",O.KEY_LOAD_ERROR="keyLoadError",O.KEY_LOAD_TIMEOUT="keyLoadTimeOut",O.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",O.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",O.BUFFER_APPEND_ERROR="bufferAppendError",O.BUFFER_APPENDING_ERROR="bufferAppendingError",O.BUFFER_STALLED_ERROR="bufferStalledError",O.BUFFER_FULL_ERROR="bufferFullError",O.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",O.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",O.INTERNAL_EXCEPTION="internalException",O.INTERNAL_ABORTED="aborted",O.UNKNOWN="unknown"})(A||(A={}))},"./src/events.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{Events:()=>F});var F;(function(A){A.MEDIA_ATTACHING="hlsMediaAttaching",A.MEDIA_ATTACHED="hlsMediaAttached",A.MEDIA_DETACHING="hlsMediaDetaching",A.MEDIA_DETACHED="hlsMediaDetached",A.BUFFER_RESET="hlsBufferReset",A.BUFFER_CODECS="hlsBufferCodecs",A.BUFFER_CREATED="hlsBufferCreated",A.BUFFER_APPENDING="hlsBufferAppending",A.BUFFER_APPENDED="hlsBufferAppended",A.BUFFER_EOS="hlsBufferEos",A.BUFFER_FLUSHING="hlsBufferFlushing",A.BUFFER_FLUSHED="hlsBufferFlushed",A.MANIFEST_LOADING="hlsManifestLoading",A.MANIFEST_LOADED="hlsManifestLoaded",A.MANIFEST_PARSED="hlsManifestParsed",A.LEVEL_SWITCHING="hlsLevelSwitching",A.LEVEL_SWITCHED="hlsLevelSwitched",A.LEVEL_LOADING="hlsLevelLoading",A.LEVEL_LOADED="hlsLevelLoaded",A.LEVEL_UPDATED="hlsLevelUpdated",A.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",A.LEVELS_UPDATED="hlsLevelsUpdated",A.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",A.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",A.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",A.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",A.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",A.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",A.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",A.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",A.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",A.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",A.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",A.CUES_PARSED="hlsCuesParsed",A.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",A.INIT_PTS_FOUND="hlsInitPtsFound",A.FRAG_LOADING="hlsFragLoading",A.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",A.FRAG_LOADED="hlsFragLoaded",A.FRAG_DECRYPTED="hlsFragDecrypted",A.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",A.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",A.FRAG_PARSING_METADATA="hlsFragParsingMetadata",A.FRAG_PARSED="hlsFragParsed",A.FRAG_BUFFERED="hlsFragBuffered",A.FRAG_CHANGED="hlsFragChanged",A.FPS_DROP="hlsFpsDrop",A.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",A.ERROR="hlsError",A.DESTROYING="hlsDestroying",A.KEY_LOADING="hlsKeyLoading",A.KEY_LOADED="hlsKeyLoaded",A.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",A.BACK_BUFFER_REACHED="hlsBackBufferReached"})(F||(F={}))},"./src/hls.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>n});var F=D("./node_modules/url-toolkit/src/url-toolkit.js"),A=D.n(F),O=D("./src/loader/playlist-loader.ts"),R=D("./src/loader/key-loader.ts"),b=D("./src/controller/id3-track-controller.ts"),I=D("./src/controller/latency-controller.ts"),L=D("./src/controller/level-controller.ts"),S=D("./src/controller/fragment-tracker.ts"),g=D("./src/controller/stream-controller.ts"),_=D("./src/is-supported.ts"),E=D("./src/utils/logger.ts"),y=D("./src/config.ts"),p=D("./node_modules/eventemitter3/index.js"),l=D.n(p),r=D("./src/events.ts"),e=D("./src/errors.ts");function f(i,d){for(var o=0;o<d.length;o++){var t=d[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(i,t.key,t)}}function c(i,d,o){return d&&f(i.prototype,d),o&&f(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}var n=function(){i.isSupported=function(){return(0,_.isSupported)()};function i(o){o===void 0&&(o={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new p.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var t=this.config=(0,y.mergeConfig)(i.DefaultConfig,o);this.userConfig=o,(0,E.enableLogs)(t.debug,"Hls instance"),this._autoLevelCapping=-1,t.progressive&&(0,y.enableStreamingMode)(t);var v=t.abrController,s=t.bufferController,h=t.capLevelController,u=t.fpsController,a=this.abrController=new v(this),m=this.bufferController=new s(this),T=this.capLevelController=new h(this),P=new u(this),M=new O.default(this),C=new R.default(this),x=new b.default(this),U=this.levelController=new L.default(this),k=new S.FragmentTracker(this),w=this.streamController=new g.default(this,k);T.setStreamController(w),P.setStreamController(w);var N=[M,C,U,w];this.networkControllers=N;var K=[a,m,T,P,x,k];this.audioTrackController=this.createController(t.audioTrackController,null,N),this.createController(t.audioStreamController,k,N),this.subtitleTrackController=this.createController(t.subtitleTrackController,null,N),this.createController(t.subtitleStreamController,k,N),this.createController(t.timelineController,null,K),this.emeController=this.createController(t.emeController,null,K),this.cmcdController=this.createController(t.cmcdController,null,K),this.latencyController=this.createController(I.default,null,K),this.coreComponents=K}var d=i.prototype;return d.createController=function(t,v,s){if(t){var h=v?new t(this,v):new t(this);return s&&s.push(h),h}return null},d.on=function(t,v,s){s===void 0&&(s=this),this._emitter.on(t,v,s)},d.once=function(t,v,s){s===void 0&&(s=this),this._emitter.once(t,v,s)},d.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},d.off=function(t,v,s,h){s===void 0&&(s=this),this._emitter.off(t,v,s,h)},d.listeners=function(t){return this._emitter.listeners(t)},d.emit=function(t,v,s){return this._emitter.emit(t,v,s)},d.trigger=function(t,v){if(this.config.debug)return this.emit(t,t,v);try{return this.emit(t,t,v)}catch(s){E.logger.error("An internal error happened while handling event "+t+'. Error message: "'+s.message+'". Here is a stacktrace:',s),this.trigger(r.Events.ERROR,{type:e.ErrorTypes.OTHER_ERROR,details:e.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,error:s})}return!1},d.listenerCount=function(t){return this._emitter.listenerCount(t)},d.destroy=function(){E.logger.log("destroy"),this.trigger(r.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(t){return t.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(t){return t.destroy()}),this.coreComponents.length=0},d.attachMedia=function(t){E.logger.log("attachMedia"),this._media=t,this.trigger(r.Events.MEDIA_ATTACHING,{media:t})},d.detachMedia=function(){E.logger.log("detachMedia"),this.trigger(r.Events.MEDIA_DETACHING,void 0),this._media=null},d.loadSource=function(t){this.stopLoad();var v=this.media,s=this.url,h=this.url=F.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});E.logger.log("loadSource:"+h),v&&s&&s!==h&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(v)),this.trigger(r.Events.MANIFEST_LOADING,{url:t})},d.startLoad=function(t){t===void 0&&(t=-1),E.logger.log("startLoad("+t+")"),this.networkControllers.forEach(function(v){v.startLoad(t)})},d.stopLoad=function(){E.logger.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},d.swapAudioCodec=function(){E.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},d.recoverMediaError=function(){E.logger.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},d.removeLevel=function(t,v){v===void 0&&(v=0),this.levelController.removeLevel(t,v)},c(i,[{key:"levels",get:function(){var t=this.levelController.levels;return t||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){E.logger.log("set currentLevel:"+t),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){E.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){E.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){E.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){E.logger.log("set startLevel:"+t),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){var v=!!t;v!==this.config.capLevelToPlayerSize&&(v?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=v)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(E.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t)}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,v=this.config.minAutoBitrate;if(!t)return 0;for(var s=t.length,h=0;h<s;h++)if(t[h].maxBitrate>=v)return h;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,v=this.autoLevelCapping,s;return v===-1&&t&&t.length?s=t.length-1:s=v,s}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var v=this.audioTrackController;v&&(v.audioTrack=t)}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var v=this.subtitleTrackController;v&&(v.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return t?t.subtitleDisplay:!1},set:function(t){var v=this.subtitleTrackController;v&&(v.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.7"}},{key:"Events",get:function(){return r.Events}},{key:"ErrorTypes",get:function(){return e.ErrorTypes}},{key:"ErrorDetails",get:function(){return e.ErrorDetails}},{key:"DefaultConfig",get:function(){return i.defaultConfig?i.defaultConfig:y.hlsDefaultConfig},set:function(t){i.defaultConfig=t}}]),i}();n.defaultConfig=void 0},"./src/is-supported.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{changeTypeSupported:()=>R,isSupported:()=>O});var F=D("./src/utils/mediasource-helper.ts");function A(){return self.SourceBuffer||self.WebKitSourceBuffer}function O(){var b=(0,F.getMediaSource)();if(!b)return!1;var I=A(),L=b&&typeof b.isTypeSupported=="function"&&b.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),S=!I||I.prototype&&typeof I.prototype.appendBuffer=="function"&&typeof I.prototype.remove=="function";return!!L&&!!S}function R(){var b,I=A();return typeof(I==null||(b=I.prototype)===null||b===void 0?void 0:b.changeType)=="function"}},"./src/loader/date-range.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{DateRange:()=>S,DateRangeAttribute:()=>L});var F=D("./src/polyfills/number.ts"),A=D("./src/utils/attr-list.ts"),O=D("./src/utils/logger.ts");function R(){return R=Object.assign?Object.assign.bind():function(g){for(var _=1;_<arguments.length;_++){var E=arguments[_];for(var y in E)Object.prototype.hasOwnProperty.call(E,y)&&(g[y]=E[y])}return g},R.apply(this,arguments)}function b(g,_){for(var E=0;E<_.length;E++){var y=_[E];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(g,y.key,y)}}function I(g,_,E){return _&&b(g.prototype,_),E&&b(g,E),Object.defineProperty(g,"prototype",{writable:!1}),g}var L;(function(g){g.ID="ID",g.CLASS="CLASS",g.START_DATE="START-DATE",g.DURATION="DURATION",g.END_DATE="END-DATE",g.END_ON_NEXT="END-ON-NEXT",g.PLANNED_DURATION="PLANNED-DURATION",g.SCTE35_OUT="SCTE35-OUT",g.SCTE35_IN="SCTE35-IN"})(L||(L={}));var S=function(){function g(_,E){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,E){var y=E.attr;for(var p in y)if(Object.prototype.hasOwnProperty.call(_,p)&&_[p]!==y[p]){O.logger.warn('DATERANGE tag attribute: "'+p+'" does not match for tags with ID: "'+_.ID+'"'),this._badValueForSameId=p;break}_=R(new A.AttrList({}),y,_)}if(this.attr=_,this._startDate=new Date(_[L.START_DATE]),L.END_DATE in this.attr){var l=new Date(this.attr[L.END_DATE]);(0,F.isFiniteNumber)(l.getTime())&&(this._endDate=l)}}return I(g,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var E=this.duration;return E!==null?new Date(this._startDate.getTime()+E*1e3):null}},{key:"duration",get:function(){if(L.DURATION in this.attr){var E=this.attr.decimalFloatingPoint(L.DURATION);if((0,F.isFiniteNumber)(E))return E}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return L.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(L.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(L.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,F.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),g}()},"./src/loader/fragment-loader.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{LoadError:()=>p,default:()=>E});var F=D("./src/polyfills/number.ts"),A=D("./src/errors.ts");function O(l,r){l.prototype=Object.create(r.prototype),l.prototype.constructor=l,S(l,r)}function R(l){var r=typeof Map=="function"?new Map:void 0;return R=function(f){if(f===null||!L(f))return f;if(typeof f!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r<"u"){if(r.has(f))return r.get(f);r.set(f,c)}function c(){return b(f,arguments,g(this).constructor)}return c.prototype=Object.create(f.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),S(c,f)},R(l)}function b(l,r,e){return I()?b=Reflect.construct.bind():b=function(c,n,i){var d=[null];d.push.apply(d,n);var o=Function.bind.apply(c,d),t=new o;return i&&S(t,i.prototype),t},b.apply(null,arguments)}function I(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function L(l){return Function.toString.call(l).indexOf("[native code]")!==-1}function S(l,r){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,c){return f.__proto__=c,f},S(l,r)}function g(l){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},g(l)}var _=Math.pow(2,17),E=function(){function l(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var r=l.prototype;return r.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},r.abort=function(){this.loader&&this.loader.abort()},r.load=function(f,c){var n=this,i=f.url;if(!i)return Promise.reject(new p({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:f,networkDetails:null},"Fragment does not have a "+(i?"part list":"url")));this.abort();var d=this.config,o=d.fLoader,t=d.loader;return new Promise(function(v,s){n.loader&&n.loader.destroy();var h=n.loader=f.loader=o?new o(d):new t(d),u=y(f),a={timeout:d.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:d.fragLoadingMaxRetryTimeout,highWaterMark:f.sn==="initSegment"?1/0:_};f.stats=h.stats,h.load(u,a,{onSuccess:function(T,P,M,C){n.resetLoader(f,h),v({frag:f,part:null,payload:T.data,networkDetails:C})},onError:function(T,P,M){n.resetLoader(f,h),s(new p({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:f,response:T,networkDetails:M}))},onAbort:function(T,P,M){n.resetLoader(f,h),s(new p({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:f,networkDetails:M}))},onTimeout:function(T,P,M){n.resetLoader(f,h),s(new p({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:f,networkDetails:M}))},onProgress:function(T,P,M,C){c&&c({frag:f,part:null,payload:M,networkDetails:C})}})})},r.loadPart=function(f,c,n){var i=this;this.abort();var d=this.config,o=d.fLoader,t=d.loader;return new Promise(function(v,s){i.loader&&i.loader.destroy();var h=i.loader=f.loader=o?new o(d):new t(d),u=y(f,c),a={timeout:d.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:d.fragLoadingMaxRetryTimeout,highWaterMark:_};c.stats=h.stats,h.load(u,a,{onSuccess:function(T,P,M,C){i.resetLoader(f,h),i.updateStatsFromPart(f,c);var x={frag:f,part:c,payload:T.data,networkDetails:C};n(x),v(x)},onError:function(T,P,M){i.resetLoader(f,h),s(new p({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:f,part:c,response:T,networkDetails:M}))},onAbort:function(T,P,M){f.stats.aborted=c.stats.aborted,i.resetLoader(f,h),s(new p({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:f,part:c,networkDetails:M}))},onTimeout:function(T,P,M){i.resetLoader(f,h),s(new p({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:f,part:c,networkDetails:M}))}})})},r.updateStatsFromPart=function(f,c){var n=f.stats,i=c.stats,d=i.total;if(n.loaded+=i.loaded,d){var o=Math.round(f.duration/c.duration),t=Math.min(Math.round(n.loaded/d),o),v=o-t,s=v*Math.round(n.loaded/t);n.total=n.loaded+s}else n.total=Math.max(n.loaded,n.total);var h=n.loading,u=i.loading;h.start?h.first+=u.first-u.start:(h.start=u.start,h.first=u.first),h.end=u.end},r.resetLoader=function(f,c){f.loader=null,this.loader===c&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),c.destroy()},l}();function y(l,r){r===void 0&&(r=null);var e=r||l,f={frag:l,part:r,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},c=e.byteRangeStartOffset,n=e.byteRangeEndOffset;return(0,F.isFiniteNumber)(c)&&(0,F.isFiniteNumber)(n)&&(f.rangeStart=c,f.rangeEnd=n),f}var p=function(l){O(r,l);function r(e){for(var f,c=arguments.length,n=new Array(c>1?c-1:0),i=1;i<c;i++)n[i-1]=arguments[i];return f=l.call.apply(l,[this].concat(n))||this,f.data=void 0,f.data=e,f}return r}(R(Error))},"./src/loader/fragment.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{BaseSegment:()=>y,ElementaryStreamTypes:()=>E,Fragment:()=>p,Part:()=>l});var F=D("./src/polyfills/number.ts"),A=D("./node_modules/url-toolkit/src/url-toolkit.js"),O=D.n(A),R=D("./src/utils/logger.ts"),b=D("./src/loader/level-key.ts"),I=D("./src/loader/load-stats.ts");function L(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,S(r,e)}function S(r,e){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,n){return c.__proto__=n,c},S(r,e)}function g(r,e){for(var f=0;f<e.length;f++){var c=e[f];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,c.key,c)}}function _(r,e,f){return e&&g(r.prototype,e),f&&g(r,f),Object.defineProperty(r,"prototype",{writable:!1}),r}var E;(function(r){r.AUDIO="audio",r.VIDEO="video",r.AUDIOVIDEO="audiovideo"})(E||(E={}));var y=function(){function r(f){var c;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(c={},c[E.AUDIO]=null,c[E.VIDEO]=null,c[E.AUDIOVIDEO]=null,c),this.baseurl=f}var e=r.prototype;return e.setByteRange=function(c,n){var i=c.split("@",2),d=[];i.length===1?d[0]=n?n.byteRangeEndOffset:0:d[0]=parseInt(i[1]),d[1]=parseInt(i[0])+d[0],this._byteRange=d},_(r,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,A.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(c){this._url=c}}]),r}(),p=function(r){L(e,r);function e(c,n){var i;return i=r.call(this,n)||this,i._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkey=void 0,i.type=void 0,i.loader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.appendedPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new I.LoadStats,i.urlId=0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.type=c,i}var f=e.prototype;return f.createInitializationVector=function(n){for(var i=new Uint8Array(16),d=12;d<16;d++)i[d]=n>>8*(15-d)&255;return i},f.setDecryptDataFromLevelKey=function(n,i){var d=n;return n?.method==="AES-128"&&n.uri&&!n.iv&&(d=b.LevelKey.fromURI(n.uri),d.method=n.method,d.iv=this.createInitializationVector(i),d.keyFormat="identity"),d},f.setElementaryStreamInfo=function(n,i,d,o,t,v){v===void 0&&(v=!1);var s=this.elementaryStreams,h=s[n];if(!h){s[n]={startPTS:i,endPTS:d,startDTS:o,endDTS:t,partial:v};return}h.startPTS=Math.min(h.startPTS,i),h.endPTS=Math.max(h.endPTS,d),h.startDTS=Math.min(h.startDTS,o),h.endDTS=Math.max(h.endDTS,t)},f.clearElementaryStreamInfo=function(){var n=this.elementaryStreams;n[E.AUDIO]=null,n[E.VIDEO]=null,n[E.AUDIOVIDEO]=null},_(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var n=this.sn;typeof n!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&R.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),n=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,n)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,F.isFiniteNumber)(this.programDateTime))return null;var n=(0,F.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+n*1e3}},{key:"encrypted",get:function(){var n;return!!((n=this.decryptdata)!==null&&n!==void 0&&n.keyFormat&&this.decryptdata.uri)}}]),e}(y),l=function(r){L(e,r);function e(f,c,n,i,d){var o;o=r.call(this,n)||this,o.fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.stats=new I.LoadStats,o.duration=f.decimalFloatingPoint("DURATION"),o.gap=f.bool("GAP"),o.independent=f.bool("INDEPENDENT"),o.relurl=f.enumeratedString("URI"),o.fragment=c,o.index=i;var t=f.enumeratedString("BYTERANGE");return t&&o.setByteRange(t,d),d&&(o.fragOffset=d.fragOffset+d.duration),o}return _(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var c=this.elementaryStreams;return!!(c.audio||c.video||c.audiovideo)}}]),e}(y)},"./src/loader/key-loader.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>R});var F=D("./src/events.ts"),A=D("./src/errors.ts"),O=D("./src/utils/logger.ts"),R=function(){function b(L){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=L,this.registerListeners()}var I=b.prototype;return I.startLoad=function(S){},I.stopLoad=function(){this.destroyInternalLoaders()},I.registerListeners=function(){this.hls.on(F.Events.KEY_LOADING,this.onKeyLoading,this)},I.unregisterListeners=function(){this.hls.off(F.Events.KEY_LOADING,this.onKeyLoading)},I.destroyInternalLoaders=function(){for(var S in this.loaders){var g=this.loaders[S];g&&g.destroy()}this.loaders={}},I.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},I.onKeyLoading=function(S,g){var _=g.frag,E=_.type,y=this.loaders[E];if(!_.decryptdata){O.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var p=_.decryptdata.uri;if(p!==this.decrypturl||this.decryptkey===null){var l=this.hls.config;if(y&&(O.logger.warn("abort previous key loader for type:"+E),y.abort()),!p){O.logger.warn("key uri is falsy");return}var r=l.loader,e=_.loader=this.loaders[E]=new r(l);this.decrypturl=p,this.decryptkey=null;var f={url:p,frag:_,responseType:"arraybuffer"},c={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:l.fragLoadingRetryDelay,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:0},n={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};e.load(f,c,n)}else this.decryptkey&&(_.decryptdata.key=this.decryptkey,this.hls.trigger(F.Events.KEY_LOADED,{frag:_}))},I.loadsuccess=function(S,g,_){var E=_.frag;if(!E.decryptdata){O.logger.error("after key load, decryptdata unset");return}this.decryptkey=E.decryptdata.key=new Uint8Array(S.data),E.loader=null,delete this.loaders[E.type],this.hls.trigger(F.Events.KEY_LOADED,{frag:E})},I.loaderror=function(S,g){var _=g.frag,E=_.loader;E&&E.abort(),delete this.loaders[_.type],this.hls.trigger(F.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:_,response:S})},I.loadtimeout=function(S,g){var _=g.frag,E=_.loader;E&&E.abort(),delete this.loaders[_.type],this.hls.trigger(F.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:_})},b}()},"./src/loader/level-details.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{LevelDetails:()=>b});var F=D("./src/polyfills/number.ts");function A(I,L){for(var S=0;S<L.length;S++){var g=L[S];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(I,g.key,g)}}function O(I,L,S){return L&&A(I.prototype,L),S&&A(I,S),Object.defineProperty(I,"prototype",{writable:!1}),I}var R=10,b=function(){function I(S){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=S}var L=I.prototype;return L.reloaded=function(g){if(!g){this.advanced=!0,this.updated=!0;return}var _=this.lastPartSn-g.lastPartSn,E=this.lastPartIndex-g.lastPartIndex;this.updated=this.endSN!==g.endSN||!!E||!!_,this.advanced=this.endSN>g.endSN||_>0||_===0&&E>0,this.updated||this.advanced?this.misses=Math.floor(g.misses*.6):this.misses=g.misses+1,this.availabilityDelay=g.availabilityDelay},O(I,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?(0,F.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||R}},{key:"drift",get:function(){var g=this.driftEndTime-this.driftStartTime;if(g>0){var _=this.driftEnd-this.driftStart;return _*1e3/g}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var g;return(g=this.partList)!==null&&g!==void 0&&g.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var g;return(g=this.fragments)!==null&&g!==void 0&&g.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var g;return(g=this.partList)!==null&&g!==void 0&&g.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var g;return(g=this.partList)!==null&&g!==void 0&&g.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),I}()},"./src/loader/level-key.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{LevelKey:()=>b});var F=D("./node_modules/url-toolkit/src/url-toolkit.js"),A=D.n(F);function O(I,L){for(var S=0;S<L.length;S++){var g=L[S];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(I,g.key,g)}}function R(I,L,S){return L&&O(I.prototype,L),S&&O(I,S),Object.defineProperty(I,"prototype",{writable:!1}),I}var b=function(){I.fromURL=function(S,g){return new I(S,g)},I.fromURI=function(S){return new I(S)};function I(L,S){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,S?this._uri=(0,F.buildAbsoluteURL)(L,S,{alwaysNormalize:!0}):this._uri=L}return R(I,[{key:"uri",get:function(){return this._uri}}]),I}()},"./src/loader/load-stats.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{LoadStats:()=>F});var F=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>f});var F=D("./src/polyfills/number.ts"),A=D("./node_modules/url-toolkit/src/url-toolkit.js"),O=D.n(A),R=D("./src/loader/date-range.ts"),b=D("./src/loader/fragment.ts"),I=D("./src/loader/level-details.ts"),L=D("./src/loader/level-key.ts"),S=D("./src/utils/attr-list.ts"),g=D("./src/utils/logger.ts"),_=D("./src/utils/codecs.ts"),E=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,y=/#EXT-X-MEDIA:(.*)/g,p=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),l=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),r=/\.(mp4|m4s|m4v|m4a)$/i;function e(t){var v,s;return r.test((v=(s=A.parseURL(t))===null||s===void 0?void 0:s.path)!=null?v:"")}var f=function(){function t(){}return t.findGroup=function(s,h){for(var u=0;u<s.length;u++){var a=s[u];if(a.id===h)return a}},t.convertAVC1ToAVCOTI=function(s){var h=s.split(".");if(h.length>2){var u=h.shift()+".";return u+=parseInt(h.shift()).toString(16),u+=("000"+parseInt(h.shift()).toString(16)).slice(-4),u}return s},t.resolve=function(s,h){return A.buildAbsoluteURL(h,s,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(s,h){var u=[],a=[],m={},T=!1;E.lastIndex=0;for(var P;(P=E.exec(s))!=null;)if(P[1]){var M,C=new S.AttrList(P[1]),x={attrs:C,bitrate:C.decimalInteger("AVERAGE-BANDWIDTH")||C.decimalInteger("BANDWIDTH"),name:C.NAME,url:t.resolve(P[2],h)},U=C.decimalResolution("RESOLUTION");U&&(x.width=U.width,x.height=U.height),c((C.CODECS||"").split(/[ ,]+/).filter(function(N){return N}),x),x.videoCodec&&x.videoCodec.indexOf("avc1")!==-1&&(x.videoCodec=t.convertAVC1ToAVCOTI(x.videoCodec)),(M=x.unknownCodecs)!==null&&M!==void 0&&M.length||a.push(x),u.push(x)}else if(P[3]){var k=new S.AttrList(P[3]);k["DATA-ID"]&&(T=!0,m[k["DATA-ID"]]=k)}var w=a.length>0&&a.length<u.length;return{levels:w?a:u,sessionData:T?m:null}},t.parseMasterPlaylistMedia=function(s,h,u,a){a===void 0&&(a=[]);var m,T=[],P=0;for(y.lastIndex=0;(m=y.exec(s))!==null;){var M=new S.AttrList(m[1]);if(M.TYPE===u){var C={attrs:M,bitrate:0,id:P++,groupId:M["GROUP-ID"],instreamId:M["INSTREAM-ID"],name:M.NAME||M.LANGUAGE||"",type:u,default:M.bool("DEFAULT"),autoselect:M.bool("AUTOSELECT"),forced:M.bool("FORCED"),lang:M.LANGUAGE,url:M.URI?t.resolve(M.URI,h):""};if(a.length){var x=t.findGroup(a,C.groupId)||a[0];n(C,x,"audioCodec"),n(C,x,"textCodec")}T.push(C)}}return T},t.parseLevelPlaylist=function(s,h,u,a,m){var T=new I.LevelDetails(h),P=T.fragments,M=null,C=0,x=0,U=0,k=0,w=null,N=new b.Fragment(a,h),K,G,H,V=-1,X=!1;for(p.lastIndex=0,T.m3u8=s;(K=p.exec(s))!==null;){X&&(X=!1,N=new b.Fragment(a,h),N.start=U,N.sn=C,N.cc=k,N.level=u,M&&(N.initSegment=M,N.rawProgramDateTime=M.rawProgramDateTime,M.rawProgramDateTime=null));var Y=K[1];if(Y){N.duration=parseFloat(Y);var Q=(" "+K[2]).slice(1);N.title=Q||null,N.tagList.push(Q?["INF",Y,Q]:["INF",Y])}else if(K[3])(0,F.isFiniteNumber)(N.duration)&&(N.start=U,H&&(N.levelkey=H),N.sn=C,N.level=u,N.cc=k,N.urlId=m,P.push(N),N.relurl=(" "+K[3]).slice(1),d(N,w),w=N,U+=N.duration,C++,x=0,X=!0);else if(K[4]){var $=(" "+K[4]).slice(1);w?N.setByteRange($,w):N.setByteRange($)}else if(K[5])N.rawProgramDateTime=(" "+K[5]).slice(1),N.tagList.push(["PROGRAM-DATE-TIME",N.rawProgramDateTime]),V===-1&&(V=P.length);else{if(K=K[0].match(l),!K){g.logger.warn("No matches on slow regex match for level playlist!");continue}for(G=1;G<K.length&&!(typeof K[G]<"u");G++);var z=(" "+K[G]).slice(1),j=(" "+K[G+1]).slice(1),J=K[G+2]?(" "+K[G+2]).slice(1):"";switch(z){case"PLAYLIST-TYPE":T.type=j.toUpperCase();break;case"MEDIA-SEQUENCE":C=T.startSN=parseInt(j);break;case"SKIP":{var Z=new S.AttrList(j),q=Z.decimalInteger("SKIPPED-SEGMENTS");if((0,F.isFiniteNumber)(q)){T.skippedSegments=q;for(var le=q;le--;)P.unshift(null);C+=q}var ee=Z.enumeratedString("RECENTLY-REMOVED-DATERANGES");ee&&(T.recentlyRemovedDateranges=ee.split("	"));break}case"TARGETDURATION":T.targetduration=parseFloat(j);break;case"VERSION":T.version=parseInt(j);break;case"EXTM3U":break;case"ENDLIST":T.live=!1;break;case"#":(j||J)&&N.tagList.push(J?[j,J]:[j]);break;case"DISCONTINUITY":k++,N.tagList.push(["DIS"]);break;case"GAP":N.tagList.push([z]);break;case"BITRATE":N.tagList.push([z,j]);break;case"DATERANGE":{var de=new S.AttrList(j),ae=new R.DateRange(de,T.dateRanges[de.ID]);ae.isValid||T.skippedSegments?T.dateRanges[ae.id]=ae:g.logger.warn('Ignoring invalid DATERANGE tag: "'+j+'"'),N.tagList.push(["EXT-X-DATERANGE",j]);break}case"DISCONTINUITY-SEQUENCE":k=parseInt(j);break;case"KEY":{var fe,ie=new S.AttrList(j),he=ie.enumeratedString("METHOD"),ge=ie.URI,Ee=ie.hexadecimalInteger("IV"),ce=ie.enumeratedString("KEYFORMATVERSIONS"),Se=ie.enumeratedString("KEYID"),ue=(fe=ie.enumeratedString("KEYFORMAT"))!=null?fe:"identity",De=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(De.indexOf(ue)>-1){g.logger.warn("Keyformat "+ue+" is not supported from the manifest");continue}else if(ue!=="identity")continue;he&&(H=L.LevelKey.fromURL(h,ge),ge&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(he)>=0&&(H.method=he,H.keyFormat=ue,Se&&(H.keyID=Se),ce&&(H.keyFormatVersions=ce),H.iv=Ee));break}case"START":{var ne=new S.AttrList(j),oe=ne.decimalFloatingPoint("TIME-OFFSET");(0,F.isFiniteNumber)(oe)&&(T.startTimeOffset=oe);break}case"MAP":{var pe=new S.AttrList(j);if(N.duration){var se=new b.Fragment(a,h);o(se,pe,u,H),M=se,N.initSegment=M,M.rawProgramDateTime&&!N.rawProgramDateTime&&(N.rawProgramDateTime=M.rawProgramDateTime)}else o(N,pe,u,H),M=N,X=!0;break}case"SERVER-CONTROL":{var te=new S.AttrList(j);T.canBlockReload=te.bool("CAN-BLOCK-RELOAD"),T.canSkipUntil=te.optionalFloat("CAN-SKIP-UNTIL",0),T.canSkipDateRanges=T.canSkipUntil>0&&te.bool("CAN-SKIP-DATERANGES"),T.partHoldBack=te.optionalFloat("PART-HOLD-BACK",0),T.holdBack=te.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Ae=new S.AttrList(j);T.partTarget=Ae.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Te=T.partList;Te||(Te=T.partList=[]);var Pe=x>0?Te[Te.length-1]:void 0,Me=x++,ye=new b.Part(new S.AttrList(j),N,h,Me,Pe);Te.push(ye),N.duration+=ye.duration;break}case"PRELOAD-HINT":{var Be=new S.AttrList(j);T.preloadHint=Be;break}case"RENDITION-REPORT":{var be=new S.AttrList(j);T.renditionReports=T.renditionReports||[],T.renditionReports.push(be);break}default:g.logger.warn("line parsed but not handled: "+K);break}}}w&&!w.relurl?(P.pop(),U-=w.duration,T.partList&&(T.fragmentHint=w)):T.partList&&(d(N,w),N.cc=k,T.fragmentHint=N);var Ie=P.length,Oe=P[0],Re=P[Ie-1];if(U+=T.skippedSegments*T.targetduration,U>0&&Ie&&Re){T.averagetargetduration=U/Ie;var xe=Re.sn;T.endSN=xe!=="initSegment"?xe:0,Oe&&(T.startCC=Oe.cc,Oe.initSegment||T.fragments.every(function(Ce){return Ce.relurl&&e(Ce.relurl)})&&(g.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),N=new b.Fragment(a,h),N.relurl=Re.relurl,N.level=u,N.sn="initSegment",Oe.initSegment=N,T.needSidxRanges=!0))}else T.endSN=0,T.startCC=0;return T.fragmentHint&&(U+=T.fragmentHint.duration),T.totalduration=U,T.endCC=k,V>0&&i(P,V),T},t}();function c(t,v){["video","audio","text"].forEach(function(s){var h=t.filter(function(a){return(0,_.isCodecType)(a,s)});if(h.length){var u=h.filter(function(a){return a.lastIndexOf("avc1",0)===0||a.lastIndexOf("mp4a",0)===0});v[s+"Codec"]=u.length>0?u[0]:h[0],t=t.filter(function(a){return h.indexOf(a)===-1})}}),v.unknownCodecs=t}function n(t,v,s){var h=v[s];h&&(t[s]=h)}function i(t,v){for(var s=t[v],h=v;h--;){var u=t[h];if(!u)return;u.programDateTime=s.programDateTime-u.duration*1e3,s=u}}function d(t,v){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):v!=null&&v.programDateTime&&(t.programDateTime=v.endProgramDateTime),(0,F.isFiniteNumber)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}function o(t,v,s,h){t.relurl=v.URI,v.BYTERANGE&&t.setByteRange(v.BYTERANGE),t.level=s,t.sn="initSegment",h&&(t.levelkey=h),t.initSegment=null}},"./src/loader/playlist-loader.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>y});var F=D("./src/polyfills/number.ts"),A=D("./src/events.ts"),O=D("./src/errors.ts"),R=D("./src/utils/logger.ts"),b=D("./src/utils/mp4-tools.ts"),I=D("./src/loader/m3u8-parser.ts"),L=D("./src/types/loader.ts"),S=D("./src/utils/attr-list.ts");function g(p){var l=p.type;switch(l){case L.PlaylistContextType.AUDIO_TRACK:return L.PlaylistLevelType.AUDIO;case L.PlaylistContextType.SUBTITLE_TRACK:return L.PlaylistLevelType.SUBTITLE;default:return L.PlaylistLevelType.MAIN}}function _(p,l){var r=p.url;return(r===void 0||r.indexOf("data:")===0)&&(r=l.url),r}var E=function(){function p(r){this.hls=void 0,this.loaders=Object.create(null),this.hls=r,this.registerListeners()}var l=p.prototype;return l.startLoad=function(e){},l.stopLoad=function(){this.destroyInternalLoaders()},l.registerListeners=function(){var e=this.hls;e.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(A.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.unregisterListeners=function(){var e=this.hls;e.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(A.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.createInternalLoader=function(e){var f=this.hls.config,c=f.pLoader,n=f.loader,i=c||n,d=new i(f);return e.loader=d,this.loaders[e.type]=d,d},l.getInternalLoader=function(e){return this.loaders[e.type]},l.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},l.destroyInternalLoaders=function(){for(var e in this.loaders){var f=this.loaders[e];f&&f.destroy(),this.resetInternalLoader(e)}},l.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},l.onManifestLoading=function(e,f){var c=f.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:L.PlaylistContextType.MANIFEST,url:c,deliveryDirectives:null})},l.onLevelLoading=function(e,f){var c=f.id,n=f.level,i=f.url,d=f.deliveryDirectives;this.load({id:c,groupId:null,level:n,responseType:"text",type:L.PlaylistContextType.LEVEL,url:i,deliveryDirectives:d})},l.onAudioTrackLoading=function(e,f){var c=f.id,n=f.groupId,i=f.url,d=f.deliveryDirectives;this.load({id:c,groupId:n,level:null,responseType:"text",type:L.PlaylistContextType.AUDIO_TRACK,url:i,deliveryDirectives:d})},l.onSubtitleTrackLoading=function(e,f){var c=f.id,n=f.groupId,i=f.url,d=f.deliveryDirectives;this.load({id:c,groupId:n,level:null,responseType:"text",type:L.PlaylistContextType.SUBTITLE_TRACK,url:i,deliveryDirectives:d})},l.load=function(e){var f,c=this.hls.config,n=this.getInternalLoader(e);if(n){var i=n.context;if(i&&i.url===e.url){R.logger.trace("[playlist-loader]: playlist request ongoing");return}R.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),n.abort()}var d,o,t,v;switch(e.type){case L.PlaylistContextType.MANIFEST:d=c.manifestLoadingMaxRetry,o=c.manifestLoadingTimeOut,t=c.manifestLoadingRetryDelay,v=c.manifestLoadingMaxRetryTimeout;break;case L.PlaylistContextType.LEVEL:case L.PlaylistContextType.AUDIO_TRACK:case L.PlaylistContextType.SUBTITLE_TRACK:d=0,o=c.levelLoadingTimeOut;break;default:d=c.levelLoadingMaxRetry,o=c.levelLoadingTimeOut,t=c.levelLoadingRetryDelay,v=c.levelLoadingMaxRetryTimeout;break}if(n=this.createInternalLoader(e),(f=e.deliveryDirectives)!==null&&f!==void 0&&f.part){var s;if(e.type===L.PlaylistContextType.LEVEL&&e.level!==null?s=this.hls.levels[e.level].details:e.type===L.PlaylistContextType.AUDIO_TRACK&&e.id!==null?s=this.hls.audioTracks[e.id].details:e.type===L.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(s=this.hls.subtitleTracks[e.id].details),s){var h=s.partTarget,u=s.targetduration;h&&u&&(o=Math.min(Math.max(h*3,u*.8)*1e3,o))}}var a={timeout:o,maxRetry:d,retryDelay:t,maxRetryDelay:v,highWaterMark:0},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};n.load(e,a,m)},l.loadsuccess=function(e,f,c,n){if(n===void 0&&(n=null),c.isSidxRequest){this.handleSidxRequest(e,c),this.handlePlaylistLoaded(e,f,c,n);return}this.resetInternalLoader(c.type);var i=e.data;if(i.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(e,c,"no EXTM3U delimiter",n);return}f.parsing.start=performance.now(),i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,f,c,n):this.handleMasterPlaylist(e,f,c,n)},l.loaderror=function(e,f,c){c===void 0&&(c=null),this.handleNetworkError(f,c,!1,e)},l.loadtimeout=function(e,f,c){c===void 0&&(c=null),this.handleNetworkError(f,c,!0)},l.handleMasterPlaylist=function(e,f,c,n){var i=this.hls,d=e.data,o=_(e,c),t=I.default.parseMasterPlaylist(d,o),v=t.levels,s=t.sessionData;if(!v.length){this.handleManifestParsingError(e,c,"no level found in manifest",n);return}var h=v.map(function(M){return{id:M.attrs.AUDIO,audioCodec:M.audioCodec}}),u=v.map(function(M){return{id:M.attrs.SUBTITLES,textCodec:M.textCodec}}),a=I.default.parseMasterPlaylistMedia(d,o,"AUDIO",h),m=I.default.parseMasterPlaylistMedia(d,o,"SUBTITLES",u),T=I.default.parseMasterPlaylistMedia(d,o,"CLOSED-CAPTIONS");if(a.length){var P=a.some(function(M){return!M.url});!P&&v[0].audioCodec&&!v[0].attrs.AUDIO&&(R.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),a.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new S.AttrList({}),bitrate:0,url:""}))}i.trigger(A.Events.MANIFEST_LOADED,{levels:v,audioTracks:a,subtitles:m,captions:T,url:o,stats:f,networkDetails:n,sessionData:s})},l.handleTrackOrLevelPlaylist=function(e,f,c,n){var i=this.hls,d=c.id,o=c.level,t=c.type,v=_(e,c),s=(0,F.isFiniteNumber)(d)?d:0,h=(0,F.isFiniteNumber)(o)?o:s,u=g(c),a=I.default.parseLevelPlaylist(e.data,v,h,u,s);if(!a.fragments.length){i.trigger(A.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:v,reason:"no fragments found in level",level:typeof c.level=="number"?c.level:void 0});return}if(t===L.PlaylistContextType.MANIFEST){var m={attrs:new S.AttrList({}),bitrate:0,details:a,name:"",url:v};i.trigger(A.Events.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:v,stats:f,networkDetails:n,sessionData:null})}if(f.parsing.end=performance.now(),a.needSidxRanges){var T,P=(T=a.fragments[0].initSegment)===null||T===void 0?void 0:T.url;this.load({url:P,isSidxRequest:!0,type:t,level:o,levelDetails:a,id:d,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}c.levelDetails=a,this.handlePlaylistLoaded(e,f,c,n)},l.handleSidxRequest=function(e,f){var c=new Uint8Array(e.data),n=(0,b.findBox)(c,["sidx"])[0];if(!!n){var i=(0,b.parseSegmentIndex)(n);if(!!i){var d=i.references,o=f.levelDetails;d.forEach(function(t,v){var s=t.info,h=o.fragments[v];if(h.byteRange.length===0&&h.setByteRange(String(1+s.end-s.start)+"@"+String(s.start)),h.initSegment){var u=(0,b.findBox)(c,["moov"])[0],a=u?u.length:null;h.initSegment.setByteRange(String(a)+"@0")}})}}},l.handleManifestParsingError=function(e,f,c,n){this.hls.trigger(A.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:f.type===L.PlaylistContextType.MANIFEST,url:e.url,reason:c,response:e,context:f,networkDetails:n})},l.handleNetworkError=function(e,f,c,n){c===void 0&&(c=!1),R.logger.warn("[playlist-loader]: A network "+(c?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var i=O.ErrorDetails.UNKNOWN,d=!1,o=this.getInternalLoader(e);switch(e.type){case L.PlaylistContextType.MANIFEST:i=c?O.ErrorDetails.MANIFEST_LOAD_TIMEOUT:O.ErrorDetails.MANIFEST_LOAD_ERROR,d=!0;break;case L.PlaylistContextType.LEVEL:i=c?O.ErrorDetails.LEVEL_LOAD_TIMEOUT:O.ErrorDetails.LEVEL_LOAD_ERROR,d=!1;break;case L.PlaylistContextType.AUDIO_TRACK:i=c?O.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:O.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case L.PlaylistContextType.SUBTITLE_TRACK:i=c?O.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:O.ErrorDetails.SUBTITLE_LOAD_ERROR,d=!1;break}o&&this.resetInternalLoader(e.type);var t={type:O.ErrorTypes.NETWORK_ERROR,details:i,fatal:d,url:e.url,loader:o,context:e,networkDetails:f};n&&(t.response=n),this.hls.trigger(A.Events.ERROR,t)},l.handlePlaylistLoaded=function(e,f,c,n){var i=c.type,d=c.level,o=c.id,t=c.groupId,v=c.loader,s=c.levelDetails,h=c.deliveryDirectives;if(!(s!=null&&s.targetduration)){this.handleManifestParsingError(e,c,"invalid target duration",n);return}if(!!v)switch(s.live&&(v.getCacheAge&&(s.ageHeader=v.getCacheAge()||0),(!v.getCacheAge||isNaN(s.ageHeader))&&(s.ageHeader=0)),i){case L.PlaylistContextType.MANIFEST:case L.PlaylistContextType.LEVEL:this.hls.trigger(A.Events.LEVEL_LOADED,{details:s,level:d||0,id:o||0,stats:f,networkDetails:n,deliveryDirectives:h});break;case L.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(A.Events.AUDIO_TRACK_LOADED,{details:s,id:o||0,groupId:t||"",stats:f,networkDetails:n,deliveryDirectives:h});break;case L.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(A.Events.SUBTITLE_TRACK_LOADED,{details:s,id:o||0,groupId:t||"",stats:f,networkDetails:n,deliveryDirectives:h});break}},p}();const y=E},"./src/polyfills/number.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{MAX_SAFE_INTEGER:()=>A,isFiniteNumber:()=>F});var F=Number.isFinite||function(O){return typeof O=="number"&&isFinite(O)},A=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>A});var F=function(){function O(){}return O.getSilentFrame=function(b,I){switch(b){case"mp4a.40.2":if(I===1)return new Uint8Array([0,200,0,128,35,128]);if(I===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(I===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(I===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(I===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(I===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(I===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(I===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(I===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},O}();const A=F},"./src/remux/mp4-generator.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>O});var F=Math.pow(2,32)-1,A=function(){function R(){}return R.init=function(){R.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var I;for(I in R.types)R.types.hasOwnProperty(I)&&(R.types[I]=[I.charCodeAt(0),I.charCodeAt(1),I.charCodeAt(2),I.charCodeAt(3)]);var L=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),S=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);R.HDLR_TYPES={video:L,audio:S};var g=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),_=new Uint8Array([0,0,0,0,0,0,0,0]);R.STTS=R.STSC=R.STCO=_,R.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),R.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),R.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),R.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var E=new Uint8Array([105,115,111,109]),y=new Uint8Array([97,118,99,49]),p=new Uint8Array([0,0,0,1]);R.FTYP=R.box(R.types.ftyp,E,p,E,y),R.DINF=R.box(R.types.dinf,R.box(R.types.dref,g))},R.box=function(I){for(var L=8,S=arguments.length,g=new Array(S>1?S-1:0),_=1;_<S;_++)g[_-1]=arguments[_];for(var E=g.length,y=E;E--;)L+=g[E].byteLength;var p=new Uint8Array(L);for(p[0]=L>>24&255,p[1]=L>>16&255,p[2]=L>>8&255,p[3]=L&255,p.set(I,4),E=0,L=8;E<y;E++)p.set(g[E],L),L+=g[E].byteLength;return p},R.hdlr=function(I){return R.box(R.types.hdlr,R.HDLR_TYPES[I])},R.mdat=function(I){return R.box(R.types.mdat,I)},R.mdhd=function(I,L){L*=I;var S=Math.floor(L/(F+1)),g=Math.floor(L%(F+1));return R.box(R.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,I&255,S>>24,S>>16&255,S>>8&255,S&255,g>>24,g>>16&255,g>>8&255,g&255,85,196,0,0]))},R.mdia=function(I){return R.box(R.types.mdia,R.mdhd(I.timescale,I.duration),R.hdlr(I.type),R.minf(I))},R.mfhd=function(I){return R.box(R.types.mfhd,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,I&255]))},R.minf=function(I){return I.type==="audio"?R.box(R.types.minf,R.box(R.types.smhd,R.SMHD),R.DINF,R.stbl(I)):R.box(R.types.minf,R.box(R.types.vmhd,R.VMHD),R.DINF,R.stbl(I))},R.moof=function(I,L,S){return R.box(R.types.moof,R.mfhd(I),R.traf(S,L))},R.moov=function(I){for(var L=I.length,S=[];L--;)S[L]=R.trak(I[L]);return R.box.apply(null,[R.types.moov,R.mvhd(I[0].timescale,I[0].duration)].concat(S).concat(R.mvex(I)))},R.mvex=function(I){for(var L=I.length,S=[];L--;)S[L]=R.trex(I[L]);return R.box.apply(null,[R.types.mvex].concat(S))},R.mvhd=function(I,L){L*=I;var S=Math.floor(L/(F+1)),g=Math.floor(L%(F+1)),_=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,I&255,S>>24,S>>16&255,S>>8&255,S&255,g>>24,g>>16&255,g>>8&255,g&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return R.box(R.types.mvhd,_)},R.sdtp=function(I){var L=I.samples||[],S=new Uint8Array(4+L.length),g,_;for(g=0;g<L.length;g++)_=L[g].flags,S[g+4]=_.dependsOn<<4|_.isDependedOn<<2|_.hasRedundancy;return R.box(R.types.sdtp,S)},R.stbl=function(I){return R.box(R.types.stbl,R.stsd(I),R.box(R.types.stts,R.STTS),R.box(R.types.stsc,R.STSC),R.box(R.types.stsz,R.STSZ),R.box(R.types.stco,R.STCO))},R.avc1=function(I){var L=[],S=[],g,_,E;for(g=0;g<I.sps.length;g++)_=I.sps[g],E=_.byteLength,L.push(E>>>8&255),L.push(E&255),L=L.concat(Array.prototype.slice.call(_));for(g=0;g<I.pps.length;g++)_=I.pps[g],E=_.byteLength,S.push(E>>>8&255),S.push(E&255),S=S.concat(Array.prototype.slice.call(_));var y=R.box(R.types.avcC,new Uint8Array([1,L[3],L[4],L[5],255,224|I.sps.length].concat(L).concat([I.pps.length]).concat(S))),p=I.width,l=I.height,r=I.pixelRatio[0],e=I.pixelRatio[1];return R.box(R.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,p>>8&255,p&255,l>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),y,R.box(R.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),R.box(R.types.pasp,new Uint8Array([r>>24,r>>16&255,r>>8&255,r&255,e>>24,e>>16&255,e>>8&255,e&255])))},R.esds=function(I){var L=I.config.length;return new Uint8Array([0,0,0,0,3,23+L,0,1,0,4,15+L,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([L]).concat(I.config).concat([6,1,2]))},R.mp4a=function(I){var L=I.samplerate;return R.box(R.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,I.channelCount,0,16,0,0,0,0,L>>8&255,L&255,0,0]),R.box(R.types.esds,R.esds(I)))},R.mp3=function(I){var L=I.samplerate;return R.box(R.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,I.channelCount,0,16,0,0,0,0,L>>8&255,L&255,0,0]))},R.stsd=function(I){return I.type==="audio"?I.segmentCodec==="mp3"&&I.codec==="mp3"?R.box(R.types.stsd,R.STSD,R.mp3(I)):R.box(R.types.stsd,R.STSD,R.mp4a(I)):R.box(R.types.stsd,R.STSD,R.avc1(I))},R.tkhd=function(I){var L=I.id,S=I.duration*I.timescale,g=I.width,_=I.height,E=Math.floor(S/(F+1)),y=Math.floor(S%(F+1));return R.box(R.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,L>>24&255,L>>16&255,L>>8&255,L&255,0,0,0,0,E>>24,E>>16&255,E>>8&255,E&255,y>>24,y>>16&255,y>>8&255,y&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,g>>8&255,g&255,0,0,_>>8&255,_&255,0,0]))},R.traf=function(I,L){var S=R.sdtp(I),g=I.id,_=Math.floor(L/(F+1)),E=Math.floor(L%(F+1));return R.box(R.types.traf,R.box(R.types.tfhd,new Uint8Array([0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255])),R.box(R.types.tfdt,new Uint8Array([1,0,0,0,_>>24,_>>16&255,_>>8&255,_&255,E>>24,E>>16&255,E>>8&255,E&255])),R.trun(I,S.length+16+20+8+16+8+8),S)},R.trak=function(I){return I.duration=I.duration||4294967295,R.box(R.types.trak,R.tkhd(I),R.mdia(I))},R.trex=function(I){var L=I.id;return R.box(R.types.trex,new Uint8Array([0,0,0,0,L>>24,L>>16&255,L>>8&255,L&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},R.trun=function(I,L){var S=I.samples||[],g=S.length,_=12+16*g,E=new Uint8Array(_),y,p,l,r,e,f;for(L+=8+_,E.set([I.type==="video"?1:0,0,15,1,g>>>24&255,g>>>16&255,g>>>8&255,g&255,L>>>24&255,L>>>16&255,L>>>8&255,L&255],0),y=0;y<g;y++)p=S[y],l=p.duration,r=p.size,e=p.flags,f=p.cts,E.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,e.degradPrio&240<<8,e.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*y);return R.box(R.types.trun,E)},R.initSegment=function(I){R.types||R.init();var L=R.moov(I),S=new Uint8Array(R.FTYP.byteLength+L.byteLength);return S.set(R.FTYP),S.set(L,R.FTYP.byteLength),S},R}();A.types=void 0,A.HDLR_TYPES=void 0,A.STTS=void 0,A.STSC=void 0,A.STCO=void 0,A.STSZ=void 0,A.VMHD=void 0,A.SMHD=void 0,A.STSD=void 0,A.FTYP=void 0,A.DINF=void 0;const O=A},"./src/remux/mp4-remuxer.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>r,flushTextTrackMetadataCueSamples:()=>c,flushTextTrackUserdataCueSamples:()=>n,normalizePts:()=>e});var F=D("./src/polyfills/number.ts"),A=D("./src/remux/aac-helper.ts"),O=D("./src/remux/mp4-generator.ts"),R=D("./src/events.ts"),b=D("./src/errors.ts"),I=D("./src/utils/logger.ts"),L=D("./src/types/loader.ts"),S=D("./src/utils/timescale-conversion.ts");function g(){return g=Object.assign?Object.assign.bind():function(o){for(var t=1;t<arguments.length;t++){var v=arguments[t];for(var s in v)Object.prototype.hasOwnProperty.call(v,s)&&(o[s]=v[s])}return o},g.apply(this,arguments)}var _=10*1e3,E=1024,y=1152,p=null,l=null,r=function(){function o(v,s,h,u){if(u===void 0&&(u=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=v,this.config=s,this.typeSupported=h,this.ISGenerated=!1,p===null){var a=navigator.userAgent||"",m=a.match(/Chrome\/(\d+)/i);p=m?parseInt(m[1]):0}if(l===null){var T=navigator.userAgent.match(/Safari\/(\d+)/i);l=T?parseInt(T[1]):0}}var t=o.prototype;return t.destroy=function(){},t.resetTimeStamp=function(s){I.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=s},t.resetNextTimestamp=function(){I.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},t.resetInitSegment=function(){I.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},t.getVideoStartPts=function(s){var h=!1,u=s.reduce(function(a,m){var T=m.pts-a;return T<-4294967296?(h=!0,e(a,m.pts)):T>0?a:m.pts},s[0].pts);return h&&I.logger.debug("PTS rollover detected"),u},t.remux=function(s,h,u,a,m,T,P,M){var C,x,U,k,w,N,K=m,G=m,H=s.pid>-1,V=h.pid>-1,X=h.samples.length,Y=s.samples.length>0,Q=P&&X>0||X>1,$=(!H||Y)&&(!V||Q)||this.ISGenerated||P;if($){this.ISGenerated||(U=this.generateIS(s,h,m));var z=this.isVideoContiguous,j=-1,J;if(Q&&(j=f(h.samples),!z&&this.config.forceKeyFrameOnDiscontinuity))if(N=!0,j>0){I.logger.warn("[mp4-remuxer]: Dropped "+j+" out of "+X+" video samples due to a missing keyframe");var Z=this.getVideoStartPts(h.samples);h.samples=h.samples.slice(j),h.dropped+=j,G+=(h.samples[0].pts-Z)/h.inputTimeScale,J=G}else j===-1&&(I.logger.warn("[mp4-remuxer]: No keyframe found out of "+X+" video samples"),N=!1);if(this.ISGenerated){if(Y&&Q){var q=this.getVideoStartPts(h.samples),le=e(s.samples[0].pts,q)-q,ee=le/h.inputTimeScale;K+=Math.max(0,ee),G+=Math.max(0,-ee)}if(Y){if(s.samplerate||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),U=this.generateIS(s,h,m)),x=this.remuxAudio(s,K,this.isAudioContiguous,T,V||Q||M===L.PlaylistLevelType.AUDIO?G:void 0),Q){var de=x?x.endPTS-x.startPTS:0;h.inputTimeScale||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),U=this.generateIS(s,h,m)),C=this.remuxVideo(h,G,z,de)}}else Q&&(C=this.remuxVideo(h,G,z,0));C&&(C.firstKeyFrame=j,C.independent=j!==-1,C.firstKeyFramePTS=J)}}return this.ISGenerated&&(u.samples.length&&(w=c(u,m,this._initPTS,this._initDTS)),a.samples.length&&(k=n(a,m,this._initPTS))),{audio:x,video:C,initSegment:U,independent:N,text:k,id3:w}},t.generateIS=function(s,h,u){var a=s.samples,m=h.samples,T=this.typeSupported,P={},M=!(0,F.isFiniteNumber)(this._initPTS),C="audio/mp4",x,U,k;if(M&&(x=U=1/0),s.config&&a.length){switch(s.timescale=s.samplerate,s.segmentCodec){case"mp3":T.mpeg?(C="audio/mpeg",s.codec=""):T.mp3&&(s.codec="mp3");break}P.audio={id:"audio",container:C,codec:s.codec,initSegment:s.segmentCodec==="mp3"&&T.mpeg?new Uint8Array(0):O.default.initSegment([s]),metadata:{channelCount:s.channelCount}},M&&(k=s.inputTimeScale,x=U=a[0].pts-Math.round(k*u))}if(h.sps&&h.pps&&m.length&&(h.timescale=h.inputTimeScale,P.video={id:"main",container:"video/mp4",codec:h.codec,initSegment:O.default.initSegment([h]),metadata:{width:h.width,height:h.height}},M)){k=h.inputTimeScale;var w=this.getVideoStartPts(m),N=Math.round(k*u);U=Math.min(U,e(m[0].dts,w)-N),x=Math.min(x,w-N)}if(Object.keys(P).length)return this.ISGenerated=!0,M&&(this._initPTS=x,this._initDTS=U),{tracks:P,initPTS:x,timescale:k}},t.remuxVideo=function(s,h,u,a){var m=s.inputTimeScale,T=s.samples,P=[],M=T.length,C=this._initPTS,x=this.nextAvcDts,U=8,k=this.videoSampleDuration,w,N,K=Number.POSITIVE_INFINITY,G=Number.NEGATIVE_INFINITY,H=!1;if(!u||x===null){var V=h*m,X=T[0].pts-e(T[0].dts,T[0].pts);x=V-X}for(var Y=0;Y<M;Y++){var Q=T[Y];Q.pts=e(Q.pts-C,x),Q.dts=e(Q.dts-C,x),Q.dts<T[Y>0?Y-1:Y].dts&&(H=!0)}H&&T.sort(function(ke,We){var ze=ke.dts-We.dts,Qe=ke.pts-We.pts;return ze||Qe}),w=T[0].dts,N=T[T.length-1].dts;var $=N-w,z=$?Math.round($/(M-1)):k||s.inputTimeScale/30;if(u){var j=w-x,J=j>z,Z=j<-1;if((J||Z)&&(J?I.logger.warn("AVC: "+(0,S.toMsFromMpegTsClock)(j,!0)+" ms ("+j+"dts) hole between fragments detected, filling it"):I.logger.warn("AVC: "+(0,S.toMsFromMpegTsClock)(-j,!0)+" ms ("+j+"dts) overlapping between fragments detected"),!Z||x>T[0].pts)){w=x;var q=T[0].pts-j;T[0].dts=w,T[0].pts=q,I.logger.log("Video: First PTS/DTS adjusted: "+(0,S.toMsFromMpegTsClock)(q,!0)+"/"+(0,S.toMsFromMpegTsClock)(w,!0)+", delta: "+(0,S.toMsFromMpegTsClock)(j,!0)+" ms")}}w=Math.max(0,w);for(var le=0,ee=0,de=0;de<M;de++){for(var ae=T[de],fe=ae.units,ie=fe.length,he=0,ge=0;ge<ie;ge++)he+=fe[ge].data.length;ee+=he,le+=ie,ae.length=he,ae.dts=Math.max(ae.dts,w),K=Math.min(ae.pts,K),G=Math.max(ae.pts,G)}N=T[M-1].dts;var Ee=ee+4*le+8,ce;try{ce=new Uint8Array(Ee)}catch{this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:b.ErrorTypes.MUX_ERROR,details:b.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Ee,reason:"fail allocating video mdat "+Ee});return}var Se=new DataView(ce.buffer);Se.setUint32(0,Ee),ce.set(O.default.types.mdat,4);for(var ue=!1,De=Number.POSITIVE_INFINITY,ne=Number.POSITIVE_INFINITY,oe=Number.NEGATIVE_INFINITY,pe=Number.NEGATIVE_INFINITY,se=0;se<M;se++){for(var te=T[se],Ae=te.units,Te=0,Pe=0,Me=Ae.length;Pe<Me;Pe++){var ye=Ae[Pe],Be=ye.data,be=ye.data.byteLength;Se.setUint32(U,be),U+=4,ce.set(Be,U),U+=be,Te+=4+be}var Ie=void 0;if(se<M-1)k=T[se+1].dts-te.dts,Ie=T[se+1].pts-te.pts;else{var Oe=this.config,Re=se>0?te.dts-T[se-1].dts:z;if(Ie=se>0?te.pts-T[se-1].pts:z,Oe.stretchShortVideoTrack&&this.nextAudioPts!==null){var xe=Math.floor(Oe.maxBufferHole*m),Ce=(a?K+a*m:this.nextAudioPts)-te.pts;Ce>xe?(k=Ce-Re,k<0?k=Re:ue=!0,I.logger.log("[mp4-remuxer]: It is approximately "+Ce/90+" ms to the next segment; using duration "+k/90+" ms for the last video frame.")):k=Re}else k=Re}var Ge=Math.round(te.pts-te.dts);De=Math.min(De,k),oe=Math.max(oe,k),ne=Math.min(ne,Ie),pe=Math.max(pe,Ie),P.push(new i(te.key,k,Te,Ge))}if(P.length){if(p){if(p<70){var Ne=P[0].flags;Ne.dependsOn=2,Ne.isNonSync=0}}else if(l&&pe-ne<oe-De&&z/oe<.025&&P[0].cts===0){I.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Ue=w,_e=0,we=P.length;_e<we;_e++){var Ke=Ue+P[_e].duration,He=Ue+P[_e].cts;if(_e<we-1){var Ve=Ke+P[_e+1].cts;P[_e].duration=Ve-He}else P[_e].duration=_e?P[_e-1].duration:z;P[_e].cts=0,Ue=Ke}}}console.assert(k!==null,"mp4SampleDuration must be computed"),k=ue||!k?z:k,this.nextAvcDts=x=N+k,this.videoSampleDuration=k,this.isVideoContiguous=!0;var je=O.default.moof(s.sequenceNumber++,w,g({},s,{samples:P})),Ye="video",Xe={data1:je,data2:ce,startPTS:K/m,endPTS:(G+k)/m,startDTS:w/m,endDTS:x/m,type:Ye,hasAudio:!1,hasVideo:!0,nb:P.length,dropped:s.dropped};return s.samples=[],s.dropped=0,console.assert(ce.length,"MDAT length must not be zero"),Xe},t.remuxAudio=function(s,h,u,a,m){var T=s.inputTimeScale,P=s.samplerate?s.samplerate:T,M=T/P,C=s.segmentCodec==="aac"?E:y,x=C*M,U=this._initPTS,k=s.segmentCodec==="mp3"&&this.typeSupported.mpeg,w=[],N=m!==void 0,K=s.samples,G=k?0:8,H=this.nextAudioPts||-1,V=h*T;if(this.isAudioContiguous=u=u||K.length&&H>0&&(a&&Math.abs(V-H)<9e3||Math.abs(e(K[0].pts-U,V)-H)<20*x),K.forEach(function(ye){ye.pts=e(ye.pts-U,V)}),!u||H<0){if(K=K.filter(function(ye){return ye.pts>=0}),!K.length)return;m===0?H=0:a&&!N?H=Math.max(0,V):H=K[0].pts}if(s.segmentCodec==="aac")for(var X=this.config.maxAudioFramesDrift,Y=0,Q=H;Y<K.length;Y++){var $=K[Y],z=$.pts,j=z-Q,J=Math.abs(1e3*j/T);if(j<=-X*x&&N)Y===0&&(I.logger.warn("Audio frame @ "+(z/T).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*j/T)+" ms."),this.nextAudioPts=H=Q=z);else if(j>=X*x&&J<_&&N){var Z=Math.round(j/x);Q=z-Z*x,Q<0&&(Z--,Q+=x),Y===0&&(this.nextAudioPts=H=Q),I.logger.warn("[mp4-remuxer]: Injecting "+Z+" audio frame @ "+(Q/T).toFixed(3)+"s due to "+Math.round(1e3*j/T)+" ms gap.");for(var q=0;q<Z;q++){var le=Math.max(Q,0),ee=A.default.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);ee||(I.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ee=$.unit.subarray()),K.splice(Y,0,{unit:ee,pts:le}),Q+=x,Y++}}$.pts=Q,Q+=x}for(var de=null,ae=null,fe,ie=0,he=K.length;he--;)ie+=K[he].unit.byteLength;for(var ge=0,Ee=K.length;ge<Ee;ge++){var ce=K[ge],Se=ce.unit,ue=ce.pts;if(ae!==null){var De=w[ge-1];De.duration=Math.round((ue-ae)/M)}else if(u&&s.segmentCodec==="aac"&&(ue=H),de=ue,ie>0){ie+=G;try{fe=new Uint8Array(ie)}catch{this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:b.ErrorTypes.MUX_ERROR,details:b.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ie,reason:"fail allocating audio mdat "+ie});return}if(!k){var ne=new DataView(fe.buffer);ne.setUint32(0,ie),fe.set(O.default.types.mdat,4)}}else return;fe.set(Se,G);var oe=Se.byteLength;G+=oe,w.push(new i(!0,C,oe,0)),ae=ue}var pe=w.length;if(!!pe){var se=w[w.length-1];this.nextAudioPts=H=ae+M*se.duration;var te=k?new Uint8Array(0):O.default.moof(s.sequenceNumber++,de/M,g({},s,{samples:w}));s.samples=[];var Ae=de/T,Te=H/T,Pe="audio",Me={data1:te,data2:fe,startPTS:Ae,endPTS:Te,startDTS:Ae,endDTS:Te,type:Pe,hasAudio:!0,hasVideo:!1,nb:pe};return this.isAudioContiguous=!0,console.assert(fe.length,"MDAT length must not be zero"),Me}},t.remuxEmptyAudio=function(s,h,u,a){var m=s.inputTimeScale,T=s.samplerate?s.samplerate:m,P=m/T,M=this.nextAudioPts,C=(M!==null?M:a.startDTS*m)+this._initDTS,x=a.endDTS*m+this._initDTS,U=P*E,k=Math.ceil((x-C)/U),w=A.default.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);if(I.logger.warn("[mp4-remuxer]: remux empty Audio"),!w){I.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var N=[],K=0;K<k;K++){var G=C+K*U;N.push({unit:w,pts:G,dts:G})}return s.samples=N,this.remuxAudio(s,h,u,!1)},o}();function e(o,t){var v;if(t===null)return o;for(t<o?v=-8589934592:v=8589934592;Math.abs(o-t)>4294967296;)o+=v;return o}function f(o){for(var t=0;t<o.length;t++)if(o[t].key)return t;return-1}function c(o,t,v,s){var h=o.samples.length;if(!!h){for(var u=o.inputTimeScale,a=0;a<h;a++){var m=o.samples[a];m.pts=e(m.pts-v,t*u)/u,m.dts=e(m.dts-s,t*u)/u}var T=o.samples;return o.samples=[],{samples:T}}}function n(o,t,v){var s=o.samples.length;if(!!s){for(var h=o.inputTimeScale,u=0;u<s;u++){var a=o.samples[u];a.pts=e(a.pts-v,t*h)/h}o.samples.sort(function(T,P){return T.pts-P.pts});var m=o.samples;return o.samples=[],{samples:m}}}var i=function(t,v,s,h){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=v,this.size=s,this.cts=h,this.flags=new d(t)},d=function(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}},"./src/remux/passthrough-remuxer.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>S});var F=D("./src/polyfills/number.ts"),A=D("./src/remux/mp4-remuxer.ts"),O=D("./src/utils/mp4-tools.ts"),R=D("./src/loader/fragment.ts"),b=D("./src/utils/logger.ts"),I=function(){function g(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var _=g.prototype;return _.destroy=function(){},_.resetTimeStamp=function(y){this.initPTS=y,this.lastEndTime=null},_.resetNextTimestamp=function(){this.lastEndTime=null},_.resetInitSegment=function(y,p,l){this.audioCodec=p,this.videoCodec=l,this.generateInitSegment(y),this.emitInitSegment=!0},_.generateInitSegment=function(y){var p=this.audioCodec,l=this.videoCodec;if(!y||!y.byteLength){this.initTracks=void 0,this.initData=void 0;return}var r=this.initData=(0,O.parseInitSegment)(y);p||(p=L(r.audio,R.ElementaryStreamTypes.AUDIO)),l||(l=L(r.video,R.ElementaryStreamTypes.VIDEO));var e={};r.audio&&r.video?e.audiovideo={container:"video/mp4",codec:p+","+l,initSegment:y,id:"main"}:r.audio?e.audio={container:"audio/mp4",codec:p,initSegment:y,id:"audio"}:r.video?e.video={container:"video/mp4",codec:l,initSegment:y,id:"main"}:b.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},_.remux=function(y,p,l,r,e){var f,c=this.initPTS,n=this.lastEndTime,i={audio:void 0,video:void 0,text:r,id3:l,initSegment:void 0};(0,F.isFiniteNumber)(n)||(n=this.lastEndTime=e||0);var d=p.samples;if(!d||!d.length)return i;var o={initPTS:void 0,timescale:1},t=this.initData;if((!t||!t.length)&&(this.generateInitSegment(d),t=this.initData),!t||!t.length)return b.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),i;this.emitInitSegment&&(o.tracks=this.initTracks,this.emitInitSegment=!1);var v=(0,O.getStartDTS)(t,d);(0,F.isFiniteNumber)(c)||(this.initPTS=o.initPTS=c=v-e);var s=(0,O.getDuration)(d,t),h=y?v-c:n,u=h+s;(0,O.offsetStartDTS)(t,d,c),s>0?this.lastEndTime=u:(b.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var a=!!t.audio,m=!!t.video,T="";a&&(T+="audio"),m&&(T+="video");var P={data1:d,startPTS:h,startDTS:h,endPTS:u,endDTS:u,type:T,hasAudio:a,hasVideo:m,nb:1,dropped:0};i.audio=P.type==="audio"?P:void 0,i.video=P.type!=="audio"?P:void 0,i.initSegment=o;var M=(f=this.initPTS)!=null?f:0;return i.id3=(0,A.flushTextTrackMetadataCueSamples)(l,e,M,M),r.samples.length&&(i.text=(0,A.flushTextTrackUserdataCueSamples)(r,e,M)),i},g}();function L(g,_){var E=g?.codec;return E&&E.length>4?E:E==="hvc1"||E==="hev1"?"hvc1.1.c.L120.90":E==="av01"?"av01.0.04M.08":E==="avc1"||_===R.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const S=I},"./src/task-loop.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>F});var F=function(){function A(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var O=A.prototype;return O.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},O.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},O.onHandlerDestroyed=function(){},O.hasInterval=function(){return!!this._tickInterval},O.hasNextTick=function(){return!!this._tickTimer},O.setInterval=function(b){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,b),!0)},O.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},O.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},O.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},O.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},O.doTick=function(){},A}()},"./src/types/cmcd.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{CMCDObjectType:()=>A,CMCDStreamType:()=>R,CMCDStreamingFormat:()=>O,CMCDVersion:()=>F});var F=1,A;(function(b){b.MANIFEST="m",b.AUDIO="a",b.VIDEO="v",b.MUXED="av",b.INIT="i",b.CAPTION="c",b.TIMED_TEXT="tt",b.KEY="k",b.OTHER="o"})(A||(A={}));var O;(function(b){b.DASH="d",b.HLS="h",b.SMOOTH="s",b.OTHER="o"})(O||(O={}));var R;(function(b){b.VOD="v",b.LIVE="l"})(R||(R={}))},"./src/types/demuxer.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{MetadataSchema:()=>F});var F;(function(A){A.audioId3="org.id3",A.dateRange="com.apple.quicktime.HLS",A.emsg="https://aomedia.org/emsg/ID3"})(F||(F={}))},"./src/types/level.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{HlsSkip:()=>O,HlsUrlParameters:()=>b,Level:()=>I,getSkipValue:()=>R});function F(L,S){for(var g=0;g<S.length;g++){var _=S[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(L,_.key,_)}}function A(L,S,g){return S&&F(L.prototype,S),g&&F(L,g),Object.defineProperty(L,"prototype",{writable:!1}),L}var O;(function(L){L.No="",L.Yes="YES",L.v2="v2"})(O||(O={}));function R(L,S){var g=L.canSkipUntil,_=L.canSkipDateRanges,E=L.endSN,y=S!==void 0?S-E:0;return g&&y<g?_?O.v2:O.Yes:O.No}var b=function(){function L(g,_,E){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=g,this.part=_,this.skip=E}var S=L.prototype;return S.addDirectives=function(_){var E=new self.URL(_);return this.msn!==void 0&&E.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&E.searchParams.set("_HLS_part",this.part.toString()),this.skip&&E.searchParams.set("_HLS_skip",this.skip),E.toString()},L}(),I=function(){function L(S){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[S.url],this.attrs=S.attrs,this.bitrate=S.bitrate,S.details&&(this.details=S.details),this.id=S.id||0,this.name=S.name,this.width=S.width||0,this.height=S.height||0,this.audioCodec=S.audioCodec,this.videoCodec=S.videoCodec,this.unknownCodecs=S.unknownCodecs,this.codecSet=[S.videoCodec,S.audioCodec].filter(function(g){return g}).join(",").replace(/\.[^.,]+/g,"")}return A(L,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(g){var _=g%this.url.length;this._urlId!==_&&(this.details=void 0,this._urlId=_)}}]),L}()},"./src/types/loader.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{PlaylistContextType:()=>F,PlaylistLevelType:()=>A});var F;(function(O){O.MANIFEST="manifest",O.LEVEL="level",O.AUDIO_TRACK="audioTrack",O.SUBTITLE_TRACK="subtitleTrack"})(F||(F={}));var A;(function(O){O.MAIN="main",O.AUDIO="audio",O.SUBTITLE="subtitle"})(A||(A={}))},"./src/types/transmuxer.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{ChunkMetadata:()=>F});var F=function(R,b,I,L,S,g){L===void 0&&(L=0),S===void 0&&(S=-1),g===void 0&&(g=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=A(),this.buffering={audio:A(),video:A(),audiovideo:A()},this.level=R,this.sn=b,this.id=I,this.size=L,this.part=S,this.partial=g};function A(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{AttrList:()=>O});var F=/^(\d+)x(\d+)$/,A=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,O=function(){function R(I){typeof I=="string"&&(I=R.parseAttrList(I));for(var L in I)I.hasOwnProperty(L)&&(this[L]=I[L])}var b=R.prototype;return b.decimalInteger=function(L){var S=parseInt(this[L],10);return S>Number.MAX_SAFE_INTEGER?1/0:S},b.hexadecimalInteger=function(L){if(this[L]){var S=(this[L]||"0x").slice(2);S=(S.length&1?"0":"")+S;for(var g=new Uint8Array(S.length/2),_=0;_<S.length/2;_++)g[_]=parseInt(S.slice(_*2,_*2+2),16);return g}else return null},b.hexadecimalIntegerAsNumber=function(L){var S=parseInt(this[L],16);return S>Number.MAX_SAFE_INTEGER?1/0:S},b.decimalFloatingPoint=function(L){return parseFloat(this[L])},b.optionalFloat=function(L,S){var g=this[L];return g?parseFloat(g):S},b.enumeratedString=function(L){return this[L]},b.bool=function(L){return this[L]==="YES"},b.decimalResolution=function(L){var S=F.exec(this[L]);if(S!==null)return{width:parseInt(S[1],10),height:parseInt(S[2],10)}},R.parseAttrList=function(L){var S,g={},_='"';for(A.lastIndex=0;(S=A.exec(L))!==null;){var E=S[2];E.indexOf(_)===0&&E.lastIndexOf(_)===E.length-1&&(E=E.slice(1,-1)),g[S[1]]=E}return g},R}()},"./src/utils/binary-search.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>A});var F={search:function(R,b){for(var I=0,L=R.length-1,S=null,g=null;I<=L;){S=(I+L)/2|0,g=R[S];var _=b(g);if(_>0)I=S+1;else if(_<0)L=S-1;else return g}return null}};const A=F},"./src/utils/buffer-helper.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{BufferHelper:()=>O});var F=D("./src/utils/logger.ts"),A={length:0,start:function(){return 0},end:function(){return 0}},O=function(){function R(){}return R.isBuffered=function(I,L){try{if(I){for(var S=R.getBuffered(I),g=0;g<S.length;g++)if(L>=S.start(g)&&L<=S.end(g))return!0}}catch{}return!1},R.bufferInfo=function(I,L,S){try{if(I){var g=R.getBuffered(I),_=[],E;for(E=0;E<g.length;E++)_.push({start:g.start(E),end:g.end(E)});return this.bufferedInfo(_,L,S)}}catch{}return{len:0,start:L,end:L,nextStart:void 0}},R.bufferedInfo=function(I,L,S){L=Math.max(0,L),I.sort(function(i,d){var o=i.start-d.start;return o||d.end-i.end});var g=[];if(S)for(var _=0;_<I.length;_++){var E=g.length;if(E){var y=g[E-1].end;I[_].start-y<S?I[_].end>y&&(g[E-1].end=I[_].end):g.push(I[_])}else g.push(I[_])}else g=I;for(var p=0,l,r=L,e=L,f=0;f<g.length;f++){var c=g[f].start,n=g[f].end;if(L+S>=c&&L<n)r=c,e=n,p=e-L;else if(L+S<c){l=c;break}}return{len:p,start:r||0,end:e||0,nextStart:l}},R.getBuffered=function(I){try{return I.buffered}catch(L){return F.logger.log("failed to get media.buffered",L),A}},R}()},"./src/utils/cea-608-parser.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{CaptionScreen:()=>f,Row:()=>e,default:()=>t});var F=D("./src/utils/logger.ts"),A={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},O=function(s){var h=s;return A.hasOwnProperty(s)&&(h=A[s]),String.fromCharCode(h)},R=15,b=100,I={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},L={17:2,18:4,21:6,22:8,23:10,19:13,20:15},S={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},g={25:2,26:4,29:6,30:8,31:10,27:13,28:15},_=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],E;(function(v){v[v.ERROR=0]="ERROR",v[v.TEXT=1]="TEXT",v[v.WARNING=2]="WARNING",v[v.INFO=2]="INFO",v[v.DEBUG=3]="DEBUG",v[v.DATA=3]="DATA"})(E||(E={}));var y=function(){function v(){this.time=null,this.verboseLevel=E.ERROR}var s=v.prototype;return s.log=function(u,a){this.verboseLevel>=u&&F.logger.log(this.time+" ["+u+"] "+a)},v}(),p=function(s){for(var h=[],u=0;u<s.length;u++)h.push(s[u].toString(16));return h},l=function(){function v(h,u,a,m,T){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=h||"white",this.underline=u||!1,this.italics=a||!1,this.background=m||"black",this.flash=T||!1}var s=v.prototype;return s.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},s.setStyles=function(u){for(var a=["foreground","underline","italics","background","flash"],m=0;m<a.length;m++){var T=a[m];u.hasOwnProperty(T)&&(this[T]=u[T])}},s.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},s.equals=function(u){return this.foreground===u.foreground&&this.underline===u.underline&&this.italics===u.italics&&this.background===u.background&&this.flash===u.flash},s.copy=function(u){this.foreground=u.foreground,this.underline=u.underline,this.italics=u.italics,this.background=u.background,this.flash=u.flash},s.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},v}(),r=function(){function v(h,u,a,m,T,P){this.uchar=void 0,this.penState=void 0,this.uchar=h||" ",this.penState=new l(u,a,m,T,P)}var s=v.prototype;return s.reset=function(){this.uchar=" ",this.penState.reset()},s.setChar=function(u,a){this.uchar=u,this.penState.copy(a)},s.setPenState=function(u){this.penState.copy(u)},s.equals=function(u){return this.uchar===u.uchar&&this.penState.equals(u.penState)},s.copy=function(u){this.uchar=u.uchar,this.penState.copy(u.penState)},s.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},v}(),e=function(){function v(h){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var u=0;u<b;u++)this.chars.push(new r);this.logger=h,this.pos=0,this.currPenState=new l}var s=v.prototype;return s.equals=function(u){for(var a=!0,m=0;m<b;m++)if(!this.chars[m].equals(u.chars[m])){a=!1;break}return a},s.copy=function(u){for(var a=0;a<b;a++)this.chars[a].copy(u.chars[a])},s.isEmpty=function(){for(var u=!0,a=0;a<b;a++)if(!this.chars[a].isEmpty()){u=!1;break}return u},s.setCursor=function(u){this.pos!==u&&(this.pos=u),this.pos<0?(this.logger.log(E.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>b&&(this.logger.log(E.DEBUG,"Too large cursor position "+this.pos),this.pos=b)},s.moveCursor=function(u){var a=this.pos+u;if(u>1)for(var m=this.pos+1;m<a+1;m++)this.chars[m].setPenState(this.currPenState);this.setCursor(a)},s.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},s.insertChar=function(u){u>=144&&this.backSpace();var a=O(u);if(this.pos>=b){this.logger.log(E.ERROR,"Cannot insert "+u.toString(16)+" ("+a+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(a,this.currPenState),this.moveCursor(1)},s.clearFromPos=function(u){var a;for(a=u;a<b;a++)this.chars[a].reset()},s.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},s.clearToEndOfRow=function(){this.clearFromPos(this.pos)},s.getTextString=function(){for(var u=[],a=!0,m=0;m<b;m++){var T=this.chars[m].uchar;T!==" "&&(a=!1),u.push(T)}return a?"":u.join("")},s.setPenStyles=function(u){this.currPenState.setStyles(u);var a=this.chars[this.pos];a.setPenState(this.currPenState)},v}(),f=function(){function v(h){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var u=0;u<R;u++)this.rows.push(new e(h));this.logger=h,this.currRow=R-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var s=v.prototype;return s.reset=function(){for(var u=0;u<R;u++)this.rows[u].clear();this.currRow=R-1},s.equals=function(u){for(var a=!0,m=0;m<R;m++)if(!this.rows[m].equals(u.rows[m])){a=!1;break}return a},s.copy=function(u){for(var a=0;a<R;a++)this.rows[a].copy(u.rows[a])},s.isEmpty=function(){for(var u=!0,a=0;a<R;a++)if(!this.rows[a].isEmpty()){u=!1;break}return u},s.backSpace=function(){var u=this.rows[this.currRow];u.backSpace()},s.clearToEndOfRow=function(){var u=this.rows[this.currRow];u.clearToEndOfRow()},s.insertChar=function(u){var a=this.rows[this.currRow];a.insertChar(u)},s.setPen=function(u){var a=this.rows[this.currRow];a.setPenStyles(u)},s.moveCursor=function(u){var a=this.rows[this.currRow];a.moveCursor(u)},s.setCursor=function(u){this.logger.log(E.INFO,"setCursor: "+u);var a=this.rows[this.currRow];a.setCursor(u)},s.setPAC=function(u){this.logger.log(E.INFO,"pacData = "+JSON.stringify(u));var a=u.row-1;if(this.nrRollUpRows&&a<this.nrRollUpRows-1&&(a=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==a){for(var m=0;m<R;m++)this.rows[m].clear();var T=this.currRow+1-this.nrRollUpRows,P=this.lastOutputScreen;if(P){var M=P.rows[T].cueStartTime,C=this.logger.time;if(M&&C!==null&&M<C)for(var x=0;x<this.nrRollUpRows;x++)this.rows[a-this.nrRollUpRows+x+1].copy(P.rows[T+x])}}this.currRow=a;var U=this.rows[this.currRow];if(u.indent!==null){var k=u.indent,w=Math.max(k-1,0);U.setCursor(u.indent),u.color=U.chars[w].penState.foreground}var N={foreground:u.color,underline:u.underline,italics:u.italics,background:"black",flash:!1};this.setPen(N)},s.setBkgData=function(u){this.logger.log(E.INFO,"bkgData = "+JSON.stringify(u)),this.backSpace(),this.setPen(u),this.insertChar(32)},s.setRollUpRows=function(u){this.nrRollUpRows=u},s.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(E.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(E.TEXT,this.getDisplayText());var u=this.currRow+1-this.nrRollUpRows,a=this.rows.splice(u,1)[0];a.clear(),this.rows.splice(this.currRow,0,a),this.logger.log(E.INFO,"Rolling up")},s.getDisplayText=function(u){u=u||!1;for(var a=[],m="",T=-1,P=0;P<R;P++){var M=this.rows[P].getTextString();M&&(T=P+1,u?a.push("Row "+T+": '"+M+"'"):a.push(M.trim()))}return a.length>0&&(u?m="["+a.join(" | ")+"]":m=a.join(`
`)),m},s.getTextAndFormat=function(){return this.rows},v}(),c=function(){function v(h,u,a){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=h,this.outputFilter=u,this.mode=null,this.verbose=0,this.displayedMemory=new f(a),this.nonDisplayedMemory=new f(a),this.lastOutputScreen=new f(a),this.currRollUpRow=this.displayedMemory.rows[R-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=a}var s=v.prototype;return s.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[R-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},s.getHandler=function(){return this.outputFilter},s.setHandler=function(u){this.outputFilter=u},s.setPAC=function(u){this.writeScreen.setPAC(u)},s.setBkgData=function(u){this.writeScreen.setBkgData(u)},s.setMode=function(u){u!==this.mode&&(this.mode=u,this.logger.log(E.INFO,"MODE="+u),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=u)},s.insertChars=function(u){for(var a=0;a<u.length;a++)this.writeScreen.insertChar(u[a]);var m=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(E.INFO,m+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(E.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},s.ccRCL=function(){this.logger.log(E.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},s.ccBS=function(){this.logger.log(E.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},s.ccAOF=function(){},s.ccAON=function(){},s.ccDER=function(){this.logger.log(E.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},s.ccRU=function(u){this.logger.log(E.INFO,"RU("+u+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(u)},s.ccFON=function(){this.logger.log(E.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},s.ccRDC=function(){this.logger.log(E.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},s.ccTR=function(){this.logger.log(E.INFO,"TR"),this.setMode("MODE_TEXT")},s.ccRTD=function(){this.logger.log(E.INFO,"RTD"),this.setMode("MODE_TEXT")},s.ccEDM=function(){this.logger.log(E.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},s.ccCR=function(){this.logger.log(E.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},s.ccENM=function(){this.logger.log(E.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},s.ccEOC=function(){if(this.logger.log(E.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var u=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=u,this.writeScreen=this.nonDisplayedMemory,this.logger.log(E.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},s.ccTO=function(u){this.logger.log(E.INFO,"TO("+u+") - Tab Offset"),this.writeScreen.moveCursor(u)},s.ccMIDROW=function(u){var a={flash:!1};if(a.underline=u%2===1,a.italics=u>=46,a.italics)a.foreground="white";else{var m=Math.floor(u/2)-16,T=["white","green","blue","cyan","red","yellow","magenta"];a.foreground=T[m]}this.logger.log(E.INFO,"MIDROW: "+JSON.stringify(a)),this.writeScreen.setPen(a)},s.outputDataUpdate=function(u){u===void 0&&(u=!1);var a=this.logger.time;a!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=a:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,a,this.lastOutputScreen),u&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:a),this.lastOutputScreen.copy(this.displayedMemory))},s.cueSplitAtTime=function(u){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,u,this.displayedMemory),this.cueStartTime=u))},v}(),n=function(){function v(h,u,a){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var m=new y;this.channels=[null,new c(h,u,m),new c(h+1,a,m)],this.cmdHistory=o(),this.logger=m}var s=v.prototype;return s.getHandler=function(u){return this.channels[u].getHandler()},s.setHandler=function(u,a){this.channels[u].setHandler(a)},s.addData=function(u,a){var m,T,P,M=!1;this.logger.time=u;for(var C=0;C<a.length;C+=2)if(T=a[C]&127,P=a[C+1]&127,!(T===0&&P===0)){if(this.logger.log(E.DATA,"["+p([a[C],a[C+1]])+"] -> ("+p([T,P])+")"),m=this.parseCmd(T,P),m||(m=this.parseMidrow(T,P)),m||(m=this.parsePAC(T,P)),m||(m=this.parseBackgroundAttributes(T,P)),!m&&(M=this.parseChars(T,P),M)){var x=this.currentChannel;if(x&&x>0){var U=this.channels[x];U.insertChars(M)}else this.logger.log(E.WARNING,"No channel found yet. TEXT-MODE?")}!m&&!M&&this.logger.log(E.WARNING,"Couldn't parse cleaned data "+p([T,P])+" orig: "+p([a[C],a[C+1]]))}},s.parseCmd=function(u,a){var m=this.cmdHistory,T=(u===20||u===28||u===21||u===29)&&a>=32&&a<=47,P=(u===23||u===31)&&a>=33&&a<=35;if(!(T||P))return!1;if(d(u,a,m))return i(null,null,m),this.logger.log(E.DEBUG,"Repeated command ("+p([u,a])+") is dropped"),!0;var M=u===20||u===21||u===23?1:2,C=this.channels[M];return u===20||u===21||u===28||u===29?a===32?C.ccRCL():a===33?C.ccBS():a===34?C.ccAOF():a===35?C.ccAON():a===36?C.ccDER():a===37?C.ccRU(2):a===38?C.ccRU(3):a===39?C.ccRU(4):a===40?C.ccFON():a===41?C.ccRDC():a===42?C.ccTR():a===43?C.ccRTD():a===44?C.ccEDM():a===45?C.ccCR():a===46?C.ccENM():a===47&&C.ccEOC():C.ccTO(a-32),i(u,a,m),this.currentChannel=M,!0},s.parseMidrow=function(u,a){var m=0;if((u===17||u===25)&&a>=32&&a<=47){if(u===17?m=1:m=2,m!==this.currentChannel)return this.logger.log(E.ERROR,"Mismatch channel in midrow parsing"),!1;var T=this.channels[m];return T?(T.ccMIDROW(a),this.logger.log(E.DEBUG,"MIDROW ("+p([u,a])+")"),!0):!1}return!1},s.parsePAC=function(u,a){var m,T=this.cmdHistory,P=(u>=17&&u<=23||u>=25&&u<=31)&&a>=64&&a<=127,M=(u===16||u===24)&&a>=64&&a<=95;if(!(P||M))return!1;if(d(u,a,T))return i(null,null,T),!0;var C=u<=23?1:2;a>=64&&a<=95?m=C===1?I[u]:S[u]:m=C===1?L[u]:g[u];var x=this.channels[C];return x?(x.setPAC(this.interpretPAC(m,a)),i(u,a,T),this.currentChannel=C,!0):!1},s.interpretPAC=function(u,a){var m,T={color:null,italics:!1,indent:null,underline:!1,row:u};return a>95?m=a-96:m=a-64,T.underline=(m&1)===1,m<=13?T.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(m/2)]:m<=15?(T.italics=!0,T.color="white"):T.indent=Math.floor((m-16)/2)*4,T},s.parseChars=function(u,a){var m,T=null,P=null;if(u>=25?(m=2,P=u-8):(m=1,P=u),P>=17&&P<=19){var M;P===17?M=a+80:P===18?M=a+112:M=a+144,this.logger.log(E.INFO,"Special char '"+O(M)+"' in channel "+m),T=[M]}else u>=32&&u<=127&&(T=a===0?[u]:[u,a]);if(T){var C=p(T);this.logger.log(E.DEBUG,"Char codes =  "+C.join(",")),i(u,a,this.cmdHistory)}return T},s.parseBackgroundAttributes=function(u,a){var m=(u===16||u===24)&&a>=32&&a<=47,T=(u===23||u===31)&&a>=45&&a<=47;if(!(m||T))return!1;var P,M={};u===16||u===24?(P=Math.floor((a-32)/2),M.background=_[P],a%2===1&&(M.background=M.background+"_semi")):a===45?M.background="transparent":(M.foreground="black",a===47&&(M.underline=!0));var C=u<=23?1:2,x=this.channels[C];return x.setBkgData(M),i(u,a,this.cmdHistory),!0},s.reset=function(){for(var u=0;u<Object.keys(this.channels).length;u++){var a=this.channels[u];a&&a.reset()}this.cmdHistory=o()},s.cueSplitAtTime=function(u){for(var a=0;a<this.channels.length;a++){var m=this.channels[a];m&&m.cueSplitAtTime(u)}},v}();function i(v,s,h){h.a=v,h.b=s}function d(v,s,h){return h.a===v&&h.b===s}function o(){return{a:null,b:null}}const t=n},"./src/utils/codecs.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{isCodecSupportedInMp4:()=>O,isCodecType:()=>A});var F={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function A(R,b){var I=F[b];return!!I&&I[R.slice(0,4)]===!0}function O(R,b){return MediaSource.isTypeSupported((b||"video")+'/mp4;codecs="'+R+'"')}},"./src/utils/cues.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>I});var F=D("./src/utils/vttparser.ts"),A=D("./src/utils/webvtt-parser.ts"),O=D("./src/utils/texttrack-utils.ts"),R=/\s/,b={newCue:function(S,g,_,E){for(var y=[],p,l,r,e,f,c=self.VTTCue||self.TextTrackCue,n=0;n<E.rows.length;n++)if(p=E.rows[n],r=!0,e=0,f="",!p.isEmpty()){for(var i=0;i<p.chars.length;i++)R.test(p.chars[i].uchar)&&r?e++:(f+=p.chars[i].uchar,r=!1);p.cueStartTime=g,g===_&&(_+=1e-4),e>=16?e--:e++;var d=(0,F.fixLineBreaks)(f.trim()),o=(0,A.generateCueId)(g,_,d);(!S||!S.cues||!S.cues.getCueById(o))&&(l=new c(g,_,d),l.id=o,l.line=n+1,l.align="left",l.position=10+Math.min(80,Math.floor(e*8/32)*10),y.push(l))}return S&&y.length&&(y.sort(function(t,v){return t.line==="auto"||v.line==="auto"?0:t.line>8&&v.line>8?v.line-t.line:t.line-v.line}),y.forEach(function(t){return(0,O.addCueToTrack)(S,t)})),y}};const I=b},"./src/utils/discontinuities.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{adjustSlidingStart:()=>S,alignMediaPlaylistByPDT:()=>y,alignPDT:()=>E,alignStream:()=>g,findDiscontinuousReferenceFrag:()=>I,findFirstFragWithCC:()=>R,shouldAlignOnDiscontinuities:()=>b});var F=D("./src/polyfills/number.ts"),A=D("./src/utils/logger.ts"),O=D("./src/controller/level-helper.ts");function R(p,l){for(var r=null,e=0,f=p.length;e<f;e++){var c=p[e];if(c&&c.cc===l){r=c;break}}return r}function b(p,l,r){return!!(l.details&&(r.endCC>r.startCC||p&&p.cc<r.startCC))}function I(p,l,r){r===void 0&&(r=0);var e=p.fragments,f=l.fragments;if(!f.length||!e.length){A.logger.log("No fragments to align");return}var c=R(e,f[0].cc);if(!c||c&&!c.startPTS){A.logger.log("No frag in previous level to align on");return}return c}function L(p,l){if(p){var r=p.start+l;p.start=p.startPTS=r,p.endPTS=r+p.duration}}function S(p,l){for(var r=l.fragments,e=0,f=r.length;e<f;e++)L(r[e],p);l.fragmentHint&&L(l.fragmentHint,p),l.alignedSliding=!0}function g(p,l,r){!l||(_(p,r,l),!r.alignedSliding&&l.details&&E(r,l.details),!r.alignedSliding&&l.details&&!r.skippedSegments&&(0,O.adjustSliding)(l.details,r))}function _(p,l,r){if(b(p,r,l)){var e=I(r.details,l);e&&(0,F.isFiniteNumber)(e.start)&&(A.logger.log("Adjusting PTS using last level due to CC increase within current level "+l.url),S(e.start,l))}}function E(p,l){if(!(!l.fragments.length||!p.hasProgramDateTime||!l.hasProgramDateTime)){var r=l.fragments[0].programDateTime,e=p.fragments[0].programDateTime,f=(e-r)/1e3+l.fragments[0].start;f&&(0,F.isFiniteNumber)(f)&&(A.logger.log("Adjusting PTS using programDateTime delta "+(e-r)+"ms, sliding:"+f.toFixed(3)+" "+p.url+" "),S(f,p))}}function y(p,l){if(!(!p.hasProgramDateTime||!l.hasProgramDateTime)){var r=p.fragments,e=l.fragments;if(!(!r.length||!e.length)){var f=Math.round(e.length/2)-1,c=e[f],n=R(r,c.cc)||r[Math.round(r.length/2)-1],i=c.programDateTime,d=n.programDateTime;if(!(i===null||d===null)){var o=(d-i)/1e3-(n.start-c.start);S(o,p)}}}}},"./src/utils/ewma-bandwidth-estimator.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>O});var F=D("./src/utils/ewma.ts"),A=function(){function R(I,L,S){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=S,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new F.default(I),this.fast_=new F.default(L)}var b=R.prototype;return b.update=function(L,S){var g=this.slow_,_=this.fast_;this.slow_.halfLife!==L&&(this.slow_=new F.default(L,g.getEstimate(),g.getTotalWeight())),this.fast_.halfLife!==S&&(this.fast_=new F.default(S,_.getEstimate(),_.getTotalWeight()))},b.sample=function(L,S){L=Math.max(L,this.minDelayMs_);var g=8*S,_=L/1e3,E=g/_;this.fast_.sample(_,E),this.slow_.sample(_,E)},b.canEstimate=function(){var L=this.fast_;return L&&L.getTotalWeight()>=this.minWeight_},b.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},b.destroy=function(){},R}();const O=A},"./src/utils/ewma.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>A});var F=function(){function O(b,I,L){I===void 0&&(I=0),L===void 0&&(L=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=b,this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=I,this.totalWeight_=L}var R=O.prototype;return R.sample=function(I,L){var S=Math.pow(this.alpha_,I);this.estimate_=L*(1-S)+S*this.estimate_,this.totalWeight_+=I},R.getTotalWeight=function(){return this.totalWeight_},R.getEstimate=function(){if(this.alpha_){var I=1-Math.pow(this.alpha_,this.totalWeight_);if(I)return this.estimate_/I}return this.estimate_},O}();const A=F},"./src/utils/fetch-loader.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>f,fetchSupported:()=>y});var F=D("./src/polyfills/number.ts"),A=D("./src/loader/load-stats.ts"),O=D("./src/demux/chunk-cache.ts");function R(c,n){c.prototype=Object.create(n.prototype),c.prototype.constructor=c,g(c,n)}function b(c){var n=typeof Map=="function"?new Map:void 0;return b=function(d){if(d===null||!S(d))return d;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n<"u"){if(n.has(d))return n.get(d);n.set(d,o)}function o(){return I(d,arguments,_(this).constructor)}return o.prototype=Object.create(d.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),g(o,d)},b(c)}function I(c,n,i){return L()?I=Reflect.construct.bind():I=function(o,t,v){var s=[null];s.push.apply(s,t);var h=Function.bind.apply(o,s),u=new h;return v&&g(u,v.prototype),u},I.apply(null,arguments)}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(c){return Function.toString.call(c).indexOf("[native code]")!==-1}function g(c,n){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,o){return d.__proto__=o,d},g(c,n)}function _(c){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},_(c)}function E(){return E=Object.assign?Object.assign.bind():function(c){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(c[d]=i[d])}return c},E.apply(this,arguments)}function y(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var p=function(){function c(i){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=i.fetchSetup||r,this.controller=new self.AbortController,this.stats=new A.LoadStats}var n=c.prototype;return n.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},n.abortInternal=function(){var d=this.response;(!d||!d.ok)&&(this.stats.aborted=!0,this.controller.abort())},n.abort=function(){var d;this.abortInternal(),(d=this.callbacks)!==null&&d!==void 0&&d.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},n.load=function(d,o,t){var v=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var h=l(d,this.controller.signal),u=t.onProgress,a=d.responseType==="arraybuffer",m=a?"byteLength":"length";this.context=d,this.config=o,this.callbacks=t,this.request=this.fetchSetup(d,h),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){v.abortInternal(),t.onTimeout(s,d,v.response)},o.timeout),self.fetch(this.request).then(function(T){if(v.response=v.loader=T,!T.ok){var P=T.status,M=T.statusText;throw new e(M||"fetch, bad network response",P,T)}return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(T.headers.get("Content-Length")||"0"),u&&(0,F.isFiniteNumber)(o.highWaterMark)?v.loadProgressively(T,s,d,o.highWaterMark,u):a?T.arrayBuffer():T.text()}).then(function(T){var P=v.response;self.clearTimeout(v.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first),s.loaded=s.total=T[m];var M={url:P.url,data:T};u&&!(0,F.isFiniteNumber)(o.highWaterMark)&&u(s,d,T,P),t.onSuccess(M,s,d,P)}).catch(function(T){if(self.clearTimeout(v.requestTimeout),!s.aborted){var P=T&&T.code||0,M=T?T.message:null;t.onError({code:P,text:M},d,T?T.details:null)}})},n.getCacheAge=function(){var d=null;if(this.response){var o=this.response.headers.get("age");d=o?parseFloat(o):null}return d},n.loadProgressively=function(d,o,t,v,s){v===void 0&&(v=0);var h=new O.default,u=d.body.getReader(),a=function m(){return u.read().then(function(T){if(T.done)return h.dataLength&&s(o,t,h.flush(),d),Promise.resolve(new ArrayBuffer(0));var P=T.value,M=P.length;return o.loaded+=M,M<v||h.dataLength?(h.push(P),h.dataLength>=v&&s(o,t,h.flush(),d)):s(o,t,P,d),m()}).catch(function(){return Promise.reject()})};return a()},c}();function l(c,n){var i={method:"GET",mode:"cors",credentials:"same-origin",signal:n,headers:new self.Headers(E({},c.headers))};return c.rangeEnd&&i.headers.set("Range","bytes="+c.rangeStart+"-"+String(c.rangeEnd-1)),i}function r(c,n){return new self.Request(c.url,n)}var e=function(c){R(n,c);function n(i,d,o){var t;return t=c.call(this,i)||this,t.code=void 0,t.details=void 0,t.code=d,t.details=o,t}return n}(b(Error));const f=p},"./src/utils/imsc1-ttml-parser.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{IMSC1_CODEC:()=>S,parseIMSC1:()=>y});var F=D("./src/utils/mp4-tools.ts"),A=D("./src/utils/vttparser.ts"),O=D("./src/utils/vttcue.ts"),R=D("./src/demux/id3.ts"),b=D("./src/utils/timescale-conversion.ts"),I=D("./src/utils/webvtt-parser.ts");function L(){return L=Object.assign?Object.assign.bind():function(t){for(var v=1;v<arguments.length;v++){var s=arguments[v];for(var h in s)Object.prototype.hasOwnProperty.call(s,h)&&(t[h]=s[h])}return t},L.apply(this,arguments)}var S="stpp.ttml.im1t",g=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,_=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,E={left:"start",center:"center",right:"end",start:"start",end:"end"};function y(t,v,s,h,u){var a=(0,F.findBox)(new Uint8Array(t),["mdat"]);if(a.length===0){u(new Error("Could not parse IMSC1 mdat"));return}var m=a.map(function(P){return(0,R.utf8ArrayToStr)(P)}),T=(0,b.toTimescaleFromScale)(v,1,s);try{m.forEach(function(P){return h(p(P,T))})}catch(P){u(P)}}function p(t,v){var s=new DOMParser,h=s.parseFromString(t,"text/xml"),u=h.getElementsByTagName("tt")[0];if(!u)throw new Error("Invalid ttml");var a={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},m=Object.keys(a).reduce(function(x,U){return x[U]=u.getAttribute("ttp:"+U)||a[U],x},{}),T=u.getAttribute("xml:space")!=="preserve",P=r(l(u,"styling","style")),M=r(l(u,"layout","region")),C=l(u,"body","[begin]");return[].map.call(C,function(x){var U=e(x,T);if(!U||!x.hasAttribute("begin"))return null;var k=i(x.getAttribute("begin"),m),w=i(x.getAttribute("dur"),m),N=i(x.getAttribute("end"),m);if(k===null)throw n(x);if(N===null){if(w===null)throw n(x);N=k+w}var K=new O.default(k-v,N-v,U);K.id=(0,I.generateCueId)(K.startTime,K.endTime,K.text);var G=M[x.getAttribute("region")],H=P[x.getAttribute("style")];K.position=10,K.size=80;var V=f(G,H,P),X=V.textAlign;if(X){var Y=E[X];Y&&(K.lineAlign=Y),K.align=X}return L(K,V),K}).filter(function(x){return x!==null})}function l(t,v,s){var h=t.getElementsByTagName(v)[0];return h?[].slice.call(h.querySelectorAll(s)):[]}function r(t){return t.reduce(function(v,s){var h=s.getAttribute("xml:id");return h&&(v[h]=s),v},{})}function e(t,v){return[].slice.call(t.childNodes).reduce(function(s,h,u){var a;return h.nodeName==="br"&&u?s+`
`:(a=h.childNodes)!==null&&a!==void 0&&a.length?e(h,v):v?s+h.textContent.trim().replace(/\s+/g," "):s+h.textContent},"")}function f(t,v,s){var h="http://www.w3.org/ns/ttml#styling",u=null,a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],m=t!=null&&t.hasAttribute("style")?t.getAttribute("style"):null;return m&&s.hasOwnProperty(m)&&(u=s[m]),a.reduce(function(T,P){var M=c(v,h,P)||c(t,h,P)||c(u,h,P);return M&&(T[P]=M),T},{})}function c(t,v,s){return t&&t.hasAttributeNS(v,s)?t.getAttributeNS(v,s):null}function n(t){return new Error("Could not parse ttml timestamp "+t)}function i(t,v){if(!t)return null;var s=(0,A.parseTimeStamp)(t);return s===null&&(g.test(t)?s=d(t,v):_.test(t)&&(s=o(t,v))),s}function d(t,v){var s=g.exec(t),h=(s[4]|0)+(s[5]|0)/v.subFrameRate;return(s[1]|0)*3600+(s[2]|0)*60+(s[3]|0)+h/v.frameRate}function o(t,v){var s=_.exec(t),h=Number(s[1]),u=s[2];switch(u){case"h":return h*3600;case"m":return h*60;case"ms":return h*1e3;case"f":return h/v.frameRate;case"t":return h/v.tickRate}return h}},"./src/utils/logger.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{enableLogs:()=>I,logger:()=>L});var F=function(){},A={trace:F,debug:F,log:F,warn:F,info:F,error:F},O=A;function R(S){var g=self.console[S];return g?g.bind(self.console,"["+S+"] >"):F}function b(S){for(var g=arguments.length,_=new Array(g>1?g-1:0),E=1;E<g;E++)_[E-1]=arguments[E];_.forEach(function(y){O[y]=S[y]?S[y].bind(S):R(y)})}function I(S,g){if(self.console&&S===!0||typeof S=="object"){b(S,"debug","log","info","warn","error");try{O.log('Debug logs enabled for "'+g+'"')}catch{O=A}}else O=A}var L=O},"./src/utils/mediakeys-helper.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{KeySystems:()=>F,requestMediaKeySystemAccess:()=>A});var F;(function(O){O.WIDEVINE="com.widevine.alpha",O.PLAYREADY="com.microsoft.playready"})(F||(F={}));var A=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{getMediaSource:()=>F});function F(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{RemuxerTrackIdConfig:()=>I,appendUint8Array:()=>i,bin2str:()=>L,computeRawDurationFromSamples:()=>f,discardEPB:()=>s,findBox:()=>y,getDuration:()=>e,getStartDTS:()=>r,offsetStartDTS:()=>c,parseEmsg:()=>h,parseInitSegment:()=>l,parseSEIMessageFromNALu:()=>v,parseSamples:()=>d,parseSegmentIndex:()=>p,readSint32:()=>_,readUint16:()=>S,readUint32:()=>g,segmentValidRange:()=>n,writeUint32:()=>E});var F=D("./src/utils/typed-array.ts"),A=D("./src/loader/fragment.ts"),O=D("./src/demux/id3.ts"),R=Math.pow(2,32)-1,b=[].push,I={video:1,audio:2,id3:3,text:4};function L(u){return String.fromCharCode.apply(null,u)}function S(u,a){var m=u[a]<<8|u[a+1];return m<0?65536+m:m}function g(u,a){var m=_(u,a);return m<0?4294967296+m:m}function _(u,a){return u[a]<<24|u[a+1]<<16|u[a+2]<<8|u[a+3]}function E(u,a,m){u[a]=m>>24,u[a+1]=m>>16&255,u[a+2]=m>>8&255,u[a+3]=m&255}function y(u,a){var m=[];if(!a.length)return m;for(var T=u.byteLength,P=0;P<T;){var M=g(u,P),C=L(u.subarray(P+4,P+8)),x=M>1?P+M:T;if(C===a[0])if(a.length===1)m.push(u.subarray(P+8,x));else{var U=y(u.subarray(P+8,x),a.slice(1));U.length&&b.apply(m,U)}P=x}return m}function p(u){var a=[],m=u[0],T=8,P=g(u,T);T+=4;var M=0,C=0;m===0?T+=8:T+=16,T+=2;var x=u.length+C,U=S(u,T);T+=2;for(var k=0;k<U;k++){var w=T,N=g(u,w);w+=4;var K=N&2147483647,G=(N&2147483648)>>>31;if(G===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var H=g(u,w);w+=4,a.push({referenceSize:K,subsegmentDuration:H,info:{duration:H/P,start:x,end:x+K-1}}),x+=K,w+=4,T=w}return{earliestPresentationTime:M,timescale:P,version:m,referencesCount:U,references:a}}function l(u){for(var a=[],m=y(u,["moov","trak"]),T=0;T<m.length;T++){var P=m[T],M=y(P,["tkhd"])[0];if(M){var C=M[0],x=C===0?12:20,U=g(M,x),k=y(P,["mdia","mdhd"])[0];if(k){C=k[0],x=C===0?12:20;var w=g(k,x),N=y(P,["mdia","hdlr"])[0];if(N){var K=L(N.subarray(8,12)),G={soun:A.ElementaryStreamTypes.AUDIO,vide:A.ElementaryStreamTypes.VIDEO}[K];if(G){var H=y(P,["mdia","minf","stbl","stsd"])[0],V=void 0;H&&(V=L(H.subarray(12,16))),a[U]={timescale:w,type:G},a[G]={timescale:w,id:U,codec:V}}}}}}var X=y(u,["moov","mvex","trex"]);return X.forEach(function(Y){var Q=g(Y,4),$=a[Q];$&&($.default={duration:g(Y,12),flags:g(Y,20)})}),a}function r(u,a){return y(a,["moof","traf"]).reduce(function(m,T){var P=y(T,["tfdt"])[0],M=P[0],C=y(T,["tfhd"]).reduce(function(x,U){var k=g(U,4),w=u[k];if(w){var N=g(P,4);M===1&&(N*=Math.pow(2,32),N+=g(P,8));var K=w.timescale||9e4,G=N/K;if(isFinite(G)&&(x===null||G<x))return G}return x},null);return C!==null&&isFinite(C)&&(m===null||C<m)?C:m},null)||0}function e(u,a){for(var m=0,T=0,P=0,M=y(u,["moof","traf"]),C=0;C<M.length;C++){var x=M[C],U=y(x,["tfhd"])[0],k=g(U,4),w=a[k];if(!!w){var N=w.default,K=g(U,0)|N?.flags,G=N?.duration;K&8&&(K&2?G=g(U,12):G=g(U,8));for(var H=w.timescale||9e4,V=y(x,["trun"]),X=0;X<V.length;X++){if(m=f(V[X]),!m&&G){var Y=g(V[X],4);m=G*Y}w.type===A.ElementaryStreamTypes.VIDEO?T+=m/H:w.type===A.ElementaryStreamTypes.AUDIO&&(P+=m/H)}}}if(T===0&&P===0){for(var Q=0,$=y(u,["sidx"]),z=0;z<$.length;z++){var j=p($[z]);j!=null&&j.references&&(Q+=j.references.reduce(function(J,Z){return J+Z.info.duration||0},0))}return Q}return T||P}function f(u){var a=g(u,0),m=8;a&1&&(m+=4),a&4&&(m+=4);for(var T=0,P=g(u,4),M=0;M<P;M++){if(a&256){var C=g(u,m);T+=C,m+=4}a&512&&(m+=4),a&1024&&(m+=4),a&2048&&(m+=4)}return T}function c(u,a,m){y(a,["moof","traf"]).forEach(function(T){y(T,["tfhd"]).forEach(function(P){var M=g(P,4),C=u[M];if(!!C){var x=C.timescale||9e4;y(T,["tfdt"]).forEach(function(U){var k=U[0],w=g(U,4);if(k===0)w-=m*x,w=Math.max(w,0),E(U,4,w);else{w*=Math.pow(2,32),w+=g(U,8),w-=m*x,w=Math.max(w,0);var N=Math.floor(w/(R+1)),K=Math.floor(w%(R+1));E(U,4,N),E(U,8,K)}})}})})}function n(u){var a={valid:null,remainder:null},m=y(u,["moof"]);if(m){if(m.length<2)return a.remainder=u,a}else return a;var T=m[m.length-1];return a.valid=(0,F.sliceUint8)(u,0,T.byteOffset-8),a.remainder=(0,F.sliceUint8)(u,T.byteOffset-8),a}function i(u,a){var m=new Uint8Array(u.length+a.length);return m.set(u),m.set(a,u.length),m}function d(u,a){var m=[],T=a.samples,P=a.timescale,M=a.id,C=!1,x=y(T,["moof"]);return x.map(function(U){var k=U.byteOffset-8,w=y(U,["traf"]);w.map(function(N){var K=y(N,["tfdt"]).map(function(G){var H=G[0],V=g(G,4);return H===1&&(V*=Math.pow(2,32),V+=g(G,8)),V/P})[0];return K!==void 0&&(u=K),y(N,["tfhd"]).map(function(G){var H=g(G,4),V=g(G,0)&16777215,X=(V&1)!==0,Y=(V&2)!==0,Q=(V&8)!==0,$=0,z=(V&16)!==0,j=0,J=(V&32)!==0,Z=8;H===M&&(X&&(Z+=8),Y&&(Z+=4),Q&&($=g(G,Z),Z+=4),z&&(j=g(G,Z),Z+=4),J&&(Z+=4),a.type==="video"&&(C=o(a.codec)),y(N,["trun"]).map(function(q){var le=q[0],ee=g(q,0)&16777215,de=(ee&1)!==0,ae=0,fe=(ee&4)!==0,ie=(ee&256)!==0,he=0,ge=(ee&512)!==0,Ee=0,ce=(ee&1024)!==0,Se=(ee&2048)!==0,ue=0,De=g(q,4),ne=8;de&&(ae=g(q,ne),ne+=4),fe&&(ne+=4);for(var oe=ae+k,pe=0;pe<De;pe++){if(ie?(he=g(q,ne),ne+=4):he=$,ge?(Ee=g(q,ne),ne+=4):Ee=j,ce&&(ne+=4),Se&&(le===0?ue=g(q,ne):ue=_(q,ne),ne+=4),a.type===A.ElementaryStreamTypes.VIDEO)for(var se=0;se<Ee;){var te=g(T,oe);if(oe+=4,t(C,T[oe])){var Ae=T.subarray(oe,oe+te);v(Ae,C?2:1,u+ue/P,m)}oe+=te,se+=te+4}u+=he/P}}))})})}),m}function o(u){if(!u)return!1;var a=u.indexOf("."),m=a<0?u:u.substring(0,a);return m==="hvc1"||m==="hev1"||m==="dvh1"||m==="dvhe"}function t(u,a){if(u){var m=a>>1&63;return m===39||m===40}else{var T=a&31;return T===6}}function v(u,a,m,T){var P=s(u),M=0;M+=a;for(var C=0,x=0,U=!1,k=0;M<P.length;){C=0;do{if(M>=P.length)break;k=P[M++],C+=k}while(k===255);x=0;do{if(M>=P.length)break;k=P[M++],x+=k}while(k===255);var w=P.length-M;if(!U&&C===4&&M<P.length){U=!0;var N=P[M++];if(N===181){var K=S(P,M);if(M+=2,K===49){var G=g(P,M);if(M+=4,G===1195456820){var H=P[M++];if(H===3){var V=P[M++],X=31&V,Y=64&V,Q=Y?2+X*3:0,$=new Uint8Array(Q);if(Y){$[0]=V;for(var z=1;z<Q;z++)$[z]=P[M++]}T.push({type:H,payloadType:C,pts:m,bytes:$})}}}}}else if(C===5&&x<w){if(U=!0,x>16){for(var j=[],J=0;J<16;J++){var Z=P[M++].toString(16);j.push(Z.length==1?"0"+Z:Z),(J===3||J===5||J===7||J===9)&&j.push("-")}for(var q=x-16,le=new Uint8Array(q),ee=0;ee<q;ee++)le[ee]=P[M++];T.push({payloadType:C,pts:m,uuid:j.join(""),userData:(0,O.utf8ArrayToStr)(le),userDataBytes:le})}}else if(x<w)M+=x;else if(x>w)break}}function s(u){for(var a=u.byteLength,m=[],T=1;T<a-2;)u[T]===0&&u[T+1]===0&&u[T+2]===3?(m.push(T+2),T+=2):T++;if(m.length===0)return u;var P=a-m.length,M=new Uint8Array(P),C=0;for(T=0;T<P;C++,T++)C===m[0]&&(C++,m.shift()),M[T]=u[C];return M}function h(u){var a=u[0],m="",T="",P=0,M=0,C=0,x=0,U=0,k=0;if(a===0){for(;L(u.subarray(k,k+1))!=="\0";)m+=L(u.subarray(k,k+1)),k+=1;for(m+=L(u.subarray(k,k+1)),k+=1;L(u.subarray(k,k+1))!=="\0";)T+=L(u.subarray(k,k+1)),k+=1;T+=L(u.subarray(k,k+1)),k+=1,P=g(u,12),M=g(u,16),x=g(u,20),U=g(u,24),k=28}else if(a===1){k+=4,P=g(u,k),k+=4;var w=g(u,k);k+=4;var N=g(u,k);for(k+=4,C=Math.pow(2,32)*w+N,Number.isSafeInteger(C)||(C=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),x=g(u,k),k+=4,U=g(u,k),k+=4;L(u.subarray(k,k+1))!=="\0";)m+=L(u.subarray(k,k+1)),k+=1;for(m+=L(u.subarray(k,k+1)),k+=1;L(u.subarray(k,k+1))!=="\0";)T+=L(u.subarray(k,k+1)),k+=1;T+=L(u.subarray(k,k+1)),k+=1}var K=u.subarray(k,u.byteLength);return{schemeIdUri:m,value:T,timeScale:P,presentationTime:C,presentationTimeDelta:M,eventDuration:x,id:U,payload:K}}},"./src/utils/output-filter.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>F});var F=function(){function A(R,b){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=R,this.trackName=b}var O=A.prototype;return O.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},O.newCue=function(b,I,L){(this.startTime===null||this.startTime>b)&&(this.startTime=b),this.endTime=I,this.screen=L,this.timelineController.createCaptionsTrack(this.trackName)},O.reset=function(){this.cueRanges=[],this.startTime=null},A}()},"./src/utils/texttrack-utils.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{addCueToTrack:()=>O,clearCurrentCues:()=>R,getCuesInRange:()=>L,removeCuesInRange:()=>b,sendAddTrackEvent:()=>A});var F=D("./src/utils/logger.ts");function A(S,g){var _;try{_=new Event("addtrack")}catch{_=document.createEvent("Event"),_.initEvent("addtrack",!1,!1)}_.track=S,g.dispatchEvent(_)}function O(S,g){var _=S.mode;if(_==="disabled"&&(S.mode="hidden"),S.cues&&!S.cues.getCueById(g.id))try{if(S.addCue(g),!S.cues.getCueById(g.id))throw new Error("addCue is failed for: "+g)}catch(y){F.logger.debug("[texttrack-utils]: "+y);var E=new self.TextTrackCue(g.startTime,g.endTime,g.text);E.id=g.id,S.addCue(E)}_==="disabled"&&(S.mode=_)}function R(S){var g=S.mode;if(g==="disabled"&&(S.mode="hidden"),S.cues)for(var _=S.cues.length;_--;)S.removeCue(S.cues[_]);g==="disabled"&&(S.mode=g)}function b(S,g,_,E){var y=S.mode;if(y==="disabled"&&(S.mode="hidden"),S.cues&&S.cues.length>0)for(var p=L(S.cues,g,_),l=0;l<p.length;l++)(!E||E(p[l]))&&S.removeCue(p[l]);y==="disabled"&&(S.mode=y)}function I(S,g){if(g<S[0].startTime)return 0;var _=S.length-1;if(g>S[_].endTime)return-1;for(var E=0,y=_;E<=y;){var p=Math.floor((y+E)/2);if(g<S[p].startTime)y=p-1;else if(g>S[p].startTime&&E<_)E=p+1;else return p}return S[E].startTime-g<g-S[y].startTime?E:y}function L(S,g,_){var E=[],y=I(S,g);if(y>-1)for(var p=y,l=S.length;p<l;p++){var r=S[p];if(r.startTime>=g&&r.endTime<=_)E.push(r);else if(r.startTime>_)return E}return E}},"./src/utils/time-ranges.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>A});var F={toString:function(R){for(var b="",I=R.length,L=0;L<I;L++)b+="["+R.start(L).toFixed(3)+","+R.end(L).toFixed(3)+"]";return b}};const A=F},"./src/utils/timescale-conversion.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{toMpegTsClockFromTimescale:()=>b,toMsFromMpegTsClock:()=>R,toTimescaleFromBase:()=>A,toTimescaleFromScale:()=>O});var F=9e4;function A(I,L,S,g){S===void 0&&(S=1),g===void 0&&(g=!1);var _=I*L*S;return g?Math.round(_):_}function O(I,L,S,g){return S===void 0&&(S=1),g===void 0&&(g=!1),A(I,L,1/S,g)}function R(I,L){return L===void 0&&(L=!1),A(I,1e3,1/F,L)}function b(I,L){return L===void 0&&(L=1),A(I,F,1/L)}},"./src/utils/typed-array.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{sliceUint8:()=>F});function F(A,O,R){return Uint8Array.prototype.slice?A.slice(O,R):new Uint8Array(Array.prototype.slice.call(A,O,R))}},"./src/utils/vttcue.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>F});const F=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var A=["","lr","rl"],O=["start","middle","end","left","right"];function R(g,_){if(typeof _!="string"||!Array.isArray(g))return!1;var E=_.toLowerCase();return~g.indexOf(E)?E:!1}function b(g){return R(A,g)}function I(g){return R(O,g)}function L(g){for(var _=arguments.length,E=new Array(_>1?_-1:0),y=1;y<_;y++)E[y-1]=arguments[y];for(var p=1;p<arguments.length;p++){var l=arguments[p];for(var r in l)g[r]=l[r]}return g}function S(g,_,E){var y=this,p={enumerable:!0};y.hasBeenReset=!1;var l="",r=!1,e=g,f=_,c=E,n=null,i="",d=!0,o="auto",t="start",v=50,s="middle",h=50,u="middle";Object.defineProperty(y,"id",L({},p,{get:function(){return l},set:function(m){l=""+m}})),Object.defineProperty(y,"pauseOnExit",L({},p,{get:function(){return r},set:function(m){r=!!m}})),Object.defineProperty(y,"startTime",L({},p,{get:function(){return e},set:function(m){if(typeof m!="number")throw new TypeError("Start time must be set to a number.");e=m,this.hasBeenReset=!0}})),Object.defineProperty(y,"endTime",L({},p,{get:function(){return f},set:function(m){if(typeof m!="number")throw new TypeError("End time must be set to a number.");f=m,this.hasBeenReset=!0}})),Object.defineProperty(y,"text",L({},p,{get:function(){return c},set:function(m){c=""+m,this.hasBeenReset=!0}})),Object.defineProperty(y,"region",L({},p,{get:function(){return n},set:function(m){n=m,this.hasBeenReset=!0}})),Object.defineProperty(y,"vertical",L({},p,{get:function(){return i},set:function(m){var T=b(m);if(T===!1)throw new SyntaxError("An invalid or illegal string was specified.");i=T,this.hasBeenReset=!0}})),Object.defineProperty(y,"snapToLines",L({},p,{get:function(){return d},set:function(m){d=!!m,this.hasBeenReset=!0}})),Object.defineProperty(y,"line",L({},p,{get:function(){return o},set:function(m){if(typeof m!="number"&&m!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");o=m,this.hasBeenReset=!0}})),Object.defineProperty(y,"lineAlign",L({},p,{get:function(){return t},set:function(m){var T=I(m);if(!T)throw new SyntaxError("An invalid or illegal string was specified.");t=T,this.hasBeenReset=!0}})),Object.defineProperty(y,"position",L({},p,{get:function(){return v},set:function(m){if(m<0||m>100)throw new Error("Position must be between 0 and 100.");v=m,this.hasBeenReset=!0}})),Object.defineProperty(y,"positionAlign",L({},p,{get:function(){return s},set:function(m){var T=I(m);if(!T)throw new SyntaxError("An invalid or illegal string was specified.");s=T,this.hasBeenReset=!0}})),Object.defineProperty(y,"size",L({},p,{get:function(){return h},set:function(m){if(m<0||m>100)throw new Error("Size must be between 0 and 100.");h=m,this.hasBeenReset=!0}})),Object.defineProperty(y,"align",L({},p,{get:function(){return u},set:function(m){var T=I(m);if(!T)throw new SyntaxError("An invalid or illegal string was specified.");u=T,this.hasBeenReset=!0}})),y.displayState=void 0}return S.prototype.getCueAsHTML=function(){var g=self.WebVTT;return g.convertCueToDOMTree(self,this.text)},S}()},"./src/utils/vttparser.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{VTTParser:()=>_,fixLineBreaks:()=>g,parseTimeStamp:()=>O});var F=D("./src/utils/vttcue.ts"),A=function(){function E(){}var y=E.prototype;return y.decode=function(l,r){if(!l)return"";if(typeof l!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(l))},E}();function O(E){function y(l,r,e,f){return(l|0)*3600+(r|0)*60+(e|0)+parseFloat(f||0)}var p=E.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return p?parseFloat(p[2])>59?y(p[2],p[3],0,p[4]):y(p[1],p[2],p[3],p[4]):null}var R=function(){function E(){this.values=Object.create(null)}var y=E.prototype;return y.set=function(l,r){!this.get(l)&&r!==""&&(this.values[l]=r)},y.get=function(l,r,e){return e?this.has(l)?this.values[l]:r[e]:this.has(l)?this.values[l]:r},y.has=function(l){return l in this.values},y.alt=function(l,r,e){for(var f=0;f<e.length;++f)if(r===e[f]){this.set(l,r);break}},y.integer=function(l,r){/^-?\d+$/.test(r)&&this.set(l,parseInt(r,10))},y.percent=function(l,r){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(r)){var e=parseFloat(r);if(e>=0&&e<=100)return this.set(l,e),!0}return!1},E}();function b(E,y,p,l){var r=l?E.split(l):[E];for(var e in r)if(typeof r[e]=="string"){var f=r[e].split(p);if(f.length===2){var c=f[0],n=f[1];y(c,n)}}}var I=new F.default(0,0,""),L=I.align==="middle"?"middle":"center";function S(E,y,p){var l=E;function r(){var c=O(E);if(c===null)throw new Error("Malformed timestamp: "+l);return E=E.replace(/^[^\sa-zA-Z-]+/,""),c}function e(c,n){var i=new R;b(c,function(t,v){var s;switch(t){case"region":for(var h=p.length-1;h>=0;h--)if(p[h].id===v){i.set(t,p[h].region);break}break;case"vertical":i.alt(t,v,["rl","lr"]);break;case"line":s=v.split(","),i.integer(t,s[0]),i.percent(t,s[0])&&i.set("snapToLines",!1),i.alt(t,s[0],["auto"]),s.length===2&&i.alt("lineAlign",s[1],["start",L,"end"]);break;case"position":s=v.split(","),i.percent(t,s[0]),s.length===2&&i.alt("positionAlign",s[1],["start",L,"end","line-left","line-right","auto"]);break;case"size":i.percent(t,v);break;case"align":i.alt(t,v,["start",L,"end","left","right"]);break}},/:/,/\s/),n.region=i.get("region",null),n.vertical=i.get("vertical","");var d=i.get("line","auto");d==="auto"&&I.line===-1&&(d=-1),n.line=d,n.lineAlign=i.get("lineAlign","start"),n.snapToLines=i.get("snapToLines",!0),n.size=i.get("size",100),n.align=i.get("align",L);var o=i.get("position","auto");o==="auto"&&I.position===50&&(o=n.align==="start"||n.align==="left"?0:n.align==="end"||n.align==="right"?100:50),n.position=o}function f(){E=E.replace(/^\s+/,"")}if(f(),y.startTime=r(),f(),E.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+l);E=E.slice(3),f(),y.endTime=r(),f(),e(E,y)}function g(E){return E.replace(/<br(?: \/)?>/gi,`
`)}var _=function(){function E(){this.state="INITIAL",this.buffer="",this.decoder=new A,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var y=E.prototype;return y.parse=function(l){var r=this;l&&(r.buffer+=r.decoder.decode(l,{stream:!0}));function e(){var o=r.buffer,t=0;for(o=g(o);t<o.length&&o[t]!=="\r"&&o[t]!==`
`;)++t;var v=o.slice(0,t);return o[t]==="\r"&&++t,o[t]===`
`&&++t,r.buffer=o.slice(t),v}function f(o){b(o,function(t,v){},/:/)}try{var c="";if(r.state==="INITIAL"){if(!/\r\n|\n/.test(r.buffer))return this;c=e();var n=c.match(/^()?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");r.state="HEADER"}for(var i=!1;r.buffer;){if(!/\r\n|\n/.test(r.buffer))return this;switch(i?i=!1:c=e(),r.state){case"HEADER":/:/.test(c)?f(c):c||(r.state="ID");continue;case"NOTE":c||(r.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(c)){r.state="NOTE";break}if(!c)continue;if(r.cue=new F.default(0,0,""),r.state="CUE",c.indexOf("-->")===-1){r.cue.id=c;continue}case"CUE":if(!r.cue){r.state="BADCUE";continue}try{S(c,r.cue,r.regionList)}catch{r.cue=null,r.state="BADCUE";continue}r.state="CUETEXT";continue;case"CUETEXT":{var d=c.indexOf("-->")!==-1;if(!c||d&&(i=!0)){r.oncue&&r.cue&&r.oncue(r.cue),r.cue=null,r.state="ID";continue}if(r.cue===null)continue;r.cue.text&&(r.cue.text+=`
`),r.cue.text+=c}continue;case"BADCUE":c||(r.state="ID")}}}catch{r.state==="CUETEXT"&&r.cue&&r.oncue&&r.oncue(r.cue),r.cue=null,r.state=r.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},y.flush=function(){var l=this;try{if((l.cue||l.state==="HEADER")&&(l.buffer+=`

`,l.parse()),l.state==="INITIAL"||l.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(r){l.onparsingerror&&l.onparsingerror(r)}return l.onflush&&l.onflush(),this},E}()},"./src/utils/webvtt-parser.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{generateCueId:()=>_,parseWebVTT:()=>y});var F=D("./src/polyfills/number.ts"),A=D("./src/utils/vttparser.ts"),O=D("./src/demux/id3.ts"),R=D("./src/utils/timescale-conversion.ts"),b=D("./src/remux/mp4-remuxer.ts"),I=/\r\n|\n\r|\n|\r/g,L=function(l,r,e){return e===void 0&&(e=0),l.slice(e,e+r.length)===r},S=function(l){var r=parseInt(l.slice(-3)),e=parseInt(l.slice(-6,-4)),f=parseInt(l.slice(-9,-7)),c=l.length>9?parseInt(l.substring(0,l.indexOf(":"))):0;if(!(0,F.isFiniteNumber)(r)||!(0,F.isFiniteNumber)(e)||!(0,F.isFiniteNumber)(f)||!(0,F.isFiniteNumber)(c))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+l);return r+=1e3*e,r+=60*1e3*f,r+=60*60*1e3*c,r},g=function(l){for(var r=5381,e=l.length;e;)r=r*33^l.charCodeAt(--e);return(r>>>0).toString()};function _(p,l,r){return g(p.toString())+g(l.toString())+g(r)}var E=function(l,r,e){var f=l[r],c=l[f.prevCC];if(!c||!c.new&&f.new){l.ccOffset=l.presentationOffset=f.start,f.new=!1;return}for(;(n=c)!==null&&n!==void 0&&n.new;){var n;l.ccOffset+=f.start-c.start,f.new=!1,f=c,c=l[f.prevCC]}l.presentationOffset=e};function y(p,l,r,e,f,c,n,i){var d=new A.VTTParser,o=(0,O.utf8ArrayToStr)(new Uint8Array(p)).trim().replace(I,`
`).split(`
`),t=[],v=(0,R.toMpegTsClockFromTimescale)(l,r),s="00:00.000",h=0,u=0,a,m=!0;d.oncue=function(T){var P=e[f],M=e.ccOffset,C=(h-v)/9e4;P!=null&&P.new&&(u!==void 0?M=e.ccOffset=P.start:E(e,f,C)),C&&(M=C-e.presentationOffset);var x=T.endTime-T.startTime,U=(0,b.normalizePts)((T.startTime+M-u)*9e4,c*9e4)/9e4;T.startTime=Math.max(U,0),T.endTime=Math.max(U+x,0);var k=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(k)),T.id||(T.id=_(T.startTime,T.endTime,k)),T.endTime>0&&t.push(T)},d.onparsingerror=function(T){a=T},d.onflush=function(){if(a){i(a);return}n(t)},o.forEach(function(T){if(m)if(L(T,"X-TIMESTAMP-MAP=")){m=!1,T.slice(16).split(",").forEach(function(P){L(P,"LOCAL:")?s=P.slice(6):L(P,"MPEGTS:")&&(h=parseInt(P.slice(7)))});try{u=S(s)/1e3}catch(P){a=P}return}else T===""&&(m=!1);d.parse(T+`
`)}),d.flush()}},"./src/utils/xhr-loader.ts":(W,B,D)=>{"use strict";D.r(B),D.d(B,{default:()=>b});var F=D("./src/utils/logger.ts"),A=D("./src/loader/load-stats.ts"),O=/^age:\s*[\d.]+\s*$/m,R=function(){function I(S){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=S?S.xhrSetup:null,this.stats=new A.LoadStats,this.retryDelay=0}var L=I.prototype;return L.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},L.abortInternal=function(){var g=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),g&&(g.onreadystatechange=null,g.onprogress=null,g.readyState!==4&&(this.stats.aborted=!0,g.abort()))},L.abort=function(){var g;this.abortInternal(),(g=this.callbacks)!==null&&g!==void 0&&g.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},L.load=function(g,_,E){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=g,this.config=_,this.callbacks=E,this.retryDelay=_.retryDelay,this.loadInternal()},L.loadInternal=function(){var g=this.config,_=this.context;if(!!g){var E=this.loader=new self.XMLHttpRequest,y=this.stats;y.loading.first=0,y.loaded=0;var p=this.xhrSetup;try{if(p)try{p(E,_.url)}catch{E.open("GET",_.url,!0),p(E,_.url)}E.readyState||E.open("GET",_.url,!0);var l=this.context.headers;if(l)for(var r in l)E.setRequestHeader(r,l[r])}catch(e){this.callbacks.onError({code:E.status,text:e.message},_,E);return}_.rangeEnd&&E.setRequestHeader("Range","bytes="+_.rangeStart+"-"+(_.rangeEnd-1)),E.onreadystatechange=this.readystatechange.bind(this),E.onprogress=this.loadprogress.bind(this),E.responseType=_.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),g.timeout),E.send()}},L.readystatechange=function(){var g=this.context,_=this.loader,E=this.stats;if(!(!g||!_)){var y=_.readyState,p=this.config;if(!E.aborted&&y>=2)if(self.clearTimeout(this.requestTimeout),E.loading.first===0&&(E.loading.first=Math.max(self.performance.now(),E.loading.start)),y===4){_.onreadystatechange=null,_.onprogress=null;var l=_.status,r=_.responseType==="arraybuffer";if(l>=200&&l<300&&(r&&_.response||_.responseText!==null)){E.loading.end=Math.max(self.performance.now(),E.loading.first);var e,f;if(r?(e=_.response,f=e.byteLength):(e=_.responseText,f=e.length),E.loaded=E.total=f,!this.callbacks)return;var c=this.callbacks.onProgress;if(c&&c(E,g,e,_),!this.callbacks)return;var n={url:_.responseURL,data:e};this.callbacks.onSuccess(n,E,g,_)}else E.retry>=p.maxRetry||l>=400&&l<499?(F.logger.error(l+" while loading "+g.url),this.callbacks.onError({code:l,text:_.statusText},g,_)):(F.logger.warn(l+" while loading "+g.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,p.maxRetryDelay),E.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),p.timeout)}},L.loadtimeout=function(){F.logger.warn("timeout while loading "+this.context.url);var g=this.callbacks;g&&(this.abortInternal(),g.onTimeout(this.stats,this.context,this.loader))},L.loadprogress=function(g){var _=this.stats;_.loaded=g.loaded,g.lengthComputable&&(_.total=g.total)},L.getCacheAge=function(){var g=null;if(this.loader&&O.test(this.loader.getAllResponseHeaders())){var _=this.loader.getResponseHeader("age");g=_?parseFloat(_):null}return g},I}();const b=R},"./node_modules/eventemitter3/index.js":W=>{"use strict";var B=Object.prototype.hasOwnProperty,D="~";function F(){}Object.create&&(F.prototype=Object.create(null),new F().__proto__||(D=!1));function A(I,L,S){this.fn=I,this.context=L,this.once=S||!1}function O(I,L,S,g,_){if(typeof S!="function")throw new TypeError("The listener must be a function");var E=new A(S,g||I,_),y=D?D+L:L;return I._events[y]?I._events[y].fn?I._events[y]=[I._events[y],E]:I._events[y].push(E):(I._events[y]=E,I._eventsCount++),I}function R(I,L){--I._eventsCount===0?I._events=new F:delete I._events[L]}function b(){this._events=new F,this._eventsCount=0}b.prototype.eventNames=function(){var L=[],S,g;if(this._eventsCount===0)return L;for(g in S=this._events)B.call(S,g)&&L.push(D?g.slice(1):g);return Object.getOwnPropertySymbols?L.concat(Object.getOwnPropertySymbols(S)):L},b.prototype.listeners=function(L){var S=D?D+L:L,g=this._events[S];if(!g)return[];if(g.fn)return[g.fn];for(var _=0,E=g.length,y=new Array(E);_<E;_++)y[_]=g[_].fn;return y},b.prototype.listenerCount=function(L){var S=D?D+L:L,g=this._events[S];return g?g.fn?1:g.length:0},b.prototype.emit=function(L,S,g,_,E,y){var p=D?D+L:L;if(!this._events[p])return!1;var l=this._events[p],r=arguments.length,e,f;if(l.fn){switch(l.once&&this.removeListener(L,l.fn,void 0,!0),r){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,S),!0;case 3:return l.fn.call(l.context,S,g),!0;case 4:return l.fn.call(l.context,S,g,_),!0;case 5:return l.fn.call(l.context,S,g,_,E),!0;case 6:return l.fn.call(l.context,S,g,_,E,y),!0}for(f=1,e=new Array(r-1);f<r;f++)e[f-1]=arguments[f];l.fn.apply(l.context,e)}else{var c=l.length,n;for(f=0;f<c;f++)switch(l[f].once&&this.removeListener(L,l[f].fn,void 0,!0),r){case 1:l[f].fn.call(l[f].context);break;case 2:l[f].fn.call(l[f].context,S);break;case 3:l[f].fn.call(l[f].context,S,g);break;case 4:l[f].fn.call(l[f].context,S,g,_);break;default:if(!e)for(n=1,e=new Array(r-1);n<r;n++)e[n-1]=arguments[n];l[f].fn.apply(l[f].context,e)}}return!0},b.prototype.on=function(L,S,g){return O(this,L,S,g,!1)},b.prototype.once=function(L,S,g){return O(this,L,S,g,!0)},b.prototype.removeListener=function(L,S,g,_){var E=D?D+L:L;if(!this._events[E])return this;if(!S)return R(this,E),this;var y=this._events[E];if(y.fn)y.fn===S&&(!_||y.once)&&(!g||y.context===g)&&R(this,E);else{for(var p=0,l=[],r=y.length;p<r;p++)(y[p].fn!==S||_&&!y[p].once||g&&y[p].context!==g)&&l.push(y[p]);l.length?this._events[E]=l.length===1?l[0]:l:R(this,E)}return this},b.prototype.removeAllListeners=function(L){var S;return L?(S=D?D+L:L,this._events[S]&&R(this,S)):(this._events=new F,this._eventsCount=0),this},b.prototype.off=b.prototype.removeListener,b.prototype.addListener=b.prototype.on,b.prefixed=D,b.EventEmitter=b,W.exports=b},"./node_modules/url-toolkit/src/url-toolkit.js":function(W){(function(B){var D=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,F=/^(?=([^\/?#]*))\1([^]*)$/,A=/(?:\/|^)\.(?=\/)/g,O=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,R={buildAbsoluteURL:function(b,I,L){if(L=L||{},b=b.trim(),I=I.trim(),!I){if(!L.alwaysNormalize)return b;var S=R.parseURL(b);if(!S)throw new Error("Error trying to parse base URL.");return S.path=R.normalizePath(S.path),R.buildURLFromParts(S)}var g=R.parseURL(I);if(!g)throw new Error("Error trying to parse relative URL.");if(g.scheme)return L.alwaysNormalize?(g.path=R.normalizePath(g.path),R.buildURLFromParts(g)):I;var _=R.parseURL(b);if(!_)throw new Error("Error trying to parse base URL.");if(!_.netLoc&&_.path&&_.path[0]!=="/"){var E=F.exec(_.path);_.netLoc=E[1],_.path=E[2]}_.netLoc&&!_.path&&(_.path="/");var y={scheme:_.scheme,netLoc:g.netLoc,path:null,params:g.params,query:g.query,fragment:g.fragment};if(!g.netLoc&&(y.netLoc=_.netLoc,g.path[0]!=="/"))if(!g.path)y.path=_.path,g.params||(y.params=_.params,g.query||(y.query=_.query));else{var p=_.path,l=p.substring(0,p.lastIndexOf("/")+1)+g.path;y.path=R.normalizePath(l)}return y.path===null&&(y.path=L.alwaysNormalize?R.normalizePath(g.path):g.path),R.buildURLFromParts(y)},parseURL:function(b){var I=D.exec(b);return I?{scheme:I[1]||"",netLoc:I[2]||"",path:I[3]||"",params:I[4]||"",query:I[5]||"",fragment:I[6]||""}:null},normalizePath:function(b){for(b=b.split("").reverse().join("").replace(A,"");b.length!==(b=b.replace(O,"")).length;);return b.split("").reverse().join("")},buildURLFromParts:function(b){return b.scheme+b.netLoc+b.path+b.params+b.query+b.fragment}};W.exports=R})(this)}},ve={};function re(W){var B=ve[W];if(B!==void 0)return B.exports;var D=ve[W]={exports:{}};return Le[W].call(D.exports,D,D.exports,re),D.exports}re.m=Le,re.n=W=>{var B=W&&W.__esModule?()=>W.default:()=>W;return re.d(B,{a:B}),B},re.d=(W,B)=>{for(var D in B)re.o(B,D)&&!re.o(W,D)&&Object.defineProperty(W,D,{enumerable:!0,get:B[D]})},re.o=(W,B)=>Object.prototype.hasOwnProperty.call(W,B),re.r=W=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(W,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(W,"__esModule",{value:!0})};var me=re("./src/hls.ts");return me=me.default,me})())}}]);

//# sourceMappingURL=26.317dd140.js.map