"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[922],{4922:(Y,P,i)=>{i.r(P),i.d(P,{default:()=>V});var h=i(8160),U=i(108),w=i.n(U),v=i(414),C=i.n(v),E=i(9067),A=i(8081),S=i(6761),f=i(6939),y=i(8721),O=i(455),N=i(5861),D=i(9478),_=i(8160),I=Object.defineProperty,L=Object.defineProperties,x=Object.getOwnPropertyDescriptors,R=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable,b=(s,e,n)=>e in s?I(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,F=(s,e)=>{for(var n in e||(e={}))H.call(e,n)&&b(s,n,e[n]);if(R)for(var n of R(e))G.call(e,n)&&b(s,n,e[n]);return s},M=(s,e)=>L(s,x(e)),k=(s,e,n)=>(b(s,typeof e!="symbol"?e+"":e,n),n),g=(s,e,n)=>new Promise((c,t)=>{var m=l=>{try{o(n.next(l))}catch(a){t(a)}},r=l=>{try{o(n.throw(l))}catch(a){t(a)}},o=l=>l.done?c(l.value):Promise.resolve(l.value).then(m,r);o((n=n.apply(s,e)).next())});const j=D.T.enableTranscription&&new(w())({NVM_INC:"/Users/richwhalley/.nvm/versions/node/v19.1.0/include/node",TERM_PROGRAM:"Apple_Terminal",NODE:"/Users/richwhalley/.nvm/versions/node/v19.1.0/bin/node",NVM_CD_FLAGS:"-q",INIT_CWD:"/Users/richwhalley/Documents/GitHub/100ms-chat",TERM:"xterm-256color",SHELL:"/bin/zsh",TMPDIR:"/var/folders/1n/1t_dfvpj3r14m8rrf_4tdg5m0000gq/T/",npm_config_metrics_registry:"https://registry.npmjs.org/",npm_config_global_prefix:"/Users/richwhalley/.nvm/versions/node/v19.1.0",TERM_PROGRAM_VERSION:"445",TERM_SESSION_ID:"2FF9AA53-AE49-4B54-9A1E-30159D7C3C7D",COLOR:"1",npm_config_noproxy:"",npm_config_local_prefix:"/Users/richwhalley/Documents/GitHub/100ms-chat",USER:"richwhalley",NVM_DIR:"/Users/richwhalley/.nvm",npm_config_globalconfig:"/Users/richwhalley/.nvm/versions/node/v19.1.0/etc/npmrc",SSH_AUTH_SOCK:"/private/tmp/com.apple.launchd.aScJiBOdNO/Listeners",__CF_USER_TEXT_ENCODING:"0x1F7:0x0:0x0",npm_execpath:"/Users/richwhalley/.nvm/versions/node/v19.1.0/lib/node_modules/npm/bin/npm-cli.js",PATH:"/Users/richwhalley/Documents/GitHub/100ms-chat/node_modules/.bin:/Users/richwhalley/Documents/GitHub/node_modules/.bin:/Users/richwhalley/Documents/node_modules/.bin:/Users/richwhalley/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/Users/richwhalley/.nvm/versions/node/v19.1.0/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/Users/richwhalley/Documents/GitHub/100ms-chat/node_modules/.bin:/Users/richwhalley/Documents/GitHub/node_modules/.bin:/Users/richwhalley/Documents/node_modules/.bin:/Users/richwhalley/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/Users/richwhalley/.nvm/versions/node/v19.1.0/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/Users/richwhalley/.nvm/versions/node/v19.1.0/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/go/bin:/usr/local/share/dotnet:~/.dotnet/tools",_:"/Users/richwhalley/Documents/GitHub/100ms-chat/node_modules/.bin/webpack",npm_package_json:"/Users/richwhalley/Documents/GitHub/100ms-chat/package.json",__CFBundleIdentifier:"com.apple.Terminal",npm_config_init_module:"/Users/richwhalley/.npm-init.js",npm_config_userconfig:"/Users/richwhalley/.npmrc",PWD:"/Users/richwhalley/Documents/GitHub/100ms-chat",npm_command:"run-script",EDITOR:"vi",npm_lifecycle_event:"build",LANG:"en_US.UTF-8",npm_package_name:"100ms_edtech_template",XPC_FLAGS:"0x0",npm_config_node_gyp:"/Users/richwhalley/.nvm/versions/node/v19.1.0/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js",XPC_SERVICE_NAME:"0",npm_package_version:"0.1.4",HOME:"/Users/richwhalley",SHLVL:"3",LOGNAME:"richwhalley",npm_config_cache:"/Users/richwhalley/.npm",npm_lifecycle_script:"webpack --node-env production",NVM_BIN:"/Users/richwhalley/.nvm/versions/node/v19.1.0/bin",npm_config_user_agent:"npm/8.19.3 node/v19.1.0 darwin x64 workspaces/false",npm_config_prefix:"/Users/richwhalley/.nvm/versions/node/v19.1.0",npm_node_execpath:"/Users/richwhalley/.nvm/versions/node/v19.1.0/bin/node",NODE_ENV:"production",REACT_APP_TILE_SHAPE:"1-1",REACT_APP_THEME:"dark",REACT_APP_COLOR:"#2F80FF",REACT_APP_LOGO:"",REACT_APP_FONT:"Roboto",REACT_APP_TOKEN_GENERATION_ENDPOINT:"https://prod-in2.100ms.live/hmsapi/breakthrough.app.100ms.live/",REACT_APP_ENV:"prod",REACT_APP_ENABLE_HLS_QUALITY_LVL:"true",REACT_APP_LOGROCKET_ID:"<Your Logrocket project ID>",REACT_APP_POLICY_CONFIG:"",REACT_APP_DEFAULT_APP_DETAILS:"{}",REACT_APP_ENABLE_STATS_FOR_NERDS:"'false'",REACT_APP_PUSHER_APP_KEY:"",REACT_APP_PUSHER_AUTHENDPOINT:"",REACT_APP_HEADLESS_JOIN:"false",REACT_APP_TITLE:"100ms App"}.REACT_APP_TRANSCRIPTION_PUSHER_APP_KEY,{cluster:"ap2",authEndpoint:{NVM_INC:"/Users/richwhalley/.nvm/versions/node/v19.1.0/include/node",TERM_PROGRAM:"Apple_Terminal",NODE:"/Users/richwhalley/.nvm/versions/node/v19.1.0/bin/node",NVM_CD_FLAGS:"-q",INIT_CWD:"/Users/richwhalley/Documents/GitHub/100ms-chat",TERM:"xterm-256color",SHELL:"/bin/zsh",TMPDIR:"/var/folders/1n/1t_dfvpj3r14m8rrf_4tdg5m0000gq/T/",npm_config_metrics_registry:"https://registry.npmjs.org/",npm_config_global_prefix:"/Users/richwhalley/.nvm/versions/node/v19.1.0",TERM_PROGRAM_VERSION:"445",TERM_SESSION_ID:"2FF9AA53-AE49-4B54-9A1E-30159D7C3C7D",COLOR:"1",npm_config_noproxy:"",npm_config_local_prefix:"/Users/richwhalley/Documents/GitHub/100ms-chat",USER:"richwhalley",NVM_DIR:"/Users/richwhalley/.nvm",npm_config_globalconfig:"/Users/richwhalley/.nvm/versions/node/v19.1.0/etc/npmrc",SSH_AUTH_SOCK:"/private/tmp/com.apple.launchd.aScJiBOdNO/Listeners",__CF_USER_TEXT_ENCODING:"0x1F7:0x0:0x0",npm_execpath:"/Users/richwhalley/.nvm/versions/node/v19.1.0/lib/node_modules/npm/bin/npm-cli.js",PATH:"/Users/richwhalley/Documents/GitHub/100ms-chat/node_modules/.bin:/Users/richwhalley/Documents/GitHub/node_modules/.bin:/Users/richwhalley/Documents/node_modules/.bin:/Users/richwhalley/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/Users/richwhalley/.nvm/versions/node/v19.1.0/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/Users/richwhalley/Documents/GitHub/100ms-chat/node_modules/.bin:/Users/richwhalley/Documents/GitHub/node_modules/.bin:/Users/richwhalley/Documents/node_modules/.bin:/Users/richwhalley/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/Users/richwhalley/.nvm/versions/node/v19.1.0/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/Users/richwhalley/.nvm/versions/node/v19.1.0/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/go/bin:/usr/local/share/dotnet:~/.dotnet/tools",_:"/Users/richwhalley/Documents/GitHub/100ms-chat/node_modules/.bin/webpack",npm_package_json:"/Users/richwhalley/Documents/GitHub/100ms-chat/package.json",__CFBundleIdentifier:"com.apple.Terminal",npm_config_init_module:"/Users/richwhalley/.npm-init.js",npm_config_userconfig:"/Users/richwhalley/.npmrc",PWD:"/Users/richwhalley/Documents/GitHub/100ms-chat",npm_command:"run-script",EDITOR:"vi",npm_lifecycle_event:"build",LANG:"en_US.UTF-8",npm_package_name:"100ms_edtech_template",XPC_FLAGS:"0x0",npm_config_node_gyp:"/Users/richwhalley/.nvm/versions/node/v19.1.0/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js",XPC_SERVICE_NAME:"0",npm_package_version:"0.1.4",HOME:"/Users/richwhalley",SHLVL:"3",LOGNAME:"richwhalley",npm_config_cache:"/Users/richwhalley/.npm",npm_lifecycle_script:"webpack --node-env production",NVM_BIN:"/Users/richwhalley/.nvm/versions/node/v19.1.0/bin",npm_config_user_agent:"npm/8.19.3 node/v19.1.0 darwin x64 workspaces/false",npm_config_prefix:"/Users/richwhalley/.nvm/versions/node/v19.1.0",npm_node_execpath:"/Users/richwhalley/.nvm/versions/node/v19.1.0/bin/node",NODE_ENV:"production",REACT_APP_TILE_SHAPE:"1-1",REACT_APP_THEME:"dark",REACT_APP_COLOR:"#2F80FF",REACT_APP_LOGO:"",REACT_APP_FONT:"Roboto",REACT_APP_TOKEN_GENERATION_ENDPOINT:"https://prod-in2.100ms.live/hmsapi/breakthrough.app.100ms.live/",REACT_APP_ENV:"prod",REACT_APP_ENABLE_HLS_QUALITY_LVL:"true",REACT_APP_LOGROCKET_ID:"<Your Logrocket project ID>",REACT_APP_POLICY_CONFIG:"",REACT_APP_DEFAULT_APP_DETAILS:"{}",REACT_APP_ENABLE_STATS_FOR_NERDS:"'false'",REACT_APP_PUSHER_APP_KEY:"",REACT_APP_PUSHER_AUTHENDPOINT:"",REACT_APP_HEADLESS_JOIN:"false",REACT_APP_TITLE:"100ms App"}.REACT_APP_TRANSCRIPTION_PUSHER_AUTHENDPOINT});let T=null;function V(){const[s,e]=(0,h.useState)(!1),[n,c]=(0,h.useState)(""),[t,m]=(0,h.useState)(""),r=(0,h.useRef)(null),o=(0,E._U)(A.j5),l=(0,E._U)(A.xf),a=(0,E.C1)(),u=(0,h.useCallback)((p=null)=>{r.current||(r.current=new B(c,m),r.current.enabled=!1),p!==!1&&(p=!s),r.current.enableTranscription(p),e(p)},[s]);return(0,h.useEffect)(()=>{T=j.subscribe(`private-${o}`),T.bind("client-transcription",({text:p})=>{if(p){let d=JSON.parse(p);d&&d.transcriptionConfig?u(!s&&d.transcriptionConfig.isEnabled):d&&d.peername&&d.transcript!==""&&(c(d.transcript),m("["+d.peername+"]"),d.isEnabled&&!s&&u(),setTimeout(()=>{c(""),m("")},5e3))}})},[o,s,u]),(0,h.useEffect)(()=>{!a||r.current&&s&&a.type===A.a5.PEER_JOINED&&r.current.broadcast(JSON.stringify({transcriptionConfig:{isEnabled:!0}}))},[a,s]),_.createElement(_.Fragment,null,_.createElement(f.x,{css:{textAlign:"left",fontWeight:"$medium",bottom:"120px",position:"fixed",width:"100%",fontSize:"$20px",zIndex:"1000000",color:"white",textShadow:"0px 0px 6px #000",whiteSpace:"pre-line",paddingLeft:"40px"}}),_.createElement(f.x,{css:{textAlign:"center",fontWeight:"$medium",bottom:"90px",position:"fixed",width:"100%",fontSize:"$20px",zIndex:"1000000",color:"white",textShadow:"0px 0px 6px #000",whiteSpace:"pre-line"}},_.createElement(y.x,{css:{color:"white",textShadow:"0px 0px 6px #000"}},n),_.createElement(y.x,{css:{color:"#c0bbbb",textShadow:"0px 0px 6px #000",textTransform:"capitalize"}},t)),l.audio&&_.createElement(O.u,{title:`Turn ${s?"off":"on"} transcription`},_.createElement(N.h,{active:!s,onClick:u,"data-testid":"transcription_btn"},_.createElement(S.Z,null))))}class B{constructor(e,n){k(this,"broadcast",(c,t="transcription")=>{T.trigger(`client-${t}`,{text:c,eventName:t})}),this.enabled=!1,this.socket=null,this.totalTimeDiff=0,this.totalCount=0,this.streams={},this.setTranscript=e,this.setSpeakingPeer=n,this.initialized=!1,this.lastMessage={},this.localPeerId=null,this.sttTuningConfig={timeSlice:250,desiredSampRate:8e3,numberOfAudioChannels:1,bufferSize:256}}listen(){return g(this,null,function*(){try{const e=window.__hms.sdk.getLocalPeer();this.localPeerId=e.peerId,this.streams[e.peerId]={stream:new MediaStream([e.audioTrack.nativeTrack]),name:e.name};let n={NVM_INC:"/Users/richwhalley/.nvm/versions/node/v19.1.0/include/node",TERM_PROGRAM:"Apple_Terminal",NODE:"/Users/richwhalley/.nvm/versions/node/v19.1.0/bin/node",NVM_CD_FLAGS:"-q",INIT_CWD:"/Users/richwhalley/Documents/GitHub/100ms-chat",TERM:"xterm-256color",SHELL:"/bin/zsh",TMPDIR:"/var/folders/1n/1t_dfvpj3r14m8rrf_4tdg5m0000gq/T/",npm_config_metrics_registry:"https://registry.npmjs.org/",npm_config_global_prefix:"/Users/richwhalley/.nvm/versions/node/v19.1.0",TERM_PROGRAM_VERSION:"445",TERM_SESSION_ID:"2FF9AA53-AE49-4B54-9A1E-30159D7C3C7D",COLOR:"1",npm_config_noproxy:"",npm_config_local_prefix:"/Users/richwhalley/Documents/GitHub/100ms-chat",USER:"richwhalley",NVM_DIR:"/Users/richwhalley/.nvm",npm_config_globalconfig:"/Users/richwhalley/.nvm/versions/node/v19.1.0/etc/npmrc",SSH_AUTH_SOCK:"/private/tmp/com.apple.launchd.aScJiBOdNO/Listeners",__CF_USER_TEXT_ENCODING:"0x1F7:0x0:0x0",npm_execpath:"/Users/richwhalley/.nvm/versions/node/v19.1.0/lib/node_modules/npm/bin/npm-cli.js",PATH:"/Users/richwhalley/Documents/GitHub/100ms-chat/node_modules/.bin:/Users/richwhalley/Documents/GitHub/node_modules/.bin:/Users/richwhalley/Documents/node_modules/.bin:/Users/richwhalley/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/Users/richwhalley/.nvm/versions/node/v19.1.0/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/Users/richwhalley/Documents/GitHub/100ms-chat/node_modules/.bin:/Users/richwhalley/Documents/GitHub/node_modules/.bin:/Users/richwhalley/Documents/node_modules/.bin:/Users/richwhalley/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/Users/richwhalley/.nvm/versions/node/v19.1.0/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/Users/richwhalley/.nvm/versions/node/v19.1.0/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/go/bin:/usr/local/share/dotnet:~/.dotnet/tools",_:"/Users/richwhalley/Documents/GitHub/100ms-chat/node_modules/.bin/webpack",npm_package_json:"/Users/richwhalley/Documents/GitHub/100ms-chat/package.json",__CFBundleIdentifier:"com.apple.Terminal",npm_config_init_module:"/Users/richwhalley/.npm-init.js",npm_config_userconfig:"/Users/richwhalley/.npmrc",PWD:"/Users/richwhalley/Documents/GitHub/100ms-chat",npm_command:"run-script",EDITOR:"vi",npm_lifecycle_event:"build",LANG:"en_US.UTF-8",npm_package_name:"100ms_edtech_template",XPC_FLAGS:"0x0",npm_config_node_gyp:"/Users/richwhalley/.nvm/versions/node/v19.1.0/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js",XPC_SERVICE_NAME:"0",npm_package_version:"0.1.4",HOME:"/Users/richwhalley",SHLVL:"3",LOGNAME:"richwhalley",npm_config_cache:"/Users/richwhalley/.npm",npm_lifecycle_script:"webpack --node-env production",NVM_BIN:"/Users/richwhalley/.nvm/versions/node/v19.1.0/bin",npm_config_user_agent:"npm/8.19.3 node/v19.1.0 darwin x64 workspaces/false",npm_config_prefix:"/Users/richwhalley/.nvm/versions/node/v19.1.0",npm_node_execpath:"/Users/richwhalley/.nvm/versions/node/v19.1.0/bin/node",NODE_ENV:"production",REACT_APP_TILE_SHAPE:"1-1",REACT_APP_THEME:"dark",REACT_APP_COLOR:"#2F80FF",REACT_APP_LOGO:"",REACT_APP_FONT:"Roboto",REACT_APP_TOKEN_GENERATION_ENDPOINT:"https://prod-in2.100ms.live/hmsapi/breakthrough.app.100ms.live/",REACT_APP_ENV:"prod",REACT_APP_ENABLE_HLS_QUALITY_LVL:"true",REACT_APP_LOGROCKET_ID:"<Your Logrocket project ID>",REACT_APP_POLICY_CONFIG:"",REACT_APP_DEFAULT_APP_DETAILS:"{}",REACT_APP_ENABLE_STATS_FOR_NERDS:"'false'",REACT_APP_PUSHER_APP_KEY:"",REACT_APP_PUSHER_AUTHENDPOINT:"",REACT_APP_HEADLESS_JOIN:"false",REACT_APP_TITLE:"100ms App"}.REACT_APP_DYNAMIC_STT_TOKEN_GENERATION_ENDPOINT,t=yield(yield fetch(n)).json();if(t&&t.token){const m=t.token;this.socket=yield new WebSocket(`wss://api.assemblyai.com/v2/realtime/ws?sample_rate=${this.sttTuningConfig.desiredSampRate}&token=${m}`),this.setTranscript(""),this.socket.onmessage=r=>{try{const o=JSON.parse(r.data);if(o.text&&this.enabled){let l=this.streams[this.localPeerId].name,a=o.text.length>=80?o.text.split(" ").slice(Math.max(o.text.split(" ").length-10,1)).join(" "):o.text;this.setTranscript(a),this.setSpeakingPeer("[You]"),setTimeout(()=>{this.setTranscript(""),this.setSpeakingPeer("")},5e3),this.broadcast(JSON.stringify({peername:l,transcript:a,isEnabled:this.enabled}))}}catch(o){console.error("transcription",o)}},this.socket.onerror=r=>{console.error("transcription",r),this.socket.close()},this.socket.onclose=r=>{try{console.log(r),this.socket=null,this.enabled&&this.listen()}catch(o){console.error("transcription",o)}},this.socket.onopen=()=>{try{for(let r in this.streams)this.observeStream(this.streams[r].stream)}catch(r){console.error("transcription",r)}}}else console.log("Unable to fetch dynamic token!!")}catch(e){console.error("transcription",e)}})}observeStream(e){return g(this,null,function*(){new(C())(e,M(F({},this.sttTuningConfig),{type:"audio",mimeType:"audio/webm;codecs=pcm",recorderType:v.StereoAudioRecorder,ondataavailable:c=>{const t=new FileReader;t.onload=()=>{const m=t.result;if(this.socket&&this.enabled&&this.socket.readyState&&this.socket.readyState===1)try{this.socket.send(JSON.stringify({audio_data:m.split("base64,")[1]}))}catch(r){console.error("transcription",r)}},t.readAsDataURL(c)}})).startRecording()})}enableTranscription(e){e&&!this.enabled?(this.enabled=!0,this.listen(),this.broadcast(JSON.stringify({transcriptionConfig:{isEnabled:!0}}))):!e&&this.enabled&&(this.broadcast(JSON.stringify({transcriptionConfig:{isEnabled:!1}})),this.enabled=!1,this.socket.close(),this.socket=null,setTimeout(()=>{this.setTranscript("")},200))}}}}]);

//# sourceMappingURL=922.ae14ee70.js.map